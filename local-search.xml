<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Custom Toon Shaders by Unity</title>
    <link href="/2024/09/08/custom-toon-shaders-in-Unity/"/>
    <url>/2024/09/08/custom-toon-shaders-in-Unity/</url>
    
    <content type="html"><![CDATA[<h1 id="Custom-Toon-Shaders-in-Unity"><a href="#Custom-Toon-Shaders-in-Unity" class="headerlink" title="Custom Toon Shaders in Unity"></a>Custom Toon Shaders in Unity</h1><p>On process right now…</p><p><img src="/2024/09/08/custom-toon-shaders-in-Unity/1.jpg"></p><p><img src="/2024/09/08/custom-toon-shaders-in-Unity/2.jpg"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Custom Deferred Renderer by D3D12</title>
    <link href="/2024/08/15/Physically-Based-Rendering-with-DirectX-12/"/>
    <url>/2024/08/15/Physically-Based-Rendering-with-DirectX-12/</url>
    
    <content type="html"><![CDATA[<h1 id="Working-on-Process…"><a href="#Working-on-Process…" class="headerlink" title="Working on Process…"></a>Working on Process…</h1><ul><li>forward rendering (done)</li><li>deferred rendering (done)</li><li>PBR (done)</li><li>texture (on process)</li><li>cubebox (on process)</li></ul><p><img src="/2024/08/15/Physically-Based-Rendering-with-DirectX-12/1.png"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Custom Renderer from Sketch by C</title>
    <link href="/2024/07/23/CS5310-final-project/"/>
    <url>/2024/07/23/CS5310-final-project/</url>
    
    <content type="html"><![CDATA[<h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>Here is a rendering engine that I have completely hand-written in C. Everything is implemented manually by me, from matrix addition and subtraction, memory allocation, rasterization, z-buffer, alpha test, shadow methods, Phong shading, particle systems, importing materials, importing OBJ files, Water Simulation, etc.. </p><h2 id="Water-Surface-Simulation"><a href="#Water-Surface-Simulation" class="headerlink" title="Water Surface Simulation"></a>Water Surface Simulation</h2><p><img src="/2024/07/23/CS5310-final-project/15_2.gif" alt="Water surface simluation + Rainfall"></p><ul><li>Phong Shading.</li><li>Multiple cosine waves are used to simulate the water surface.</li><li>A grayscale texture is calculated for alpha testing.</li><li>dynamic particles are simulated to represent water droplets.</li></ul><h2 id="Phyical-Based-Water-Simulation"><a href="#Phyical-Based-Water-Simulation" class="headerlink" title="Phyical Based Water Simulation"></a>Phyical Based Water Simulation</h2><p><img src="/2024/07/23/CS5310-final-project/15_9.gif" alt="PBD by distance constriant"></p><p>Based on this paper to simulate water : <a href="https://mmacklin.com/pbf_sig_preprint.pdf">Position Based Fluids</a>.</p><p><img src="/2024/07/23/CS5310-final-project/15_13.gif" alt="1000 particles with PBF"></p><h1 id="1-Image"><a href="#1-Image" class="headerlink" title="1. Image"></a>1. Image</h1><h2 id="Do-something-interesting-to-the-image"><a href="#Do-something-interesting-to-the-image" class="headerlink" title="Do something interesting to the image"></a>Do something interesting to the image</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">../bin/lab1 geraniums.ppm lab1.ppm<br></code></pre></td></tr></table></figure><p>First, I changed the order of green and red to try to output only the leaves, but there was some noise. To fix this issue, two ideas came to mind:</p><ol><li>Blur the original image first, then perform the color separation.</li><li>Use a method similar to shadow mapping’s Percentage-Closer Filtering (PCF), which reduces noise by<br>sampling a circle of surrounding kernels to compute weights when each point is sampled.<br>I can do this change in the last section, so leave this method right here.</li></ol><div style="display: flex; justify-content: center; align-items: center;">  <img src="1_1.jpg" title="Brief output of green leaves" width="300px" height="300px"></div><h2 id="Implement-green-blue-screen-compositing"><a href="#Implement-green-blue-screen-compositing" class="headerlink" title="Implement green&#x2F;blue screen compositing"></a>Implement green&#x2F;blue screen compositing</h2><p>Try to mask the blue and green channel, and try to combine it with the origin background, here is what I got.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">../bin/mask powerpuff.ppm mask.ppm<br></code></pre></td></tr></table></figure><div style="display: flex; justify-content: center; align-items: center;">  <img src="1_2.jpg" title="A regular image" width="200px" height="200px" >  <img src="1_3.jpg" title="A regular image" width="200px" height="200px"></div><p>Trying to use offset dx and dy now. </p><div style="display: flex; justify-content: center; align-items: center;">   <img src="1_4.jpg" title="A regular image" width="200px" height="200px"></div><p>But there are still two problems:</p><ul><li>The front image is so big, trying to add a scale funtion before combine.</li><li>The eyes are missing, because the current blue and green channel blocks much more than except.</li></ul><h3 id="add-scale"><a href="#add-scale" class="headerlink" title="add scale"></a>add scale</h3><p>A new scale function has been added, which now scale the size of the image, the command is below.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">../bin/combine powerpuff.ppm geraniums.ppm mask.ppm 20 -20 0.5 output.ppm<br></code></pre></td></tr></table></figure><div style="display: flex; justify-content: center; align-items: center;">   <img src="1_5.jpg" title="A regular image" width="200px" height="200px"></div><h3 id="updated-mask-algorithm"><a href="#updated-mask-algorithm" class="headerlink" title="updated mask algorithm"></a>updated mask algorithm</h3><p>After studying the image carefully, the eyes are composed of black and white, so I changed the algorithm so that if the color of the rgb is black, or pure white, it always counts as white and doesn’t count as part of the background. Now the result seems better.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">../bin/mask powerpuff.ppm mask.ppm<br></code></pre></td></tr></table></figure><div style="display: flex; justify-content: center; align-items: center;">  <img src="1_6.jpg" title="A regular image" width="200px" height="200px" >  <img src="1_7.jpg" title="A regular image" width="200px" height="200px"></div><h3 id="add-blur-background"><a href="#add-blur-background" class="headerlink" title="add blur background"></a>add blur background</h3><p>It feels like if you can blur the background, the result should be cool. My algorithm just adds a kernel just like the pcf in shadowmap and samples around the circle to average the blur. And below is my final result</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="1_8.jpg" title="A regular image" width="300px" height="300px" ></div><h2 id="Concolusion"><a href="#Concolusion" class="headerlink" title="Concolusion"></a>Concolusion</h2><p>After this assignment we’ve got the basic pixel, colour data structures, written all the relevant functions, the memory allocation for c has really bothered me for a long time, I’m relying too much on smart pointers, this class will give me a deeper understanding of stack and heap allocating memory and freeing it.</p><h1 id="2-Fractals"><a href="#2-Fractals" class="headerlink" title="2. Fractals"></a>2. Fractals</h1><p>This assignment explores the implementation of various fractal and noise generation algorithms using C and C++. The primary focus is on generating images of Mandelbrot and Julia sets, as well as creating cloud patterns using Perlin noise. The document details the challenges faced in integrating C and C++ code, particularly for functions specific to image processing requirements. Additionally, it includes animated visualizations of Julia sets and Perlin noise-based clouds, demonstrating the dynamic behavior of these mathematical constructs. The assignment emphasizes the importance of understanding underlying principles and efficient implementation techniques in computer graphics.</p><h2 id="Image-Structure"><a href="#Image-Structure" class="headerlink" title="Image Structure"></a>Image Structure</h2><p>This part the code I writed is totally in C, because some of the functions in the assignment requirements cannot be implemented in C++, they do not meet the requirements. Image.h can be called with c, or with C++’s extern as below:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> &#123;<br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Image.h&quot;</span></span><br>&#125;<br></code></pre></td></tr></table></figure><p>The result as below:</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="2_1.jpg" title="A regular image" width="300px" height="200px" >  <img src="2_2.jpg" title="A regular image" width="300px" height="200px" >  <img src="2_3.jpg" title="A regular image" width="300px" height="200px"></div><p>I used to set the max_value as float [0,1] I found the reason why this doesnot work and cause a crash. At last I found that PPM (P6) set max_value as int [0,255] not as I except.</p><h2 id="Mandelbrot-and-Julia-Sets"><a href="#Mandelbrot-and-Julia-Sets" class="headerlink" title="Mandelbrot and Julia Sets"></a>Mandelbrot and Julia Sets</h2><p>based on the requirement below: </p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">A picture of the complete Mandelbrot set in an appropriate rectangle.<br>A picture of a Julia set defined by c = 0.7454054 + i*0.1130063 in an appropriate rectangle.<br></code></pre></td></tr></table></figure><p>The assignment didn’t involve considering colors, so the result as below.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="2_4.jpg" title="A regular image" width="300px" height="200px" >  <img src="2_5.jpg" title="A regular image" width="300px" height="200px" >  <img src="2_6.jpg" title="A regular image" width="300px" height="200px"></div><p>Here are something I wanna mentioned:  </p><ol><li>I change the <code>mandeltest.c</code>to <code>mandeltest.cpp</code>, because the implantation of <code>fractals.cpp/h</code> I use c++.</li><li>Normal equation of this two method to update z is $z^2 + c$ , but the lab instruction is $z^2 - c$. I choose to use the lab instruction.</li><li>To conform to the coordinate system required for the assignment, I inverted my y-axis.</li></ol><h3 id="add-something-I-am-interested-in-ImageMagick"><a href="#add-something-I-am-interested-in-ImageMagick" class="headerlink" title="add something I am interested in : ImageMagick"></a>add something I am interested in : ImageMagick</h3><p>I wanna to see the movement of julia function like output a video, there are two method comes to my mind : 1. build a graphic pipeline or output lots of ppm and combine them as a JIF. I am too lasy to select the second method. Click the figure below can jump to the website I store the GIF.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="2_11.gif" title="A regular image" width="900px" height="500px" ></div><h2 id="Fractal-Noise-Perlin"><a href="#Fractal-Noise-Perlin" class="headerlink" title="Fractal Noise: Perlin"></a>Fractal Noise: Perlin</h2><h3 id="single-level-Perlin"><a href="#single-level-Perlin" class="headerlink" title="single-level Perlin"></a>single-level Perlin</h3><p>Generates a cloud pattern using a single-level Perlin noise algorithm and applies it to an image. In my main.cpp it is generateCloudsPerlin.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="2_8.jpg" title="A regular image" width="300px" height="200px" ></div><h3 id="multi-level-Perlin"><a href="#multi-level-Perlin" class="headerlink" title="multi-level Perlin"></a>multi-level Perlin</h3><p>Generates a cloud pattern using a multi-level Perlin noise algorithm and applies it to an image. In my <code>main.cpp</code> it is <code>generateCloudsPerlin2</code>.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="2_12.gif" title="A regular image" width="900px" height="500px" ></div><h2 id="animation-of-sky-and-cloud"><a href="#animation-of-sky-and-cloud" class="headerlink" title="animation of sky and cloud"></a>animation of sky and cloud</h2><p>Generates a cloud pattern using a multi-level Perlin noise algorithm with time-based animation and distinguishes between cloud and sky regions. In my main.cpp it is <code>generateCloudsPerlin4</code>.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="2_13.gif" title="A regular image" width="900px" height="500px" ></div><h1 id="3-Graphic-Primitives"><a href="#3-Graphic-Primitives" class="headerlink" title="3. Graphic Primitives"></a>3. Graphic Primitives</h1><h2 id="basic-point-line-ellipse-and-circle"><a href="#basic-point-line-ellipse-and-circle" class="headerlink" title="basic point, line, ellipse and circle"></a>basic point, line, ellipse and circle</h2><p>Here are the RESULTS of all the test case, ellipse and circles I used the given template.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="3_1.jpg" title="A regular image" width="400px" height="200px" >  <img src="3_2.jpg" title="A regular image" width="400px" height="200px" >  <img src="3_3.jpg" title="A regular image" width="400px" height="200px"></div><div style="display: flex; justify-content: center; align-items: center;">  <img src="3_4.jpg" title="A regular image" width="300px" height="200px" >  <img src="3_5.jpg" title="A regular image" width="300px" height="200px" ></div><h2 id="anti-alias-SSAA"><a href="#anti-alias-SSAA" class="headerlink" title="anti-alias: SSAA"></a>anti-alias: SSAA</h2><p>I try to implement a anti-alias method: SSAA. Here is the meaning of all the graph.</p><ol><li>Because our data of ppm is integer 2D array in Image.h. So I try to implement SSAA at integer base, which mean use a filter get random points around the target point, calculate the result. The result is not what I want, so I change the method to float base.</li><li>Float base SSAA means random up and down 1 to sample. If the random result is $x &#x3D; x + 0.1 $ 0.1 is the random SSAA, which means $dx &#x3D; x + 1$. the result as below use 2X SSAA.</li><li>This image is interesting, I randomized the rgb separately, so it produced the effect below, then I set the random seed of the rgb to one and it didn’t produce this error.</li></ol><div style="display: flex; justify-content: center; align-items: center;">  <img src="3_6.jpg" title="A regular image" width="400px" height="200px" >  <img src="3_7.jpg" title="A regular image" width="400px" height="200px" >  <img src="3_8.jpg" title="A regular image" width="400px" height="200px"></div><ol start="4"><li>The rest 3 image is different level of SSAA sample rate.</li></ol><div style="display: flex; justify-content: center; align-items: center;">  <img src="3_9.jpg" title="A regular image" width="400px" height="200px">  <img src="3_10.jpg" title="A regular image" width="400px" height="200px">  <img src="3_11.jpg" title="A regular image" width="400px" height="200px"></div><h2 id="draw-a-sphere"><a href="#draw-a-sphere" class="headerlink" title="draw a sphere"></a>draw a sphere</h2><h3 id="vertex-of-sphere"><a href="#vertex-of-sphere" class="headerlink" title="vertex of sphere"></a>vertex of sphere</h3><p>build the vertex of sphere by formula.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="3_12.jpg" title="A regular image" width="400px" height="400px"></div><h3 id="triangle-of-sphere"><a href="#triangle-of-sphere" class="headerlink" title="triangle of sphere"></a>triangle of sphere</h3><p>I added a triangle on top of the original line, point, circles… connect each three point to a triangle and result got below. I rebuilt a new tuple, the triangle, as the most basic tuple for linking the three points so that I could render the entire circle.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="3_13.jpg" title="A regular image" width="400px" height="400px"></div><h3 id="fill-the-triangle"><a href="#fill-the-triangle" class="headerlink" title="fill the triangle"></a>fill the triangle</h3><div style="display: flex; justify-content: center; align-items: center;">  <img src="3_14.jpg" title="A regular image" width="400px" height="400px"></div><p>with the fill method, I can prevent there is a light on the top of the ball, simply by add a rgb change method in for loop of filling the triangles. After completing the whole project and looking back at it as I was finishing up my final project, I realised that this was a simple implementation of shadow depth.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="3_15.jpg" title="A regular image" width="400px" height="400px"></div><h1 id="4-Scanline-Fill"><a href="#4-Scanline-Fill" class="headerlink" title="4. Scanline Fill"></a>4. Scanline Fill</h1><h2 id="Basic-point-line-ellipse-and-circle"><a href="#Basic-point-line-ellipse-and-circle" class="headerlink" title="Basic point, line, ellipse and circle"></a>Basic point, line, ellipse and circle</h2><p>Here are the RESULTS of all the test case. From this week, I am a little bit busy, I need to work 12 hours a day, The amount of my report will be less, but the work I done is not (I wish).</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="4_1.jpg" title="A regular image" width="200px" height="200px">  <img src="4_2.jpg" title="A regular image" width="200px" height="200px">  <img src="4_5.jpg" title="A regular image" width="200px" height="200px"></div><h2 id="Make-primitives-move"><a href="#Make-primitives-move" class="headerlink" title="Make primitives move"></a>Make primitives move</h2><p>I attempted to integrate the primitives, including the ellipses, circles, and lines that the professor taught us this time, along with the triangles I previously created and the mesh formula composed of triangles. I combined them all to be called together. Then, I used the same method as before to generate a GIF of my results.</p><h3 id="The-explosion"><a href="#The-explosion" class="headerlink" title="The explosion"></a>The explosion</h3><div style="display: flex; justify-content: center; align-items: center;">  <img src="4_6.gif" title="A regular image" width="400px" height="400px"></div><h3 id="Sphere-mesh"><a href="#Sphere-mesh" class="headerlink" title="Sphere mesh"></a>Sphere mesh</h3><div style="display: flex; justify-content: center; align-items: center;">  <img src="4_7.gif" title="A regular image" width="400px" height="400px"></div><h2 id="Real-time-renderer"><a href="#Real-time-renderer" class="headerlink" title="Real time renderer"></a>Real time renderer</h2><p>This week, I completed the basic structure for graphics and transformed the primitives into dynamic ones that I like. I also attempted to integrate the entire structure into Qt, allowing me to see the changes in real-time. I am very interested in real-time rendering, and this can be considered the first step. It’s really fascinating to implement a real-time renderer by myself, I’m excited and starting to try it.</p><h3 id="The-basic-interface-of-my-UI"><a href="#The-basic-interface-of-my-UI" class="headerlink" title="The basic interface of my UI"></a>The basic interface of my UI</h3><p>The current overall structure is too basic and not very modern. However, I will make this structure more modern in the upcoming assignments.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="4_3.jpg" title="A regular image" width="700px" height="400px"></div><h3 id="Apply-anti-anlysis-in-UI"><a href="#Apply-anti-anlysis-in-UI" class="headerlink" title="Apply anti-anlysis in UI"></a>Apply anti-anlysis in UI</h3><p>The current anti-aliasing method is too basic. In the upcoming assignments, I will add additional parameter controls, allowing for toggling on and off, selecting anti-aliasing multipliers, and choosing different methods.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="4_4.jpg" title="A regular image" width="700px" height="400px"></div><h1 id="5-Transformations-and-Viewing"><a href="#5-Transformations-and-Viewing" class="headerlink" title="5. Transformations and Viewing"></a>5. Transformations and Viewing</h1><h2 id="Basic-task"><a href="#Basic-task" class="headerlink" title="Basic task"></a>Basic task</h2><ol><li>The first part of the assignment is to build a matrix library as outlined in the system specification.</li><li>The second part of the assignment is to create a 2D view matrix function and demonstrate that it works using the test function.</li><li>The third task is to create a 3D view matrix function and demonstrate it works using the test function.</li></ol><p>Note that my third example already incorrect! But I did not notice it at that time! It should be look down to the square not up.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="5_1.jpg" title="A regular image" width="400px" height="200px">  <img src="5_2.jpg" title="A regular image" width="400px" height="200px">  <img src="5_3.jpg" title="A regular image" width="300px" height="200px"></div><h2 id="The-formula-of-View-2D-and-3D"><a href="#The-formula-of-View-2D-and-3D" class="headerlink" title="The formula of View 2D and 3D"></a>The formula of View 2D and 3D</h2><p>When I review the result I found that at that time my program is already incorrect, my MVP matrix is wrong. This part of the assignment confused me for a long time, and I am summarising all the steps of 2D and 3D MVP matrix transformation in case I kmaek the same mistake in the furthure.</p><h3 id="2D-View-Transformation-Process"><a href="#2D-View-Transformation-Process" class="headerlink" title="2D View Transformation Process"></a>2D View Transformation Process</h3><ol><li><p><strong>Initialization</strong>:</p><ul><li>Start by identifying the view rectangle’s height in world coordinates based on the screen dimensions and aspect ratio:<br>$$<br>dy &#x3D; \frac{view.dx \cdot view.screeny}{view.screenx}<br>$$</li></ul></li><li><p><strong>Translation</strong>:</p><ul><li>Translate the View Reference Point (VRP) to the origin by applying a translation matrix that moves the VRP to $(0, 0)$:<br>$$<br>T(-V0_x, -V0_y)<br>$$</li></ul></li><li><p><strong>Rotation</strong>:</p><ul><li>Rotate the coordinate system such that the x-axis aligns with the given view direction vector (x). This is achieved by constructing a rotation matrix that aligns (x) and negates (y):<br>$$<br>R(nx, -ny)<br>$$</li></ul></li><li><p><strong>Scaling</strong>:</p><ul><li>Scale the coordinate system to map the view rectangle dimensions to screen coordinates. This involves scaling the x-dimension by $\frac{screenx}{dx}$ and the y-dimension by $\frac{-screeny}{dy}$ (to account for screen coordinate inversion):<br>$$<br>S\left(\frac{C}{du}, \frac{-R}{dv}\right)<br>$$</li></ul></li><li><p><strong>Translation to Screen Center</strong>:</p><ul><li>Finally, translate the coordinate system to center the view on the screen. This is done by translating by half the screen width and height:<br>$$<br>T\left(\frac{C}{2}, \frac{R}{2}\right)<br>$$</li></ul></li><li><p><strong>Combining Transformations</strong>:</p><ul><li>Combine all the above transformations in the correct order: scale, rotate, and then translate, to form the final View Transformation Matrix (VTM).</li></ul></li></ol><h3 id="3D-View-Transformation-Process"><a href="#3D-View-Transformation-Process" class="headerlink" title="3D View Transformation Process"></a>3D View Transformation Process</h3><ol><li><p><strong>Initialization</strong>:</p><ul><li>Start by setting the View Transformation Matrix (VTM) to the identity matrix.</li></ul></li><li><p><strong>Translation of VRP</strong>:</p><ul><li>Translate the View Reference Point (VRP) to the origin. This is done by applying a translation matrix that moves the VRP to $(0, 0, 0)$:<br>$$<br>T(-VRP_x, -VRP_y, -VRP_z)<br>$$</li></ul></li><li><p><strong>Constructing the Rotation Matrix</strong>:</p><ul><li>Calculate the orthonormal basis vectors (u), (v), and (w) from the View Plane Normal (VPN) and the View Up Vector (VUP). Normalize (w) (aligned with VPN), then compute (u) as the cross product of VUP and (w), and finally compute (v) as the cross product of (w) and (u):<br>$$<br>w &#x3D; \frac{VPN}{||VPN||}<br>$$<br>$$<br>u &#x3D; \frac{VUP \times w}{||VUP \times w||}<br>$$<br>$$<br>v &#x3D; w \times u<br>$$</li></ul></li><li><p><strong>Applying the Rotation</strong>:</p><ul><li>Form a rotation matrix using the basis vectors (u), (v), and (w), and apply it to align the coordinate system with the view direction.</li></ul></li><li><p><strong>Translation to COP</strong>:</p><ul><li>Translate the Center of Projection (COP) to the origin by applying a translation matrix along the z-axis by the distance (d) (viewing distance):<br>$$<br>T(0, 0, d)<br>$$</li></ul></li><li><p><strong>Scaling to NDC (CVV)</strong>:</p><ul><li>Scale the coordinate system to map the view volume to the Canonical View Volume (CVV), which in normalized device coordinates (NDC) is the unit cube. This involves scaling by the dimensions (du), (dv), and the depth (distance from VRP to the back clipping plane):<br>$$<br>S\left(\frac{2d}{du \cdot depth}, \frac{2d}{dv \cdot depth}, \frac{1}{depth}\right)<br>$$</li></ul></li><li><p><strong>Perspective Projection</strong>:</p><ul><li>Apply perspective projection to the coordinate system to account for perspective foreshortening. This is done by scaling the z-coordinate appropriately:<br>$$<br>P\left(\frac{d}{depth}\right)<br>$$</li></ul></li><li><p><strong>Scaling to Screen Coordinates</strong>:</p><ul><li>Scale the coordinate system to map the NDC to screen coordinates. This involves scaling by half the screen width and height, and flipping the y-axis to match screen coordinates:<br>$$<br>S\left(\frac{-screenx}{2 \cdot (d &#x2F; depth)}, \frac{-screeny}{2 \cdot (d &#x2F; depth)}, 1\right)<br>$$</li></ul></li><li><p><strong>Final Translation to Image Coordinates</strong>:</p><ul><li>Translate the coordinate system to position it correctly on the screen. This involves translating by half the screen width and height:<br>$$<br>T\left(\frac{screenx}{2}, \frac{screeny}{2}\right)<br>$$</li></ul></li><li><p><strong>Combining Transformations</strong>:</p><ul><li>Combine all the above transformations in the correct order: translate, rotate, translate to COP, scale to NDC, apply perspective, scale to screen coordinates, and finally translate to image coordinates, to form the final View Transformation Matrix (VTM).</li></ul></li></ol><p>This is extremely important to me.</p><h3 id="First-test-example-animation"><a href="#First-test-example-animation" class="headerlink" title="First test example animation"></a>First test example animation</h3><div style="display: flex; justify-content: center; align-items: center;">  <img src="5_4.gif" title="A regular image" width="500px" height="300px"></div><h3 id="Second-test-example-animation"><a href="#Second-test-example-animation" class="headerlink" title="Second test example animation"></a>Second test example animation</h3><div style="display: flex; justify-content: center; align-items: center;">  <img src="5_5.gif" title="A regular image" width="400px" height="400px"></div><h1 id="6-Hierarchical-Modeling"><a href="#6-Hierarchical-Modeling" class="headerlink" title="6. Hierarchical Modeling"></a>6. Hierarchical Modeling</h1><h2 id="basic-assignment"><a href="#basic-assignment" class="headerlink" title="basic assignment"></a>basic assignment</h2><p>My result of this assignment below.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="6_1.jpg" title="A regular image" width="400px" height="200px">   <img src="6_2.jpg" title="A regular image" width="400px" height="200px"></div><h2 id="Polygon-Transformation-and-Rendering-Process"><a href="#Polygon-Transformation-and-Rendering-Process" class="headerlink" title="Polygon Transformation and Rendering Process"></a>Polygon Transformation and Rendering Process</h2><h3 id="Overview-1"><a href="#Overview-1" class="headerlink" title="Overview"></a>Overview</h3><p>The process of transforming and rendering polygons is the bug I solved for most of the time. The key problem is in the order of components involved are the Local Transformation Matrix (LTM), Global Transformation Matrix (GTM), and View Transformation Matrix (VTM).</p><h3 id="Transformation-Matrices"><a href="#Transformation-Matrices" class="headerlink" title="Transformation Matrices"></a>Transformation Matrices</h3><ol><li><p><strong>LTM (Local Transformation Matrix)</strong>:</p><ul><li>Initially set to identity.</li><li>Used to transform the polygon from its local coordinate space to a global coordinate space.</li></ul></li><li><p><strong>GTM (Global Transformation Matrix)</strong>:</p><ul><li>Combines the LTM with the current GTM to obtain a temporary GTM (<code>tempGTM</code>).</li><li>This combined transformation is used to place the object correctly in the scene.</li></ul></li><li><p><strong>VTM (View Transformation Matrix)</strong>:</p><ul><li>Applied to transform the polygon from the global coordinate space to the view coordinate space.</li><li>Ensures the polygon is correctly oriented relative to the camera&#x2F;viewer.</li></ul></li></ol><h3 id="Process-Steps"><a href="#Process-Steps" class="headerlink" title="Process Steps"></a>Process Steps</h3><ol><li><p><strong>Initialization</strong>:</p><ul><li>The LTM and GTM are initialized to identity matrices.</li></ul></li><li><p><strong>Transformation</strong>:</p><ul><li>For each polygon object:<ul><li>A temporary GTM (<code>tempGTM</code>) is calculated by multiplying the current GTM with the LTM.</li><li>The polygon is transformed using <code>tempGTM</code> to position it correctly in the scene.</li></ul></li></ul></li><li><p><strong>Shading</strong>:</p><ul><li>Depending on the shading model (e.g., Gouraud shading), colors are calculated for each vertex.</li><li>This involves lighting calculations to determine the vertex colors.</li></ul></li><li><p><strong>View Transformation</strong>:</p><ul><li>The VTM is applied to the polygon to transform it into the view space.</li><li>The polygon is then normalized to ensure it fits within the viewable area.</li></ul></li><li><p><strong>Rendering</strong>:</p><ul><li>The polygon is rendered based on the shading model which will used in the later project, but now everything is ShadeConst.</li></ul></li><li><p><strong>Cleanup</strong>:</p><ul><li>The temporary polygon data is cleared after rendering to prepare for the next object.</li></ul></li></ol><h2 id="try-to-make-the-image-move"><a href="#try-to-make-the-image-move" class="headerlink" title="try to make the image move"></a>try to make the image move</h2><div style="display: flex; justify-content: center; align-items: center;">  <img src="6_3.gif" title="A regular image" width="600px" height="400px"></div><h1 id="7-Bezier-Curves-and-Surfaces"><a href="#7-Bezier-Curves-and-Surfaces" class="headerlink" title="7. Bezier Curves and Surfaces"></a>7. Bezier Curves and Surfaces</h1><p>When I first started implementing Bezier curves and surfaces, I treated them as separate modules, at the same level as lines and polygons. Later, with Bruce’s correction, I realized that Bezier curves are just tools for generating modules or lines. After generating lines or polygons, they still need to be passed to polygons or polylines as basic primitives for rendering, rather than being independent.</p><p>In my subsequent code, I found that this approach has the advantage of being easier to maintain. Writing them separately would require duplicating all the polygon methods, which would be cumbersome.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="7_3.jpg" title="A regular image" width="400px" height="150px">  <img src="7_4.jpg" title="A regular image" width="400px" height="150px">  <img src="7_5.jpg" title="A regular image" width="400px" height="150px"></div><h2 id="Updated-the-Interface"><a href="#Updated-the-Interface" class="headerlink" title="Updated the Interface"></a>Updated the Interface</h2><p>I have updated my UI to display the antialiasing multiplier and the toggle option, as shown in the image. Additionally, I have integrated module drawing into the real-time transformation Qt UI.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="7_1.gif" title="A regular image" width="800px" height="400px"></div><div style="display: flex; justify-content: center; align-items: center;">  <img src="7_2.gif" title="A regular image" width="800px" height="400px"></div><h1 id="8-Z-buffer-Rendering"><a href="#8-Z-buffer-Rendering" class="headerlink" title="8. Z-buffer Rendering"></a>8. Z-buffer Rendering</h1><h2 id="Basic-task-1"><a href="#Basic-task-1" class="headerlink" title="Basic task"></a>Basic task</h2><p>This week you need to implement any z-buffer related functions you’ve skipped so far. They are interspersed throughout the the graphics system document Download graphics system document, so scan through it to see the various places that need to change.  Otherwise, it has not changed from the last project.</p><p>Here are the basic two testfile output.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="8_2.jpg" title="A regular image" width="400px" height="200px">  <img src="8_3.jpg" title="A regular image" width="400px" height="200px"></div><h2 id="z-buffer-simluate-blending"><a href="#z-buffer-simluate-blending" class="headerlink" title="z-buffer simluate blending"></a>z-buffer simluate blending</h2><p>After implemented z-buffer, I had a bold idea, the usual method of blending that people use is to add the alpha channel, could I just run the blending directly on the zbuffer without adding the alpha channel? Here’s what I’m going to do. Change the current algorithm: if 1&#x2F;zbuffer is larger than the zbuffer stored in the image, replace it directly, but instead put the two colours together and press them to a certain weight.</p><ol><li>For each pixel, if the depth of the new color is less than the current depth in the z-buffer, calculate the blended color using the depth values as weights.</li><li>Update the z-buffer and color buffer with the blended color and new depth.</li></ol><div style="display: flex; justify-content: center; align-items: center;">  <img src="8_1.jpg" title="A regular image" width="400px" height="200px"></div><p>The result is a little bit wired, try to find the issue after implement the alpha channel.</p><h2 id="Insert-it-in-my-UI"><a href="#Insert-it-in-my-UI" class="headerlink" title="Insert it in my UI"></a>Insert it in my UI</h2><p>Do the same to the project before </p><p><img src="/2024/07/23/CS5310-final-project/8_4.gif"></p><h1 id="9-Lighting-and-Shading"><a href="#9-Lighting-and-Shading" class="headerlink" title="9. Lighting and Shading"></a>9. Lighting and Shading</h1><p>Basic light algorithm implementations such as gourand shading, depth shading, etc. were implemented this week. Also accessed the extra api to enable calling ply files, which is really interesting, I’m going to put some notorious graphics content in there now, oh yeah, and fixed a major bug, with Bruce’s instructions I realised that my fillscan actually didn’t detect if y was out of bounds! No wonder I’ve been having the inexplicable falling out of memory failure bug before.</p><h2 id="basic-result"><a href="#basic-result" class="headerlink" title="basic result"></a>basic result</h2><div style="display: flex; justify-content: center; align-items: center;">  <img src="9_1.jpg" title="A regular image" width="400px" height="150px">  <img src="9_2.jpg" title="A regular image" width="400px" height="150px">  <img src="9_3.jpg" title="A regular image" width="400px" height="150px"></div><h2 id="Water-Simulation"><a href="#Water-Simulation" class="headerlink" title="Water Simulation"></a>Water Simulation</h2><h3 id="introduction"><a href="#introduction" class="headerlink" title="introduction"></a>introduction</h3><p>After assignment Lighting and Shading, we already have light, so it is time for me to start building the surface of the sea. I really like things in nature like ocean, moon light, montains and I wanted to realise it in this assignment.</p><h3 id="Mesh-the-water-surface"><a href="#Mesh-the-water-surface" class="headerlink" title="Mesh the water surface"></a>Mesh the water surface</h3><p>I made a 50 x 50 size mesh in xz plane, and each set have four points, combine as a polygon, all the normal of polygon initialize as 0,1,0, which is up.</p><p><img src="/2024/07/23/CS5310-final-project/9_4.jpg" alt="mesh of my water surface"></p><h3 id="Simulation-the-water-by-Sinusoids-Wave"><a href="#Simulation-the-water-by-Sinusoids-Wave" class="headerlink" title="Simulation the water by Sinusoids Wave"></a>Simulation the water by Sinusoids Wave</h3><p>The idea of modelling the undulation of water surfaces using a combination of sequences of sine wave curves of high and low amplitude was first introduced by Max [Max 1981] in 1981. By modelling the surface of a body of water using heights, the general formula for the height y &#x3D; h(x, z, t) computed at each point (x, z) at time t by the Sinusoids Wave (SW) based method is:<br>Sinusoids Wave is now rarely used directly in the field of water rendering, and the industry tends to favour the use of its evolution, Gerstner Wave.[1] [2]</p><p>$$h(x, z, t) &#x3D; -y_0 + \sum_{i&#x3D;1}^{N_w} A_i \cos(k_{ix} x + k_{iz} z - \omega_i t)$$  </p><ul><li>$h(x,z,t)$ : the height <code>y</code> of the wave when time <code>t</code> and position $(x,z)$.  </li><li>$Nw$: total number of waves which is used to make the system more complex. </li><li>$Ai$: each wave’s amplitude.</li><li>$y_0$: the starting <code>y</code> position of each result, I set it as 0.</li></ul><p>The formula above is calculate by 1D Sinusoids Wave below, which is easy to understand:<br>$$y &#x3D; Asin(k_{ix}x+w_it)$$</p><p>Use $sin$ and $cos$ will get same simluation result, the only difference is the position of starting wave. </p><div style="display: flex; justify-content: center; align-items: center;">  <img src="9_7.gif" title="A regular image" width="400px" height="200px"></div><p>Depth Shading and Ground Shading in <code>real time</code> below.</p><p><img src="/2024/07/23/CS5310-final-project/9_5.gif" alt="Depth Shading + Sinusoids Wave"></p><p><img src="/2024/07/23/CS5310-final-project/9_6.gif" alt="Ground Shading + Sinusoids Wave"></p><p>The result is not continuous, but it is as expected, because each face is populated by that face’s own <code>normal</code>, so the two faces don’t have the same <code>normal</code> so there will be this difference.<br>I have two idea to avoid this:  </p><ol><li>Normal Mapping: I’m going to output the <code>normal</code> mapping, by representing the normals of all the points in rgb and thus outputting them.</li><li>Offline Renderer: I am going to build a offline renderer, and 100 times the amount of the triangles.</li></ol><p>Normally normal mapping requires storage and texture, but we don’t have texture yet, I’m going to implement this step after texture. So I build a offline renderer and render the image for 1 second and here is the result.<br><img src="/2024/07/23/CS5310-final-project/9_8.jpg" alt="Ground Shading + Sinusoids Wave (offline)"></p><p>I built a realtime macro, which will change all the function and interface to realtime or offline, make me much more eaiser to control the code. For example, the code below is changing drawing speed of the code.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">if</span>(realtime) <span class="hljs-comment">// realtime rendering</span><br>    timer-&gt;<span class="hljs-built_in">start</span>(<span class="hljs-number">10</span>); <span class="hljs-comment">// 10 ms per draw</span><br><span class="hljs-keyword">else</span> <span class="hljs-comment">// offline rendering</span><br>    timer-&gt;<span class="hljs-built_in">start</span>(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 1000 ms per draw</span><br></code></pre></td></tr></table></figure><p>Its really fun, I try to change the formula not directly implement the height by x and y, but input the $\sqrt{x^2+z^2}$ replace x or z.</p><p><img src="/2024/07/23/CS5310-final-project/9_9.gif" alt="Ground Shading + Sinusoids Wave (offline)"></p><p>Then try to put the center point to the center of the water surface, simply calculate the distance by $\sqrt{(x-\frac{width}{4})^2+(z-\frac{height}{4})^2}$, width and height are the number of polygon’s vertex in my algorithm.</p><p><img src="/2024/07/23/CS5310-final-project/9_10.gif" alt="Ground Shading + Sinusoids Wave (offline)"></p><h1 id="10-Texture"><a href="#10-Texture" class="headerlink" title="10. Texture"></a>10. Texture</h1><p>The implementation of textures should be the easiest, as it is done exactly like the colors, using linear interpolation. The only difference is that for textures, I use a 2D texture map, and instead of interpolating colors, I interpolate texture coordinates. I wrote a new function to read the texture, and the test results are as follows.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="10_1.jpg" title="A regular image" width="300px" height="300px">  <img src="10_2.gif" title="A regular image" width="500px" height="300px"></div><p>Combining three different kinds of waveforms to make the picture random enough, and also combine the texture we calculate just now. Here is the result of.</p><p><img src="/2024/07/23/CS5310-final-project/10_3.gif" alt="Ground Shading + Sinusoids Wave (three different kind of waves) + texture (offline)"></p><h1 id="11-SkyBox"><a href="#11-SkyBox" class="headerlink" title="11. SkyBox"></a>11. SkyBox</h1><p>Implementing a skybox, based on our system I have the following ideas. I spend 3 days on this , make me really depressed, it should not that hard, because there are lots of problem of bounding in fillscan of my code before.</p><ol><li>The skybox doesn’t need to introduce a zbuffer, he gets rendered first and all subsequent renders override the skybox just fine. </li><li>The skybox should have the same coord as same as camera, should tranlslate to the center point of camera, but should not rotate with it.</li><li>The skybox in some point is a cube polygon, I can simply use the module_cube algorithm before, but make the normal point to the center of the box.</li></ol><p>The image below is the skybox I init, and put it in the center of the camera. </p><div style="display: flex; justify-content: center; align-items: center;">  <img src="11_1.jpg" title="A regular image" width="300px" height="300px">  <img src="11_2.jpg" title="A regular image" width="500px" height="300px"></div><p>At the beginning, I didn’t want to use linear interpolation to compute the skybox because I thought this method would be very time-consuming. In my opinion, the correct approach should be to get the transformation matrix for each surface of the skybox, then apply this matrix to the transformation after reading the image, and map it to each face. This would greatly reduce the computational load since it wouldn’t require operations like fillScan. However, I eventually gave up because it was too complicated. I needed to record all boundary conditions and calculate the matrix for each surface. So, I ended up using the simplest method: directly applying the texture to each surface.</p><h1 id="12-Phong-Shading"><a href="#12-Phong-Shading" class="headerlink" title="12.  Phong Shading"></a>12.  Phong Shading</h1><p>Below is the water surface I simulated with phong shading, you can see that there are obvious highlights and diffuse area, but one thing is strange, I tried to give the ks as big as possible as the water surface should be, but the result is very strange, diffuse and specular features are very strong in my code, and I ended up generating a light ambient light &#x3D; diffuse&#x3D;specular, R &#x3D; 100 and got relatively good results.</p><p><img src="/2024/07/23/CS5310-final-project/13_2.gif" alt="Phong shading with ka = 0.6; kd = 0.2; ks = 0.8; R = 100"></p><h1 id="13-Alpha-Channel"><a href="#13-Alpha-Channel" class="headerlink" title="13. Alpha Channel"></a>13. Alpha Channel</h1><p><img src="/2024/07/23/CS5310-final-project/14_1.gif" alt="Alpha Channel; kd = 0.2; ks = 0.8; R = 100"></p><p>Then I combine all the staff I have right now together, here is the result </p><p><img src="/2024/07/23/CS5310-final-project/14_2.gif" alt="Alpha + Texture + Particle + Phong"></p><!-- ![Alpha + Texture + Particle + Phong](/2024/07/23/CS5310-final-project/14_3.gif) --><p>I wanna add rain right now !</p><!-- ![Alpha + Texture + Particle + Phong](/2024/07/23/CS5310-final-project/14_4.gif) --><p><img src="/2024/07/23/CS5310-final-project/14_6.gif" alt="Alpha + Texture + Particle + Phong"></p><h1 id="14-Particle"><a href="#14-Particle" class="headerlink" title="14. Particle"></a>14. Particle</h1><p>s</p><p>I initially wanted to create fog over the water surface, but I realized that without using volumetric rendering or having shadow volumes, the result was quite poor. I tried using Perlin noise to achieve this, but the outcome was very disappointing. So, I changed my approach and decided to generate clouds instead. The fake result I obtained is as follows.</p><p><img src="/2024/07/23/CS5310-final-project/15_3.gif" alt="Random the fog position"></p><p>The result is pretty bad,, I decide not to use it…</p><p><img src="/2024/07/23/CS5310-final-project/15_4.jpg" alt="Random the fog position"></p><p>Here is my final result</p><p><img src="/2024/07/23/CS5310-final-project/15_2.gif" alt="My final result before PBD"></p><h1 id="15-PBD"><a href="#15-PBD" class="headerlink" title="15. PBD"></a>15. PBD</h1><p>There’s a very famous paper to simulate water : <a href="https://mmacklin.com/pbf_sig_preprint.pdf">Position Based Fluids</a>. I really want to imply this paper, but after thoroughly understanding what I need to do, I think I’ll need half a month to a month, but I’ve only got several days, so I’m going to implement an basic algorithm of this paper: PBD.</p><h2 id="Force"><a href="#Force" class="headerlink" title="Force"></a>Force</h2><p>Build a Particle and give a Gravity to it, the particle only have several faces as you see, this is because I wanna to make my program as fast as possible.</p><p><img src="/2024/07/23/CS5310-final-project/12_1.gif" alt="Partticle + Gravity = -9.8 "></p><p>One of the most basic things about PBD is that it <code>relies on position</code> to calculate acceleration and velocity, rather than the traditional reliance on acceleration and velocity to find position. So here is the structure of my particle.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-comment">// Particle structure for water simulation</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Particle</span>&#123;</span><br>    Point position;  <span class="hljs-comment">// Position of the particle</span><br>    Point pred_position; <span class="hljs-comment">// Next dt position</span><br>    Vector v; <span class="hljs-comment">// Velocity of the particle</span><br>    Vector acceleration; <span class="hljs-comment">// Acceleration of the particle</span><br>    Vector vorticity;<br>    Vector externalForce;<br>    Vector oneTimeForce; <span class="hljs-comment">// only use one time and dead</span><br>    <span class="hljs-type">int</span> oneTimeForceAlive;<br>    <span class="hljs-type">float</span> mass;     <span class="hljs-comment">// Mass of the particle</span><br>    Bin neighbours;<br>    <span class="hljs-type">float</span> lambda ;<br>    <span class="hljs-type">int</span> id ;<br>    <span class="hljs-type">const</span> <span class="hljs-type">int</span> size ;<br>&#125;;<br></code></pre></td></tr></table></figure><p>I add a new function <code>Apply One Time Force</code> and <code>A Bounding box System</code> to achieve the image below, here is the thing, I can not simply add a init velocity to the system, because it is <code>position based system</code>, I can only add one time force in the system.</p><p><img src="/2024/07/23/CS5310-final-project/12_2.gif" alt="Extra Force.x = -2 ; Gravity.y = -9.8 ; damping = 0.6 "></p><p><img src="/2024/07/23/CS5310-final-project/12_3.gif" alt="Extra Force.x = -2 ; Gravity.y = -9.8 ; damping = 0.8 "></p><p><img src="/2024/07/23/CS5310-final-project/12_5.gif" alt="1000 particles"></p><p>After adding 1000 the particles to the system, we found that they can not detect each other, which menas there is no collison in the sytstem. But here is the point, how to detected the particles around each particles ? We need a new structure : Grid[][][], we put all the particles in the gird, if we wanna to find the neighbour particles around the target particles, just get all the particles from grids which around the target particles. After that, we need a new method <code>distance constraint</code> to find how to deal with the collsion by a eaiser way.</p><h2 id="Distance-Constraint"><a href="#Distance-Constraint" class="headerlink" title="Distance Constraint"></a>Distance Constraint</h2><p>The most simple constraint which is <code>distance constraint</code>, my understanding is that we need to make sure that each point is as far as possible to where we expect it to be, and if that doesn’t work then fine-tune until the whole system is close to stable.</p><p>$$\nabla C_{ij} &#x3D; \frac{p_i - p_j}{| p_i - p_j |}t$$<br>$$\lambda_i &#x3D; \frac{-C_{ij}}{\sum_k (\nabla C_{ik})^2}$$<br>$$\Delta p_i &#x3D; \lambda_i \nabla C_{ij}$$<br>$$p_i’ &#x3D; p_i + \Delta p_i$$<br>$$p_j’ &#x3D; p_j - \Delta p_i$$</p><p><img src="/2024/07/23/CS5310-final-project/12_4.gif" alt="1000 particles"></p><p>The result is as expected, but for the bottom example there is a problem, the two points merge together when compressed to the extreme, the reason for this problem is because the bounding box detection I did not set as a constraint, because the constraint is to fine-tune the points, but in any case it should not go beyond the bouding box, here you can conditionally check the constraints, but it is too complex I’ll leave it here for now.</p><p><img src="/2024/07/23/CS5310-final-project/12_7.gif" alt="10000 particles my first result"></p><p>However, the results were unsatisfactory. After investigating, I identified three key issues:</p><ol><li><p><strong>Precision Issues</strong>: The precision of my calculations was insufficient. With a particle radius of 0.03, using floats resulted in significant errors when particles experienced even slight offsets. To address this, I switched to using double precision.</p></li><li><p><strong>Constraint Accumulation Method</strong>: My initial approach to constraint distance accumulation was flawed. According to [Müller et al. 2006], the system should be solved using an iterative method similar to Gauss-Seidel for linear equations. In this method, once a constraint is calculated, the particle positions are immediately corrected, and these updated positions are then used in subsequent constraint mappings. While this approach led to faster convergence, the results were still unsatisfactory due to insufficient accuracy. My initial crude method exacerbated these issues, so I introduced a new variable, <code>buffer_position</code>, to store the corrected positions before applying them.</p></li><li><p><strong>Time Step (dt) Problems</strong>: The choice of time step (<code>dt</code>) was problematic. Since the system runs on a single thread, I had increased <code>dt</code> for convenience, which led to an excessively large search range. This caused too many particles to be affected simultaneously, increasing the likelihood of overlapping positions and, consequently, inaccurate results.</p></li></ol><p>I addressed the issues mentioned above by removing all forces and increasing the distance between points, effectively simulating a situation similar to water droplets in space. Now, the results align with expectations: the distance between each point remains constant, and the overall system maintains precision, meeting our intended outcomes.</p><p><img src="/2024/07/23/CS5310-final-project/15_12.gif" alt="Delete all force, only keep the distance constriant"></p><p>And it’s really cool! When we reverse the constraint force—meaning that when points detect an incorrect distance, they move closer together—we observe the formation of distinct small clusters, as shown in the image below. Upon closer inspection, you’ll notice that each search area forms its own cluster. Each grid in the 3D space seems to gather into a center of mass, almost like gravitational attraction.And it’s really cool! When we reverse the constraint force—meaning that when points detect an incorrect distance, they move closer together—we observe the formation of distinct small clusters, as shown in the image below. Upon closer inspection, you’ll notice that each search area forms its own cluster. Each grid in the 3D space seems to gather into a center of mass, almost like gravitational attraction.</p><p><img src="/2024/07/23/CS5310-final-project/15_5.gif" alt="Random the fog position"></p><p>I generated a series of images, with the one I’m most satisfied with at the end. There’s still room for optimization, but the main reason the results aren’t perfect is due to the limitations of single-threading. I couldn’t significantly reduce the time step <code>dt</code> and <code>constraint strength</code> to achieve a flawless outcome. However, the image below represents the best result I could achieve with my current single-threading setup.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="15_6.gif" title="A regular image" width="400px" height="200px">  <img src="15_7.gif" title="A regular image" width="400px" height="200px">  <img src="15_8.gif" title="A regular image" width="400px" height="200px"></div><div style="display: flex; justify-content: center; align-items: center;">  <img src="15_9.gif" title="A regular image" width="400px" height="200px">  <img src="15_10.gif" title="A regular image" width="400px" height="200px">  <img src="15_11.gif" title="A regular image" width="400px" height="200px"></div><p>The result above is still bad , but which is the best result I got. </p><p><img src="/2024/07/23/CS5310-final-project/15_9.gif" alt="The Best result I use Gravity + Distance Constrant"></p><h1 id="PBF"><a href="#PBF" class="headerlink" title="PBF"></a>PBF</h1><h2 id="Incompressibility"><a href="#Incompressibility" class="headerlink" title="Incompressibility"></a>Incompressibility</h2><p>The $\textbf{Poly6 kernel}$ is defined as:</p><p>$$W_{\text{poly6}}(r, h) &#x3D; \frac{315}{64\pi h^9} \cdot (h^2 - r^2)^3$$</p><p>where:</p><ul><li>( r ) is the distance between two particles.</li><li>( h ) is the smoothing length or influence radius.</li></ul><p>For $( 0 \leq r \leq h ):<br>W_{\text{poly6}}(r, h) &#x3D; \frac{315}{64\pi h^9} \cdot (h^2 - r^2)^3$</p><p>For $( r &gt; h ):W_{\text{poly6}}(r, h) &#x3D; 0$</p><p>The $\textbf{Spiky kernel}$ is defined as:  </p><p>$$W_{\text{spiky}}(r, h) &#x3D; \frac{15}{\pi h^6} \cdot (h - r)^3$$</p><p>where:</p><ul><li>( r ) is the distance between two particles.</li><li>( h ) is the searching range in our system which is the neighbour range.</li></ul><p>For $ ( 0 \leq r \leq h ):<br>W_{\text{spiky}}(r, h) &#x3D; \frac{15}{\pi h^6} \cdot (h - r)^3<br>$</p><p>For $( r &gt; h): W_{\text{spiky}}(r, h) &#x3D; 0$</p><p>Using the two kernels to calculate the expected density and gravidence of density. Here is the lamada of each particles. Then another for loop to calculate the buffer distances.</p><p>$$\lambda_i &#x3D; -\frac{C_i(p_1, \dots, p_n)}{\sum_k |\nabla_{p_k} C_i|^2 + \epsilon}$$</p><p>$$\Delta p_{i} &#x3D; \frac{1}{\text{restDistance}} \sum_j (\lambda_i + \lambda_j) \nabla W(p_i - p_j, h)$$</p><p>Where $\nabla W$ is the $\textbf{Spiky Kernel}$. </p><p>Better results were obtained based on density rather than distance. Even if our particles were denser they wouldn’t overlap each other.</p><p><img src="/2024/07/23/CS5310-final-project/15_14.gif" alt="Incompressibility"></p><h2 id="Tensile-Instability"><a href="#Tensile-Instability" class="headerlink" title="Tensile Instability"></a>Tensile Instability</h2><p>When a particle has too few neighbors, it may result in negative pressure and cause particles to clump together. One solution, which adds the effect of surface tension, is to introduce an artificial pressure to the smoothing kernel in order to repulse particles. This corrective term, described by Monaghan:</p><p>$$<br>\text{corr} &#x3D; -k \left(\frac{W(p_i - p_j, h)}{W(\Delta q, h)}\right)^n<br>$$</p><p>The final position update for particle $i$ is then:</p><p>$$<br>\Delta p_i &#x3D; \frac{1}{\rho_0} \sum_j \left(\lambda_i + \lambda_j + \text{corr}\right) \nabla W(p_i - p_j, h)<br>$$</p><p>$\Delta q &#x3D; 0.0</p><p><img src="/2024/07/23/CS5310-final-project/15_13.gif" alt="1000 particles with PBF"></p><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p>[1] <a href="https://github.com/QianMo/Game-Programmer-Study-Notes/blob/master/Content/%E7%9C%9F%E5%AE%9E%E6%84%9F%E6%B0%B4%E4%BD%93%E6%B8%B2%E6%9F%93%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/README.md">https://github.com/QianMo/Game-Programmer-Study-Notes/blob/master/Content/%E7%9C%9F%E5%AE%9E%E6%84%9F%E6%B0%B4%E4%BD%93%E6%B8%B2%E6%9F%93%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93/README.md</a><br>[2] <a href="https://northeastern.instructure.com/courses/180758">https://northeastern.instructure.com/courses/180758</a><br>[3] <a href="https://wikischool.org/divided_light">https://wikischool.org/divided_light</a><br>[4] <a href="https://blog.csdn.net/knight_lyh/article/details/56282584">https://blog.csdn.net/knight_lyh/article/details/56282584</a><br>[5] <a href="https://mmacklin.com/pbf_sig_preprint.pdf">https://mmacklin.com/pbf_sig_preprint.pdf</a><br>[6] <a href="https://blog.csdn.net/qq_36383623/article/details/104872438">https://blog.csdn.net/qq_36383623/article/details/104872438</a><br>[7] <a href="https://www.cs.cmu.edu/~scoros/cs15467-s16/lectures/11-fluids2.pdf">https://www.cs.cmu.edu/~scoros/cs15467-s16/lectures/11-fluids2.pdf</a><br>[8] <a href="http://jamesjia.com/cs184-fluidsim#spiky">http://jamesjia.com/cs184-fluidsim#spiky</a>  </p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>interview script</title>
    <link href="/2023/09/06/interview-script/"/>
    <url>/2023/09/06/interview-script/</url>
    
    <content type="html"><![CDATA[<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" href="http://dotafs.com/rss.xml"><link rel="alternate" type="application/atom+xml" href="http://dotafs.com/atom.xml"><link rel="alternate" type="application/json" href="http://dotafs.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="http://dotafs.com/2024/05/11/interview-script/"><title>interview script - notes | DOTAFS = = 实在即理念，我思故我在。</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 id="interview-script"><a href="#interview-script" class="headerlink" title="interview script"></a>interview script</h1><div class="meta"><span class="item" title="Created: 2024-05-11 15:23:43"><span class="icon"> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2024-05-11T15:23:43-04:00">2024-05-11</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul><li><a href="/">DOTAFS</a></li></ul><p>**</div></nav></div><div id="imgs" class="pjax"></p><p>******</div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"> <span><a href="/">Home</a></span> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/notes/" title="In notes"><span itemprop="name">notes</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="http://dotafs.com/2024/05/11/interview-script/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="DOTAFS"><meta itemprop="description" content="实在即理念，我思故我在。, computer graphic"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""></span><div class="body md" itemprop="articleBody"></p><p>每次收到面试，会发现自己很多问题很基本都已经忘记了，鉴于我这么差的记忆力，总结一份针对于我岗位的面经。</p><p>Overall, topic can seperate to:</p><ul><li>computer grpaphic</li><li>C++,</li><li>hlsl&#x2F;directX12</li><li>graphic card: CUDAROCm ROCm</li><li>internet</li></ul><h1 id="Computer-graphic"><a href="#Computer-graphic" class="headerlink" title="# Computer graphic"></a><a href="#computer-graphic">#</a> Computer graphic</h1><h2 id="graphic-pipeline"><a href="#graphic-pipeline" class="headerlink" title="# graphic pipeline"></a><a href="#graphic-pipeline">#</a> graphic pipeline</h2><p><img src="https://pic4.zhimg.com/80/v2-470a9d8b774085665f07fae572cc933f_1440w.webp" alt="alt text"></p><h3 id="Application-配置基础信息"><a href="#Application-配置基础信息" class="headerlink" title="# Application 配置基础信息"></a><a href="#application-%E9%85%8D%E7%BD%AE%E5%9F%BA%E7%A1%80%E4%BF%A1%E6%81%AF">#</a> Application 配置基础信息</h3><p>在 CPU 完成，该阶段主要是在软件层面上执行的一些工作，包括空间加速算法、视锥剔除、碰撞检测、动画物理模拟等。大体逻辑是：执行视锥剔除，查询出可能需要绘制的图元并生成渲染数据，设置渲染状态和绑定各种 Shader 参数，调用 DrawCall，进入到下一个阶段，GPU 渲染管线。</p><ol><li>Geometry Processing 顶点着色、投影变换、裁剪和屏幕映射阶段。</li><li>Rasterization 光栅化阶段是将图元离散化成片段的过程，其任务是找到需要绘制出的所有片段，包括三角形设定 (图元装配) 和三角形遍历阶段</li><li>像素处理阶段，给每一个像素正确配色，最后绘制出整幅图像，包括像素着色和合并阶段。</li></ol><p>广以上 4 阶段如上，但是 directX12 中有更多。</p><ol><li>Input Assembler Stage</li><li>Vertex Shader Stage</li><li>Tessellation Stage</li><li>Geometry Shader Stage</li><li>Stream Output Stage</li><li>Rasterization Stage</li><li>Pixel Shader Stage</li><li>Output Merger Stage</li></ol><h3 id="空间加速算法-Spatial-Acceleration"><a href="#空间加速算法-Spatial-Acceleration" class="headerlink" title="# 空间加速算法 (Spatial Acceleration)"></a><a href="#%E7%A9%BA%E9%97%B4%E5%8A%A0%E9%80%9F%E7%AE%97%E6%B3%95spatial-acceleration">#</a> 空间加速算法 (Spatial Acceleration)</h3><h4 id="spatial-partition-vs-object-partition"><a href="#spatial-partition-vs-object-partition" class="headerlink" title="# spatial partition vs object partition"></a><a href="#spatial-partition-vs-object-partition">#</a> spatial partition vs object partition</h4><ol><li>spatial paratition seperate space into non-overlapping regions</li></ol><h4 id="基于空间-spatial-partition"><a href="#基于空间-spatial-partition" class="headerlink" title="# 基于空间 (spatial partition)"></a><a href="#%E5%9F%BA%E4%BA%8E%E7%A9%BA%E9%97%B4spatial-partition">#</a> 基于空间 (spatial partition)</h4><ul><li>grid cell (最基本的划分)</li><li>octTree (八叉树，通常以空间内最多两个物体结束) 简化版 KD tree<br><img src="https://dotafs.com/2022/12/19/grapic-review/10_1.jpeg" alt="alt text"></li><li>KD tree 假设 k 纬空间内，有很多个物体。<br><img src="https://pic1.zhimg.com/80/v2-6da7b9cfacb3ba59399ae3c50527ce00_1440w.webp" alt="alt text"></li></ul><h4 id="基于物体"><a href="#基于物体" class="headerlink" title="# 基于物体"></a><a href="#%E5%9F%BA%E4%BA%8E%E7%89%A9%E4%BD%93">#</a> 基于物体</h4><ul><li>AABB: box, 横平竖直的，Parallel xyz, 还有别的比如 Oriented Bounding Boxes (带角度的), 或者是球形的</li><li>Uniform Grids<br><img src="https://pic2.zhimg.com/80/v2-eb4775aaf4b0259b87b5c0fd39ad9239_720w.webp" alt="alt text"></li><li>BVH(Bounding Volume Hierarchy)<br><img src="https://dotafs.com/2022/12/19/grapic-review/10_2.jpeg" alt="alt text"></li></ul><h3 id="视锥剔除-View-frustum-culling"><a href="#视锥剔除-View-frustum-culling" class="headerlink" title="# 视锥剔除 (View frustum culling)"></a><a href="#%E8%A7%86%E9%94%A5%E5%89%94%E9%99%A4view-frustum-culling">#</a> 视锥剔除 (View frustum culling)</h3><p>在经过 spatial acceleration 后物体有了边界。<br><img src="https://pic2.zhimg.com/80/v2-11dadf9c147c3c7def0c642e635ed559_1440w.webp" alt="alt text"></p><h2 id="shaders-着色器"><a href="#shaders-着色器" class="headerlink" title="# shaders (着色器)"></a><a href="#shaders%E7%9D%80%E8%89%B2%E5%99%A8">#</a> shaders (着色器)</h2><h3 id="顶点着色器（Vertex-Shader）："><a href="#顶点着色器（Vertex-Shader）：" class="headerlink" title="# 顶点着色器（Vertex Shader）："></a><a href="#%E9%A1%B6%E7%82%B9%E7%9D%80%E8%89%B2%E5%99%A8vertex-shader">#</a> 顶点着色器（Vertex Shader）：</h3><ul><li>顶点着色器是渲染管线中的第一个阶段，负责处理每个顶点的信息。</li><li>它的主要功能是处理顶点数据（如坐标、颜色、纹理坐标等）并进行顶点的变换、裁剪和其他顶点级操作。</li><li>比如，它可以将顶点从模型空间（Model Space）转换到裁剪空间（Clip Space）。</li></ul><h3 id="曲面细分着色器（Tessellation-Shader）："><a href="#曲面细分着色器（Tessellation-Shader）：" class="headerlink" title="# 曲面细分着色器（Tessellation Shader）："></a><a href="#%E6%9B%B2%E9%9D%A2%E7%BB%86%E5%88%86%E7%9D%80%E8%89%B2%E5%99%A8tessellation-shader">#</a> 曲面细分着色器（Tessellation Shader）：</h3><ul><li>这类着色器通常用于根据某些准则对几何体进行细分，从而增加模型的复杂度和细节。</li><li>它包括曲面细分控制着色器（Hull Shader）和曲面细分评估着色器（Domain Shader）。</li><li>控制着色器决定如何细分几何体，而评估着色器处理细分后的顶点位置。</li></ul><h3 id="几何着色器（Geometry-Shader）："><a href="#几何着色器（Geometry-Shader）：" class="headerlink" title="# 几何着色器（Geometry Shader）："></a><a href="#%E5%87%A0%E4%BD%95%E7%9D%80%E8%89%B2%E5%99%A8geometry-shader">#</a> 几何着色器（Geometry Shader）：</h3><ul><li>几何着色器接受整个图元（如三角形、线、点）作为输入。</li><li>它可以生成新图元或者对输入的图元进行变换。</li><li>这个着色器可以用于实现一些复杂的效果，如体积阴影、粒子系统等。</li></ul><h3 id="片段着色器（Fragment-Shader）："><a href="#片段着色器（Fragment-Shader）：" class="headerlink" title="# 片段着色器（Fragment Shader）："></a><a href="#%E7%89%87%E6%AE%B5%E7%9D%80%E8%89%B2%E5%99%A8fragment-shader">#</a> 片段着色器（Fragment Shader）：</h3><ul><li>像素着色器处理图元光栅化后生成的每个片段。</li><li>它的主要任务是确定最终像素的颜色和其他属性（如深度、透明度等）。</li><li>这个阶段常用于实现各种像素级效果，如纹理映射、光照和阴影处理等。</li></ul><h3 id="计算着色器（Compute-Shader）："><a href="#计算着色器（Compute-Shader）：" class="headerlink" title="# 计算着色器（Compute Shader）："></a><a href="#%E8%AE%A1%E7%AE%97%E7%9D%80%E8%89%B2%E5%99%A8compute-shader">#</a> 计算着色器（Compute Shader）：</h3><ul><li>计算着色器并非直接用于常规的图形渲染流程，而是用于处理广泛的非图形计算任务。</li><li>它们可以用来进行复杂的数学和物理计算，比如粒子系统的模拟、物理效果的计算等。</li></ul><p>大量创建线程，计算不涉及直接渲染的任务，更加自由的数据访问或者处理数据，不受限于特定的阶段。</p><p>这段代码定义了一个计算着色器，它接受一个输入数组，并将每个元素的值增加 1。numthreads (1, 1, 1) 声明了每个线程组包含的线程数目。DTid 是当前线程的索引。</p><pre><code class="hljs">// SimpleComputeShader.hlsl// 定义线程组的大小，这里设为1x1x1，可以根据需要调整。[numthreads(1, 1, 1)]void CSMain(uint3 DTid : SV_DispatchThreadID)&amp;#123;    // 这里只是一个示例：每个线程将输入数组的对应值增加1    data[DTid.x] += 1;&amp;#125;```C++ID3DBlob* csBlob = nullptr;D3DCompile(shaderSource, strlen(shaderSource), nullptr, nullptr, nullptr, &amp;quot;CSMain&amp;quot;, &amp;quot;cs_5_0&amp;quot;, 0, 0, &amp;amp;csBlob, nullptr);`&lt;/pre&gt;</code></pre><ol><li><p>创建计算管线状态对象<pre><code class="hljs">D3D12_COMPUTE_PIPELINE_STATE_DESC psoDesc = &amp;#123;&amp;#125;; psoDesc.CS = &amp;#123;reinterpret_cast&amp;lt;BYTE*&amp;gt;(csBlob-&amp;gt;GetBufferPointer()), csBlob-&amp;gt;GetBufferSize()&amp;#125;; device-&amp;gt;CreateComputePipelineState(&amp;amp;psoDesc, IID_PPV_ARGS(&amp;amp;pipelineState)); </code></pre></p></li><li><p>创建并绑定资源<pre>`// 创建缓冲区资源并上传数据<br>D3D12_RESOURCE_DESC bufferDesc = CD3DX12_RESOURCE_DESC::Buffer(dataSize);<br>ID3D12Resource* buffer;<br>device-&gt;CreateCommittedResource(&amp;heapProperties, D3D12_HEAP_FLAG_NONE, &amp;bufferDesc, D3D12_RESOURCE_STATE_COPY_DEST, nullptr, IID_PPV_ARGS(&amp;buffer));</p><p>D3D12_SUBRESOURCE_DATA bufferData = &#123;&#125;;<br>bufferData.pData = data;<br>bufferData.RowPitch = dataSize;<br>bufferData.SlicePitch = bufferData.RowPitch;<br>UpdateSubresources(commandList, buffer, uploadBuffer, 0, 0, 1, &amp;bufferData);</p><p>// 设置计算根签名和描述符<br>commandList-&gt;SetPipelineState(pipelineState);<br>commandList-&gt;SetComputeRootSignature(rootSignature);<br>commandList-&gt;SetComputeRootShaderResourceView(0, buffer-&gt;GetGPUVirtualAddress());<br>commandList-&gt;Dispatch(2, 2, 1);<br>`</pre></p><h2 id="light-mapping-光照贴图"><a href="#light-mapping-光照贴图" class="headerlink" title="# light mapping (光照贴图)"></a><a href="#light-mapping%E5%85%89%E7%85%A7%E8%B4%B4%E5%9B%BE">#</a> light mapping (光照贴图)</h2><h2 id="光照模型-illumination-model"><a href="#光照模型-illumination-model" class="headerlink" title="# 光照模型 (illumination model)"></a><a href="#%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8Billumination-model">#</a> 光照模型 (illumination model)</h2><h3 id="局部光照模型-local-illumination-model"><a href="#局部光照模型-local-illumination-model" class="headerlink" title="# 局部光照模型 (local illumination model)"></a><a href="#%E5%B1%80%E9%83%A8%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8Blocal-illumination-model">#</a> 局部光照模型 (local illumination model)</h3><p>仅处理光源直接照射物体表面，不考虑其他反射。</p></li></ol><ul><li><p>Lambert reflectance model: 所有方向上均匀的散射光，不考虑 viewpoint, 所以没有 specular highlight.</p><pre><code class="hljs">*   &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;θ&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;I = I_0cos(\theta)&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:.68333em;vertical-align:0&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathnormal&quot; style=&quot;margin-right:.07847em&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2777777777777778em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2777777777777778em&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:1em;vertical-align:-.25em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathnormal&quot; style=&quot;margin-right:.07847em&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.30110799999999993em&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:-.07847em;margin-right:.05em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.15em&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mord mathnormal&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;mord mathnormal&quot;&gt;o&lt;/span&gt;&lt;span class=&quot;mord mathnormal&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;mopen&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mord mathnormal&quot; style=&quot;margin-right:.02778em&quot;&gt;θ&lt;/span&gt;&lt;span class=&quot;mclose&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</code></pre><ul><li>3 points (not in a same line) in a polygonal <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>P</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>P</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">P_0, P_1, P_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8777699999999999em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.13889em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.13889em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.13889em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>. normal: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi>n</mi><mo>⃗</mo></mover><mo>&#x3D;</mo><mo stretchy="false">(</mo><msub><mi>P</mi><mn>1</mn></msub><mo>−</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo>×</mo><mo stretchy="false">(</mo><msub><mi>P</mi><mn>2</mn></msub><mo>−</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\vec n &#x3D; (P_1 - P_0) \times (P_2 - P_0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.714em;vertical-align:0"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.714em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">n</span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-.2355em"><span class="overlay" style="height:.714em;width:.471em"><svg width="0.471em" height="0.714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&#x3D;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.13889em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.13889em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.13889em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.13889em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li></ul></li><li><p>Phong reflectance model: specular highlight, diffuse light, ambient light (就是直接设置个值).</p><pre><code class="hljs">*   &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo separator=&quot;true&quot;&gt;,&lt;/mo&gt;&lt;mover accent=&quot;true&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;⃗&lt;/mo&gt;&lt;/mover&gt;&lt;mo&gt;⋅&lt;/mo&gt;&lt;mover accent=&quot;true&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;⃗&lt;/mo&gt;&lt;/mover&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mover accent=&quot;true&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo&gt;⃗&lt;/mo&gt;&lt;/mover&gt;&lt;mo&gt;⋅&lt;/mo&gt;&lt;mover accent=&quot;true&quot;&gt;&lt;mi&gt;v&lt;/mi&gt;&lt;mo&gt;⃗&lt;/mo&gt;&lt;/mover&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msup&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;I = I_a + I_d + I_s = k_aL_a + K_dmax(0,\vec n \cdot \vec l)L_d + k_s(\vec r \cdot \vec v)^sL_s&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:.68333em;vertical-align:0&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathnormal&quot; style=&quot;margin-right:.07847em&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2777777777777778em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2777777777777778em&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:.83333em;vertical-align:-.15em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathnormal&quot; style=&quot;margin-right:.07847em&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.151392em&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:-.07847em;margin-right:.05em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathnormal mtight&quot;&gt;a&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.15em&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2222222222222222em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2222222222222222em&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:.83333em;vertical-align:-.15em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathnormal&quot; style=&quot;margin-right:.07847em&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.33610799999999996em&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:-.07847em;margin-right:.05em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathnormal mtight&quot;&gt;d&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.15em&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2222222222222222em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2222222222222222em&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:.83333em;vertical-align:-.15em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathnormal&quot; style=&quot;margin-right:.07847em&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.151392em&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:-.07847em;margin-right:.05em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathnormal mtight&quot;&gt;s&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.15em&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2777777777777778em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2777777777777778em&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:.84444em;vertical-align:-.15em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathnormal&quot; style=&quot;margin-right:.03148em&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.151392em&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathnormal mtight&quot;&gt;a&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.15em&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathnormal&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.151392em&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0;margin-right:.05em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathnormal mtight&quot;&gt;a&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.15em&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2222222222222222em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2222222222222222em&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:1em;vertical-align:-.25em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathnormal&quot; style=&quot;margin-right:.07153em&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.33610799999999996em&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathnormal mtight&quot;&gt;d&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.15em&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mord mathnormal&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;mord mathnormal&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;mord mathnormal&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;mopen&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;mpunct&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.16666666666666666em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord accent&quot;&gt;&lt;span class=&quot;vlist-t&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.714em&quot;&gt;&lt;span style=&quot;top:-3em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathnormal&quot;&gt;n&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;accent-body&quot; style=&quot;left:-.2355em&quot;&gt;&lt;span class=&quot;overlay&quot; style=&quot;height:.714em;width:.471em&quot;&gt;&lt;svg width=&quot;0.471em&quot; height=&quot;0.714em&quot; style=&quot;width:.471em&quot; viewBox=&quot;0 0 471 714&quot; preserveAspectRatio=&quot;xMinYMin&quot;&gt;&lt;path d=&quot;M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5</code></pre><p>3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11<br>10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63<br>-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1<br>-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59<br>H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359<br>c-16-25.333-24-45-24-59z”&#x2F;&gt;</svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.2274399999999999em;vertical-align:-.25em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.9774399999999999em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:.01968em">l</span></span><span style="top:-3.26344em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-.15216em"><span class="overlay" style="height:.714em;width:.471em"><svg width="0.471em" height="0.714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.714em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-.17994em"><span class="overlay" style="height:.714em;width:.471em"><svg width="0.471em" height="0.714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.714em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:.03588em">v</span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-.20772em"><span class="overlay" style="height:.714em;width:.471em"><svg width="0.471em" height="0.714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.664392em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span></p></li><li><p>Blinn-Phong reflectance model: specular 分量采用半角计算。正确性比 Phong 低，但是效率高。半程向量 (Halfway vector)。就是入射光线向量 L 和观察方向 V 的中间位置 (角平分线)。Blinn-Phong 求 highlight intensity 的时候使用 halfway vector 和 normal vector 的 dot product 来决定 highlight intensity。Phong 是用 reflection light 和 viewpoint vector 的 dot product 来决定。</p><pre><code class="hljs">*   &lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;I&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo separator=&quot;true&quot;&gt;,&lt;/mo&gt;&lt;mover accent=&quot;true&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;⃗&lt;/mo&gt;&lt;/mover&gt;&lt;mo&gt;⋅&lt;/mo&gt;&lt;mover accent=&quot;true&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mo&gt;⃗&lt;/mo&gt;&lt;/mover&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mover accent=&quot;true&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;⃗&lt;/mo&gt;&lt;/mover&gt;&lt;mo&gt;⋅&lt;/mo&gt;&lt;mover accent=&quot;true&quot;&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;mo&gt;⃗&lt;/mo&gt;&lt;/mover&gt;&lt;msup&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msup&gt;&lt;msub&gt;&lt;mi&gt;L&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;I = I_a + I_d + I_s = k_aL_a + K_dmax(0,\vec n \cdot \vec l)L_d + k_s(\vec n \cdot \vec h)^sL_s&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:.68333em;vertical-align:0&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathnormal&quot; style=&quot;margin-right:.07847em&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2777777777777778em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2777777777777778em&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:.83333em;vertical-align:-.15em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathnormal&quot; style=&quot;margin-right:.07847em&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.151392em&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:-.07847em;margin-right:.05em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathnormal mtight&quot;&gt;a&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.15em&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2222222222222222em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2222222222222222em&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:.83333em;vertical-align:-.15em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathnormal&quot; style=&quot;margin-right:.07847em&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.33610799999999996em&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:-.07847em;margin-right:.05em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathnormal mtight&quot;&gt;d&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.15em&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2222222222222222em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2222222222222222em&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:.83333em;vertical-align:-.15em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathnormal&quot; style=&quot;margin-right:.07847em&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.151392em&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:-.07847em;margin-right:.05em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathnormal mtight&quot;&gt;s&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.15em&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2777777777777778em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2777777777777778em&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:.84444em;vertical-align:-.15em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathnormal&quot; style=&quot;margin-right:.03148em&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.151392em&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathnormal mtight&quot;&gt;a&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.15em&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathnormal&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.151392em&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:0;margin-right:.05em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathnormal mtight&quot;&gt;a&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.15em&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2222222222222222em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.2222222222222222em&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:1em;vertical-align:-.25em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathnormal&quot; style=&quot;margin-right:.07153em&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.33610799999999996em&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:-.07153em;margin-right:.05em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mathnormal mtight&quot;&gt;d&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.15em&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mord mathnormal&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;mord mathnormal&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;mord mathnormal&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;mopen&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;mpunct&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:.16666666666666666em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord accent&quot;&gt;&lt;span class=&quot;vlist-t&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:.714em&quot;&gt;&lt;span style=&quot;top:-3em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathnormal&quot;&gt;n&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3em&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em&quot;&gt;&lt;/span&gt;&lt;span class=&quot;accent-body&quot; style=&quot;left:-.2355em&quot;&gt;&lt;span class=&quot;overlay&quot; style=&quot;height:.714em;width:.471em&quot;&gt;&lt;svg width=&quot;0.471em&quot; height=&quot;0.714em&quot; style=&quot;width:.471em&quot; viewBox=&quot;0 0 471 714&quot; preserveAspectRatio=&quot;xMinYMin&quot;&gt;&lt;path d=&quot;M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5</code></pre><p>3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11<br>10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63<br>-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1<br>-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59<br>H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359<br>c-16-25.333-24-45-24-59z”&#x2F;&gt;</svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.2274399999999999em;vertical-align:-.25em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.9774399999999999em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal" style="margin-right:.01968em">l</span></span><span style="top:-3.26344em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-.15216em"><span class="overlay" style="height:.714em;width:.471em"><svg width="0.471em" height="0.714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.33610799999999996em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.03148em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.714em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">n</span></span><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-.2355em"><span class="overlay" style="height:.714em;width:.471em"><svg width="0.471em" height="0.714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.2274399999999999em;vertical-align:-.25em"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.9774399999999999em"><span style="top:-3em"><span class="pstrut" style="height:3em"></span><span class="mord mathnormal">h</span></span><span style="top:-3.26344em"><span class="pstrut" style="height:3em"></span><span class="accent-body" style="left:-.2355em"><span class="overlay" style="height:.714em;width:.471em"><svg width="0.471em" height="0.714em" style="width:.471em" viewBox="0 0 471 714" preserveAspectRatio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 53.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 1110.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359c-16-25.333-24-45-24-59z"/></svg></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.664392em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span></p><h3 id="全局光照模型-global-illumination-model"><a href="#全局光照模型-global-illumination-model" class="headerlink" title="# 全局光照模型 (global illumination model)"></a><a href="#%E5%85%A8%E5%B1%80%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8Bglobal-illumination-model">#</a> 全局光照模型 (global illumination model)</h3><h2 id="ray-tracing"><a href="#ray-tracing" class="headerlink" title="# ray tracing"></a><a href="#ray-tracing">#</a> ray tracing</h2><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//Whitted-Style Ray Tracing</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">RayTracing</span><span class="token punctuation">(</span>Point origin<span class="token punctuation">,</span>Vector3 direction<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">Intersect</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span>direction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        hitPoint <span class="token operator">=</span> <span class="token function">GetHitPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        normal <span class="token operator">=</span> <span class="token function">GetHitNormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        localColor <span class="token operator">=</span> <span class="token function">BlinnPhongShader</span><span class="token punctuation">(</span>direction<span class="token punctuation">,</span>hitpoint<span class="token punctuation">,</span>normal<span class="token punctuation">,</span>light<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>hitPoint is a diffuse sufface<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token keyword">return</span> localColor<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">else</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token keyword">return</span> localColor</pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token operator">+</span>k1<span class="token operator">*</span><span class="token function">RayTracing</span><span class="token punctuation">(</span>hitPoint<span class="token punctuation">,</span><span class="token function">reflect</span><span class="token punctuation">(</span>direction<span class="token punctuation">,</span>normal<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                <span class="token operator">+</span>k2<span class="token operator">*</span><span class="token function">RayTracing</span><span class="token punctuation">(</span>hitPoint<span class="token punctuation">,</span><span class="token function">refract</span><span class="token punctuation">(</span>direction<span class="token punctuation">,</span>normal<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">return</span> the color of background<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// simplicity of monte carlo path tracing</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">RayTracing</span><span class="token punctuation">(</span>Point p<span class="token punctuation">,</span>Vector3 wr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    Randomly choose N directions wi<span class="token operator">~</span>pdf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    Lr <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">for</span><span class="token punctuation">(</span>each wi<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        Trace a ray <span class="token function">r</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> wi<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">if</span><span class="token punctuation">(</span>ray r hit the light<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            Lr <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> N<span class="token punctuation">)</span> <span class="token operator">*</span> L_i <span class="token operator">*</span> f_r <span class="token operator">*</span> cosine <span class="token operator">/</span> <span class="token function">pdf</span><span class="token punctuation">(</span>wi<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ray r hit an object at q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            Lr <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> N<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">RayTracing</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> <span class="token operator">-</span>wi<span class="token punctuation">)</span> <span class="token operator">*</span> f_r <span class="token operator">*</span> cosine <span class="token operator">/</span> <span class="token function">pdf</span><span class="token punctuation">(</span>wi<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">return</span> Lr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 防止爆炸的 monte carlo path tracing</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">RayTracing</span><span class="token punctuation">(</span>Point p<span class="token punctuation">,</span>Vector3 wr<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    Randomly choose <span class="token number">1</span> directions wi<span class="token operator">~</span><span class="token function">pdf</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    Lr <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    Trace a ray <span class="token function">r</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> wi<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>ray r hit the light<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        Lr <span class="token operator">+=</span> L_i <span class="token operator">*</span> f_r <span class="token operator">*</span> cosine <span class="token operator">/</span> <span class="token function">pdf</span><span class="token punctuation">(</span>wi<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ray r hit an object at q<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        Lr <span class="token operator">+=</span> <span class="token function">RayTracing</span><span class="token punctuation">(</span>q<span class="token punctuation">,</span> <span class="token operator">-</span>wi<span class="token punctuation">)</span> <span class="token operator">*</span> f_r <span class="token operator">*</span> cosine <span class="token operator">/</span> <span class="token function">pdf</span><span class="token punctuation">(</span>wi<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> Lr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="render-equation"><a href="#render-equation" class="headerlink" title="# render equation"></a><a href="#render-equation">#</a> render equation</h2><p><img src="https://dotafs.com/2022/12/19/grapic-review/4_8.jpeg" alt="alt text"></p><h2 id="deferred-rendering"><a href="#deferred-rendering" class="headerlink" title="# deferred rendering"></a><a href="#deferred-rendering">#</a> deferred rendering</h2><p><img src="https://pic2.zhimg.com/80/v2-e83fa8edf3981225b844c6c8125e84e5_1440w.webp" alt="alt text"></p><h3 id="forward-rendering"><a href="#forward-rendering" class="headerlink" title="# forward rendering"></a><a href="#forward-rendering">#</a> forward rendering</h3><p><img src="https://pic3.zhimg.com/80/v2-ebdfe17363facdadb088bb8f2b2683e2_1440w.webp" alt="alt text"><br>Forward Rendering: 在场景中我们根据所有光源照亮一个物体，之后再渲染下一个物体，以此类推<br>drawback: 因为大部分片段着色器的输出都会被之后的输出覆盖。<br>Deferred rendering 本质就是 defer 计算大的比如光照放到最后处理。</p></li><li><p>one pass:</p><p><img src="https://learnopengl-cn.github.io/img/05/08/deferred_g_buffer.png" alt="alt text"></p></li><li><p>second pass(lighting pass):<br>深度测试已经完毕，针对像素处理光照，而不是几何体。</p><p>drawback:</p></li></ul><ol><li><p>消耗大量显存</p></li><li><p>不支持混色 (blending) 即使 Alpha 通道或混合信息整合进 G-buffer，这通常会导致需要更多的带宽和内存，进而影响渲染性能。同时，混合操作（如 Alpha blending）通常需要多次读写同一个像素，这在延迟渲染的光照计算中是低效的。</p><pre><code class="hljs">1.  使用前向渲染处理透明物体：在使用延迟渲染处理场景的不透明部分后，再用前向渲染方式渲染透明物体。</code></pre><ol start="2"><li>混合延迟渲染：结合使用延迟和前向渲染技术，例如，将透明效果或特定的光照效果保留在前向渲染路径中处理。</li></ol><h2 id="shadow"><a href="#shadow" class="headerlink" title="# shadow"></a><a href="#shadow">#</a> shadow</h2></li></ol><ul><li><p>Lightmap: 沿着光源方向 bake 一个物体，offline rendering, 把结果放在 texture map。缺点只能放 diffuse，没法放 specular。并且没法动态阴影。</p></li><li><p>Shadowmap: two pass, 光源的位置渲染一遍场景<br>第一个 pass，切换到以光源为视点的观察坐标系中，利用帧缓冲生成一张深度图 DepthMap<br>第二个 pass，正常渲染，对渲染的每一个 fragment 做可见性判断，得到一个非零即一的 visibility<br>将 shading point 通过第一个 pass 的变换得到的深度值和 epthMap 中记录的对应位置的深度值作比较<br>如果 DepthMap 中记录的值小，说明当前的点对光源不可见，visibility&#x3D;0<br>否则 visibility&#x3D;1<br>用 visibility 乘上当前点的直接光照，进行遮蔽效果<br>在实现上可以使用定向光做平行投影生成 DepthMap，也可以使用点光源做透视投影生成 DepthMap</p></li><li><p>pcf（percentage closer filtering）本是用于做抗锯齿的算法，后常被用于软阴影的实现。pcf 的做法：在取 shading point 到光源的距离与 shadow map 进行比较时，不仅仅只取一个点，而是取周围范围的点，多次取平均，得到 visbility 值。例如周围九个点比较结果分别为：1,0,1,1,0,1,1,1,0，那么可见性即为 0.667。</p></li><li><p>pcss（percentage closer soft shadow）：我们知道往往阴影的接收物与投射物的距离越近，则阴影越硬，反之，阴影就越 “软”，pcss 正是基于这个思路去实现的。</p></li><li><p>vsm（variance soft shadow mapping）：本质上可以理解为是一种对 pcss 的加速，避免了第一步和第三步中的采样。用切比雪夫测试的方式直接判断当前深度在区域范围内排序的百分比，相当于我们就直接得到了 visbility 值，这样的做法避免了大量的采样，加速了整个过程。</p></li><li><p>sdf 阴影：如下图所示，简单来说，是从 shading point 出发沿着灯光方向进行 ray marching，可以根据 sdf 提供的距离信息进行步进 step 优化，最终得到一个安全角度，该安全角度越小，则越暗，安全角度越大，则越亮。</p><h3 id="CSM"><a href="#CSM" class="headerlink" title="# CSM:"></a><a href="#csm">#</a> CSM:</h3><p>是一种用于在大范围场景中生成高质量阴影的技术。它通过将场景分割成多个级联区域，每个区域使用单独的阴影贴图来提高阴影的细节和分辨率。</p></li></ul><ol><li><p>分割视锥体：<br>将摄像机的视锥体沿深度方向分割成多个区间（级联）。<br>每个级联区间对应一个不同的深度范围，这样可以在近处使用高分辨率的阴影贴图，在远处使用低分辨率的阴影贴图。</p></li><li><p>计算每个级联的正交投影矩阵：<br>对每个级联区间，计算出包含该区间的正交投影矩阵，以便生成阴影贴图。<br>需要考虑光源方向，以确定正交投影的范围和位置。</p></li><li><p>渲染阴影贴图：<br>对每个级联区间，从光源的视角渲染场景深度，生成对应的阴影贴图。<br>这些阴影贴图记录了场景中各个物体的深度信息。</p></li><li><p>应用阴影贴图：<br>在主渲染通道中，根据摄像机视角，将不同级联的阴影贴图应用到场景中。<br>使用多个级联阴影贴图可以在近处保留细节，并在远处节省计算资源。</p></li><li><p>处理阴影边界：<br>为了避免级联之间的明显边界，通常使用过渡区或模糊处理。<br>通过对相邻级联区域的阴影贴图进行平滑过渡，可以减少视觉上的突兀感。</p><h2 id="PBR"><a href="#PBR" class="headerlink" title="# PBR"></a><a href="#pbr">#</a> PBR</h2><p>物理基础渲染（Physically Based Rendering，简称 PBR）是一种更加逼真地模拟光照和材质的渲染方法。PBR 基于物理学原理，使得渲染结果更加一致和真实。PBR 的核心思想是通过模拟光线和材质的物理交互来生成图像。</p><h3 id="PBR-概念"><a href="#PBR-概念" class="headerlink" title="# PBR 概念"></a><a href="#pbr%E6%A6%82%E5%BF%B5">#</a> PBR 概念</h3><h3 id="1-BRDF（双向反射分布函数）"><a href="#1-BRDF（双向反射分布函数）" class="headerlink" title="# 1. BRDF（双向反射分布函数）"></a><a href="#1-brdf%E5%8F%8C%E5%90%91%E5%8F%8D%E5%B0%84%E5%88%86%E5%B8%83%E5%87%BD%E6%95%B0">#</a> 1. <strong>BRDF（双向反射分布函数）</strong></h3><p>BRDF 描述了光线如何从一个表面反射出去。PBR 使用物理上正确的 BRDF 来计算反射光线的方向和强度。常见的 BRDF 模型包括 Lambertian（漫反射）和 Cook-Torrance（镜面反射）。</p><h3 id="2-能量守恒"><a href="#2-能量守恒" class="headerlink" title="# 2. 能量守恒"></a><a href="#2-%E8%83%BD%E9%87%8F%E5%AE%88%E6%81%92">#</a> 2. <strong>能量守恒</strong></h3><p>PBR 保证了能量守恒，即材质反射的光量不会超过入射的光量。这一原则确保了材质在不同光照条件下都能表现得一致。</p><h3 id="3-微表面理论"><a href="#3-微表面理论" class="headerlink" title="# 3. 微表面理论"></a><a href="#3-%E5%BE%AE%E8%A1%A8%E9%9D%A2%E7%90%86%E8%AE%BA">#</a> 3. <strong>微表面理论</strong></h3><p>微表面理论假设一个表面由许多微小的镜面组成。这些微小的镜面随机分布，使得光线以不同角度反射，从而形成材质的粗糙度和高光特性。</p><h3 id="PBR-的主要参数"><a href="#PBR-的主要参数" class="headerlink" title="# PBR 的主要参数"></a><a href="#pbr-%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8F%82%E6%95%B0">#</a> PBR 的主要参数</h3><h4 id="1-Albedo（反照率）"><a href="#1-Albedo（反照率）" class="headerlink" title="# 1. Albedo（反照率）"></a><a href="#1-albedo%E5%8F%8D%E7%85%A7%E7%8E%87">#</a> 1. <strong>Albedo（反照率）</strong></h4><p>Albedo 是材质的基本颜色，表示在没有光照影响下的颜色。它不包含阴影、镜面反射等因素。</p><h4 id="2-Metalness（金属性）"><a href="#2-Metalness（金属性）" class="headerlink" title="# 2. Metalness（金属性）"></a><a href="#2-metalness%E9%87%91%E5%B1%9E%E6%80%A7">#</a> 2. <strong>Metalness（金属性）</strong></h4><p>Metalness 参数定义材质的金属特性。金属材质具有高反射率和无透射率，反照率通常接近黑色。非金属材质则具有较低的反射率和一定的透射率。</p><h4 id="3-Roughness（粗糙度）"><a href="#3-Roughness（粗糙度）" class="headerlink" title="# 3. Roughness（粗糙度）"></a><a href="#3-roughness%E7%B2%97%E7%B3%99%E5%BA%A6">#</a> 3. <strong>Roughness（粗糙度）</strong></h4><p>Roughness 描述了表面的光滑程度。低粗糙度的表面光滑且反射清晰，高粗糙度的表面则粗糙且反射模糊。</p><h4 id="4-Normal-Map（法线贴图）"><a href="#4-Normal-Map（法线贴图）" class="headerlink" title="# 4. Normal Map（法线贴图）"></a><a href="#4-normal-map%E6%B3%95%E7%BA%BF%E8%B4%B4%E5%9B%BE">#</a> 4. <strong>Normal Map（法线贴图）</strong></h4><p>法线贴图用于模拟细节纹理和凹凸效果，影响光线的反射方向，增加视觉细节。</p><h4 id="5-Ambient-Occlusion（环境光遮蔽）"><a href="#5-Ambient-Occlusion（环境光遮蔽）" class="headerlink" title="# 5. Ambient Occlusion（环境光遮蔽）"></a><a href="#5-ambient-occlusion%E7%8E%AF%E5%A2%83%E5%85%89%E9%81%AE%E8%94%BD">#</a> 5. <strong>Ambient Occlusion（环境光遮蔽）</strong></h4><p>环境光遮蔽用于模拟由于遮挡导致的局部阴影效果，增强视觉深度。</p><h3 id="PBR-工作流程"><a href="#PBR-工作流程" class="headerlink" title="# PBR 工作流程"></a><a href="#pbr-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">#</a> PBR 工作流程</h3></li><li><p><strong>定义材质属性</strong><br>使用 Albedo、Metalness、Roughness 等参数来定义材质的物理特性。</p></li><li><p><strong>光照计算</strong><br>通过光照模型（如直接光源、环境光等）计算每个像素的光照强度。</p></li><li><p><strong>BRDF 计算</strong><br>根据 BRDF 模型和材质参数，计算光线在表面上的反射。</p></li><li><p><strong>合成最终图像</strong><br>将光照计算结果和材质反射计算结果合成，生成最终的渲染图像。</p><h3 id="Cook-Torrance"><a href="#Cook-Torrance" class="headerlink" title="# Cook-Torrance"></a><a href="#cook-torrance">#</a> Cook-Torrance</h3></li></ol><ul><li><p>计算微表面分布函数（D）：选择适当的分布模型（如 GGX），根据表面粗糙度计算微表面分布。</p></li><li><p>计算几何遮蔽 &#x2F; 阴蔽函数（G）：选择几何函数（如 Schlick-GGX），根据表面粗糙度和光照角度计算遮蔽和阴蔽效果。</p></li><li><p>计算菲涅耳方程（F）：使用 Schlick 近似，根据入射角和材料的折射率计算菲涅耳反射。</p></li><li><p>组合以上组件：将 D、G 和 F 结合起来，计算最终的反射和折射强度。</p><h4 id="Cook-Torrance-模型的优点"><a href="#Cook-Torrance-模型的优点" class="headerlink" title="# Cook-Torrance 模型的优点"></a><a href="#cook-torrance-%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BC%98%E7%82%B9">#</a> Cook-Torrance 模型的优点</h4></li><li><p>物理准确性：考虑了微表面的结构和光的物理特性，能够生成高度真实的反射和折射效果。</p></li><li><p>一致性：在不同光照条件下表现一致，使得材质在不同场景中具有一致的视觉效果。</p></li><li><p>灵活性：可以通过调整微表面分布函数、几何函数和菲涅耳方程的参数来模拟不同类型的材质，如金属、塑料等。</p><h2 id="MVP"><a href="#MVP" class="headerlink" title="# MVP"></a><a href="#mvp">#</a> MVP</h2><h3 id="MVP-矩阵公式推导"><a href="#MVP-矩阵公式推导" class="headerlink" title="# MVP 矩阵公式推导"></a><a href="#mvp-%E7%9F%A9%E9%98%B5%E5%85%AC%E5%BC%8F%E6%8E%A8%E5%AF%BC">#</a> MVP 矩阵公式推导</h3></li></ul><ol><li><p><strong>模型矩阵 (Model Matrix, M)</strong><br>模型矩阵将对象坐标变换到世界坐标系。假设对象有一个平移变换和一个旋转变换，模型矩阵可以表示为：<br><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mo>&#x3D;</mo><mi>T</mi><mo>⋅</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">M &#x3D; T \cdot R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.10903em">M</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&#x3D;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span></span></span></span></span><br>其中 (T) 是平移矩阵，( R ) 是旋转矩阵。具体形式如下：<br>平移矩阵 (T):<br><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>T</mi><mo>&#x3D;</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>x</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>z</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">T &#x3D; \begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; x \ 0 &amp; 1 &amp; 0 &amp; y \ 0 &amp; 0 &amp; 1 &amp; z \ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.13889em">T</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&#x3D;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em"><span style="top:-1.6499900000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.79999em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.3959900000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.4119800000000002em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.653em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em"><span style="top:-4.8100000000000005em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em"><span style="top:-4.8100000000000005em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em"><span style="top:-4.8100000000000005em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em"><span style="top:-4.8100000000000005em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.04398em">z</span></span></span><span style="top:-1.2099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em"><span style="top:-1.6499900000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.79999em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.3959900000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.4119800000000002em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.653em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em"><span></span></span></span></span></span></span></span></span></span></span></span><br>旋转矩阵 (R)（例如绕 z 轴旋转）:<br><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>R</mi><mo>&#x3D;</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>cos</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">R &#x3D; \begin{bmatrix} \cos \theta &amp; -\sin \theta &amp; 0 &amp; 0 \ \sin \theta &amp; \cos \theta &amp; 0 &amp; 0 \ 0 &amp; 0 &amp; 1 &amp; 0 \ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&#x3D;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em"><span style="top:-1.6499900000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.79999em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.3959900000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.4119800000000002em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.653em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em"><span style="top:-4.8100000000000005em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.02778em">θ</span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mop">sin</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.02778em">θ</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em"><span style="top:-4.8100000000000005em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">−</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mop">sin</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.02778em">θ</span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mop">cos</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.02778em">θ</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em"><span style="top:-4.8100000000000005em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.2099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em"><span style="top:-4.8100000000000005em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.2099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em"><span style="top:-1.6499900000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.79999em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.3959900000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.4119800000000002em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.653em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em"><span></span></span></span></span></span></span></span></span></span></span></span></p></li><li><p><strong>视图矩阵 (View Matrix, V)</strong><br>视图矩阵将世界坐标变换到相机坐标系。假设相机位置为 (\mathbf {C} &#x3D; (c_x, c_y, c_z) )，看向目标 ( \mathbf {T} &#x3D; (t_x, t_y, t_z) )，相机的上向量为 ( \mathbf {U} &#x3D; (u_x, u_y, u_z) )。<br>首先计算相机的三个基向量：<br><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="bold">z</mi><mo>&#x3D;</mo><mfrac><mrow><mi mathvariant="bold">C</mi><mo>−</mo><mi mathvariant="bold">T</mi></mrow><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="bold">C</mi><mo>−</mo><mi mathvariant="bold">T</mi><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\mathbf{z} &#x3D; \frac{\mathbf{C} - \mathbf{T}}{|\mathbf{C} - \mathbf{T}|}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.44444em;vertical-align:0"></span><span class="mord"><span class="mord mathbf">z</span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&#x3D;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.29911em;vertical-align:-.936em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36311em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">∣</span><span class="mord"><span class="mord mathbf">C</span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathbf">T</span></span><span class="mord">∣</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathbf">C</span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathbf">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.936em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="bold">x</mi><mo>&#x3D;</mo><mfrac><mrow><mi mathvariant="bold">U</mi><mo>×</mo><mi mathvariant="bold">z</mi></mrow><mrow><mi mathvariant="normal">∣</mi><mi mathvariant="bold">U</mi><mo>×</mo><mi mathvariant="bold">z</mi><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\mathbf{x} &#x3D; \frac{\mathbf{U} \times \mathbf{z}}{|\mathbf{U} \times \mathbf{z}|}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.44444em;vertical-align:0"></span><span class="mord"><span class="mord mathbf">x</span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&#x3D;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.29911em;vertical-align:-.936em"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36311em"><span style="top:-2.314em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">∣</span><span class="mord"><span class="mord mathbf">U</span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathbf">z</span></span><span class="mord">∣</span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.677em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathbf">U</span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathbf">z</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.936em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span><br><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="bold">y</mi><mo>&#x3D;</mo><mi mathvariant="bold">z</mi><mo>×</mo><mi mathvariant="bold">x</mi></mrow><annotation encoding="application/x-tex">\mathbf{y} &#x3D; \mathbf{z} \times \mathbf{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.63888em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathbf" style="margin-right:.01597em">y</span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&#x3D;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.66666em;vertical-align:-.08333em"></span><span class="mord"><span class="mord mathbf">z</span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.44444em;vertical-align:0"></span><span class="mord"><span class="mord mathbf">x</span></span></span></span></span></span><br>视图矩阵 (V):<br><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>V</mi><mo>&#x3D;</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mi>z</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mo stretchy="false">(</mo><mi mathvariant="bold">x</mi><mo>⋅</mo><mi mathvariant="bold">C</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>y</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>y</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>y</mi><mi>z</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mo stretchy="false">(</mo><mi mathvariant="bold">y</mi><mo>⋅</mo><mi mathvariant="bold">C</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>z</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>z</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>z</mi><mi>z</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mo stretchy="false">(</mo><mi mathvariant="bold">z</mi><mo>⋅</mo><mi mathvariant="bold">C</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">V &#x3D; \begin{bmatrix} x_x &amp; x_y &amp; x_z &amp; -(\mathbf{x} \cdot \mathbf{C}) \ y_x &amp; y_y &amp; y_z &amp; -(\mathbf{y} \cdot \mathbf{C}) \ z_x &amp; z_y &amp; z_z &amp; -(\mathbf{z} \cdot \mathbf{C}) \ 0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.22222em">V</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&#x3D;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:4.80303em;vertical-align:-2.15003em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em"><span style="top:-1.6499900000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.79999em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.3959900000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.4119800000000002em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.653em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em"><span style="top:-4.8100000000000005em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.04398em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em"><span style="top:-4.8100000000000005em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:-.04398em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em"><span style="top:-4.8100000000000005em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.04398em">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.04398em">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:-.04398em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.04398em">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6500000000000004em"><span style="top:-4.8100000000000005em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">−</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">x</span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathbf">C</span></span><span class="mclose">)</span></span></span><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">−</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf" style="margin-right:.01597em">y</span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathbf">C</span></span><span class="mclose">)</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">−</span><span class="mopen">(</span><span class="mord"><span class="mord mathbf">z</span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathbf">C</span></span><span class="mclose">)</span></span></span><span style="top:-1.2099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.1500000000000004em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.6529999999999996em"><span style="top:-1.6499900000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.79999em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.3959900000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.4119800000000002em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.653em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.15003em"><span></span></span></span></span></span></span></span></span></span></span></span></p></li><li><p><strong>投影矩阵 (Projection Matrix, P)</strong><br>投影矩阵将相机坐标系变换到裁剪坐标系。以透视投影为例，设视锥体的参数为近剪裁面 (n)，远剪裁面 ( f )，视角 ( \theta )，宽高比 ( a )。<br>透视投影矩阵 (P):<br><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo>&#x3D;</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><mrow><mi>a</mi><mi>tan</mi><mo>⁡</mo><mfrac><mi>θ</mi><mn>2</mn></mfrac></mrow></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><mrow><mi>tan</mi><mo>⁡</mo><mfrac><mi>θ</mi><mn>2</mn></mfrac></mrow></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mrow><mi>f</mi><mo>+</mo><mi>n</mi></mrow><mrow><mi>n</mi><mo>−</mo><mi>f</mi></mrow></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mrow><mn>2</mn><mi>f</mi><mi>n</mi></mrow><mrow><mi>n</mi><mo>−</mo><mi>f</mi></mrow></mfrac></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">P &#x3D; \begin{bmatrix} \frac{1}{a \tan \frac{\theta}{2}} &amp; 0 &amp; 0 &amp; 0 \ 0 &amp; \frac{1}{\tan \frac{\theta}{2}} &amp; 0 &amp; 0 \ 0 &amp; 0 &amp; \frac{f+n}{n-f} &amp; \frac{2fn}{n-f} \ 0 &amp; 0 &amp; -1 &amp; 0 \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&#x3D;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:5.637179999999999em;vertical-align:-2.5685899999999995em"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.953995em"><span style="top:-1.3499850000000007em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-2.4999850000000006em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.0959850000000007em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.6919850000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-3.712975em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎢</span></span></span><span style="top:-4.953995em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.4500349999999997em"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0685899999999995em"><span style="top:-5.223481999999999em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.845108em"><span style="top:-2.57398em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mspace mtight" style="margin-right:.19516666666666668em"></span><span class="mop mtight"><span class="mtight">t</span><span class="mtight">a</span><span class="mtight">n</span></span><span class="mspace mtight" style="margin-right:.19516666666666668em"></span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8800285714285714em"><span style="top:-2.656em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em"><span class="pstrut" style="height:3em"></span><span class="frac-line mtight" style="border-bottom-width:.049em"></span></span><span style="top:-3.384em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.02778em">θ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.344em"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.6668199999999999em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.711554em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.112518em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-.7914100000000006em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5685899999999995em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0685899999999995em"><span style="top:-5.223481999999999em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.711554em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.845108em"><span style="top:-2.57398em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">t</span><span class="mtight">a</span><span class="mtight">n</span></span><span class="mspace mtight" style="margin-right:.19516666666666668em"></span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.8800285714285714em"><span style="top:-2.656em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.2255000000000003em"><span class="pstrut" style="height:3em"></span><span class="frac-line mtight" style="border-bottom-width:.049em"></span></span><span style="top:-3.384em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.02778em">θ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.344em"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.394em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.6668199999999999em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.112518em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-.7914100000000006em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5685899999999995em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0685899999999995em"><span style="top:-5.223481999999999em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.711554em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.112518em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.9322159999999999em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:.10764em">f</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.446108em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.10764em">f</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.481108em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-.7914100000000006em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5685899999999995em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.0685899999999995em"><span style="top:-5.223481999999999em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.711554em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.112518em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.9322159999999999em"><span style="top:-2.6550000000000002em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:.10764em">f</span></span></span></span><span style="top:-3.23em"><span class="pstrut" style="height:3em"></span><span class="frac-line" style="border-bottom-width:.04em"></span></span><span style="top:-3.446108em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:.10764em">f</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.481108em"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-.7914100000000006em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.5685899999999995em"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.953995em"><span style="top:-1.3499850000000007em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-2.4999850000000006em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.0959850000000007em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.6919850000000003em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-3.712975em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎥</span></span></span><span style="top:-4.953995em"><span class="pstrut" style="height:3.1550000000000002em"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.4500349999999997em"><span></span></span></span></span></span></span></span></span></span></span></span></p></li><li><p><strong>MVP 矩阵 (Model-View-Projection Matrix, MVP)</strong><br>最终的 MVP 矩阵将对象坐标变换到裁剪坐标系：<br><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mi>V</mi><mi>P</mi><mo>&#x3D;</mo><mi>P</mi><mo>⋅</mo><mi>V</mi><mo>⋅</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">MVP &#x3D; P \cdot V \cdot M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.10903em">M</span><span class="mord mathnormal" style="margin-right:.22222em">V</span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&#x3D;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.13889em">P</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.22222em">V</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.10903em">M</span></span></span></span></span></p><h2 id="降低-drawCall"><a href="#降低-drawCall" class="headerlink" title="# 降低 drawCall"></a><a href="#%E9%99%8D%E4%BD%8Edrawcall">#</a> 降低 drawCall</h2><p>通过合并几何体、使用实例化渲染、纹理图集、批处理等技术，可以有效地减少 Draw Call 的数量，从而提升渲染性能。在 DirectX 中，实现这些技术需要对渲染管线和资源管理有深入的理解。</p><h3 id="合并几何体（Geometry-Merging）"><a href="#合并几何体（Geometry-Merging）" class="headerlink" title="# 合并几何体（Geometry Merging）"></a><a href="#%E5%90%88%E5%B9%B6%E5%87%A0%E4%BD%95%E4%BD%93geometry-merging">#</a> 合并几何体（Geometry Merging）</h3><p>将多个小的几何体合并成一个大的几何体，可以减少绘制调用的数量。例如，将多个相邻的地形块或相似的物体合并为一个网格。</p><h3 id="实例化渲染（Instanced-Rendering）"><a href="#实例化渲染（Instanced-Rendering）" class="headerlink" title="# 实例化渲染（Instanced Rendering）"></a><a href="#%E5%AE%9E%E4%BE%8B%E5%8C%96%E6%B8%B2%E6%9F%93instanced-rendering">#</a> 实例化渲染（Instanced Rendering）</h3><p>对于多个相同的物体，可以使用实例化渲染。实例化渲染允许你一次性绘制多个相同的物体，只需一次绘制调用，但可以通过不同的变换矩阵来修改每个实例的外观。</p><pre>`// 示例代码：设置实例化渲染的变换矩阵D3D11_BUFFER_DESC bufferDesc = &#123;&#125;;bufferDesc.Usage = D3D11_USAGE_DEFAULT;bufferDesc.ByteWidth = sizeof(InstanceData) * numInstances;bufferDesc.BindFlags = D3D11_BIND_VERTEX_BUFFER;D3D11_SUBRESOURCE_DATA initData = &#123;&#125;;initData.pSysMem = instanceData;ID3D11Buffer* instanceBuffer;device-&gt;CreateBuffer(&amp;bufferDesc, &amp;initData, &amp;instanceBuffer);// 绑定实例缓冲区UINT strides[2] = &#123; sizeof(Vertex), sizeof(InstanceData) &#125;;UINT offsets[2] = &#123; 0, 0 &#125;;ID3D11Buffer* buffers[2] = &#123; vertexBuffer, instanceBuffer &#125;;context-&gt;IASetVertexBuffers(0, 2, buffers, strides, offsets);// 绘制调用context-&gt;DrawInstanced(vertexCount, instanceCount, 0, 0);`</pre><h3 id="使用纹理图集（Texture-Atlas）"><a href="#使用纹理图集（Texture-Atlas）" class="headerlink" title="# 使用纹理图集（Texture Atlas）"></a><a href="#%E4%BD%BF%E7%94%A8%E7%BA%B9%E7%90%86%E5%9B%BE%E9%9B%86texture-atlas">#</a> 使用纹理图集（Texture Atlas）</h3><p>将多个纹理合并到一个大纹理中，减少纹理切换。这可以显著减少绘制调用和状态切换的开销。</p><h3 id="批处理（Batching）"><a href="#批处理（Batching）" class="headerlink" title="# 批处理（Batching）"></a><a href="#%E6%89%B9%E5%A4%84%E7%90%86batching">#</a> 批处理（Batching）</h3><p>将具有相同材质和渲染状态的物体进行批处理。批处理可以将多个小的绘制调用合并成一个更大的绘制调用。</p><h3 id="动态管理资源（Dynamic-Resource-Management）"><a href="#动态管理资源（Dynamic-Resource-Management）" class="headerlink" title="# 动态管理资源（Dynamic Resource Management）"></a><a href="#%E5%8A%A8%E6%80%81%E7%AE%A1%E7%90%86%E8%B5%84%E6%BA%90dynamic-resource-management">#</a> 动态管理资源（Dynamic Resource Management）</h3><p>合理使用动态资源更新机制，将多次小的更新合并为一次大的更新。例如，使用动态顶点缓冲区和索引缓冲区。</p><h3 id="使用多重索引缓冲区（Multi-Index-Buffers）"><a href="#使用多重索引缓冲区（Multi-Index-Buffers）" class="headerlink" title="# 使用多重索引缓冲区（Multi-Index Buffers）"></a><a href="#%E4%BD%BF%E7%94%A8%E5%A4%9A%E9%87%8D%E7%B4%A2%E5%BC%95%E7%BC%93%E5%86%B2%E5%8C%BAmulti-index-buffers">#</a> 使用多重索引缓冲区（Multi-Index Buffers）</h3><p>通过多重索引缓冲区来减少顶点缓冲区的切换，从而减少绘制调用。</p><h3 id="减少状态改变（State-Changes）"><a href="#减少状态改变（State-Changes）" class="headerlink" title="# 减少状态改变（State Changes）"></a><a href="#%E5%87%8F%E5%B0%91%E7%8A%B6%E6%80%81%E6%94%B9%E5%8F%98state-changes">#</a> 减少状态改变（State Changes）</h3><p>尽量减少渲染状态（如混合状态、深度状态、光栅化状态等）的改变。尽可能地将相同状态的绘制调用集中在一起。</p><h3 id="使用更高效的资源绑定方式"><a href="#使用更高效的资源绑定方式" class="headerlink" title="# 使用更高效的资源绑定方式"></a><a href="#%E4%BD%BF%E7%94%A8%E6%9B%B4%E9%AB%98%E6%95%88%E7%9A%84%E8%B5%84%E6%BA%90%E7%BB%91%E5%AE%9A%E6%96%B9%E5%BC%8F">#</a> 使用更高效的资源绑定方式</h3><p>例如，DirectX 12 引入了描述符表（Descriptor Tables）和根签名（Root Signatures），可以更高效地管理资源绑定。</p><p>示例代码：批处理和实例化渲染结合</p><pre>`struct InstanceData &#123;    XMMATRIX worldMatrix;&#125;;std::vector&lt;InstanceData&gt; instances;// 准备实例数据for (int i = 0; i &lt; numInstances; ++i) &#123;    InstanceData instance;    instance.worldMatrix = XMMatrixTranslation(i * 2.0f, 0.0f, 0.0f);    instances.push_back(instance);&#125;// 创建实例缓冲区D3D11_BUFFER_DESC instanceBufferDesc = &#123;&#125;;instanceBufferDesc.Usage = D3D11_USAGE_DYNAMIC;instanceBufferDesc.ByteWidth = sizeof(InstanceData) * numInstances;instanceBufferDesc.BindFlags = D3D11_BIND_VERTEX_BUFFER;instanceBufferDesc.CPUAccessFlags = D3D11_CPU_ACCESS_WRITE;D3D11_SUBRESOURCE_DATA instanceData = &#123;&#125;;instanceData.pSysMem = instances.data();ID3D11Buffer* instanceBuffer;device-&gt;CreateBuffer(&amp;instanceBufferDesc, &amp;instanceData, &amp;instanceBuffer);// 绘制实例UINT strides[2] = &#123; sizeof(Vertex), sizeof(InstanceData) &#125;;UINT offsets[2] = &#123; 0, 0 &#125;;ID3D11Buffer* buffers[2] = &#123; vertexBuffer, instanceBuffer &#125;;context-&gt;IASetVertexBuffers(0, 2, buffers, strides, offsets);context-&gt;DrawInstanced(vertexCount, numInstances, 0, 0);`</pre></li></ol><p><strong>深入解析PBR中的BRDF模型：GGX（Trowbridge-Reitz）、Lambertian、Cook-Torrance</strong></p><p>在物理基础渲染（PBR）中，双向反射分布函数（BRDF）是描述光与材质相互作用的核心组件。不同的BRDF模型通过数学公式模拟不同类型的光反射特性，以实现逼真的视觉效果。本文将具体讲解三种常用的BRDF模型：GGX（Trowbridge-Reitz）、Lambertian、Cook-Torrance，探讨它们的物理意义、数学表达及在PBR中的应用。</p><hr><h3 id="一、Lambertian反射模型"><a href="#一、Lambertian反射模型" class="headerlink" title="一、Lambertian反射模型"></a>一、Lambertian反射模型</h3><p><strong>1. 物理意义</strong></p><p>Lambertian模型描述的是理想的漫反射表面，即表面在各个方向上反射光线的强度相同，不依赖于观察方向。这种模型适用于粗糙表面，如磨砂玻璃、未打磨的木材等，能够模拟光线在粗糙表面上的随机散射。</p><p><strong>2. 数学表达</strong></p><p>Lambertian反射的BRDF公式如下：</p><p>$ f_r(\omega_i, \omega_o) &#x3D; \frac{\rho}{\pi} $</p><p>其中：</p><ul><li>( f_r ) 是BRDF。</li><li>( \rho ) 是反射率（Albedo），表示表面反射光的比例。</li><li>( \pi ) 是常数，保证能量守恒。</li></ul><p><strong>3. 特点与应用</strong></p><ul><li><strong>能量守恒</strong>：由于反射率被除以π，确保反射光的总能量不超过入射光。</li><li><strong>方向无关性</strong>：反射光强度与出射方向无关，适用于理想漫反射表面。</li><li><strong>计算简便</strong>：公式简单，计算效率高，常用于基础材质的渲染。</li></ul><p><strong>4. PBR中的作用</strong></p><p>Lambertian模型作为最基础的漫反射模型，在PBR中常与镜面反射模型结合使用，用于描述非金属材质的漫反射部分。尽管它无法准确模拟微表面结构引起的细节，但其简单性使其在许多场景中仍然有效。</p><hr><h3 id="二、Cook-Torrance反射模型"><a href="#二、Cook-Torrance反射模型" class="headerlink" title="二、Cook-Torrance反射模型"></a>二、Cook-Torrance反射模型</h3><p><strong>1. 物理意义</strong></p><p>Cook-Torrance模型是一种微表面BRDF模型，旨在更精确地模拟光在微观表面结构上的反射行为。该模型考虑了微表面的粗糙度、法线分布和几何遮挡等因素，能够模拟出真实世界中复杂的光反射现象，如金属表面的高光和镜面反射。</p><p><strong>2. 数学表达</strong></p><p>Cook-Torrance模型的BRDF公式如下：</p><p>[ f_r(\omega_i, \omega_o) &#x3D; \frac{D(h) \cdot F(\omega_i, h) \cdot G(\omega_i, \omega_o)}{4 (\omega_i \cdot n) (\omega_o \cdot n)} ]</p><p>其中：</p><ul><li>( h &#x3D; \frac{\omega_i + \omega_o}{|\omega_i + \omega_o|} ) 是半程向量。</li><li>( D(h) ) 是法线分布函数（NDF），描述微表面法线的分布。</li><li>( F(\omega_i, h) ) 是菲涅尔项，描述入射光在半程向量上的反射比例。</li><li>( G(\omega_i, \omega_o) ) 是几何遮挡函数，描述微表面之间的遮挡关系。</li><li>( n ) 是表面法线。</li></ul><p><strong>3. 组成部分详解</strong></p><ul><li><p><strong>法线分布函数（D）</strong>：常用GGX（Trowbridge-Reitz）作为D函数，描述微表面法线的分布密度。</p><p>[ D_{GGX}(h) &#x3D; \frac{\alpha^2}{\pi \left[ (\omega \cdot h)^2 (\alpha^2 - 1) + 1 \right]^2} ]</p><p>其中，( \alpha ) 表示粗糙度参数。</p></li><li><p><strong>菲涅尔项（F）</strong>：使用Schlick近似公式计算：</p><p>[ F(\omega_i, h) &#x3D; F_0 + (1 - F_0) (1 - \omega_i \cdot h)^5 ]</p><p>其中，( F_0 ) 是在法线方向上的菲涅尔反射率。</p></li><li><p><strong>几何遮挡函数（G）</strong>：常用Smith的几何遮挡函数：</p><p>[ G(\omega_i, \omega_o) &#x3D; G_1(\omega_i) \cdot G_1(\omega_o) ]</p><p>[ G_1(\omega) &#x3D; \frac{2 (\omega \cdot n)}{\omega \cdot n + \sqrt{\alpha^2 + (1 - \alpha^2)(\omega \cdot n)^2}}} ]</p></li></ul><p><strong>4. 特点与应用</strong></p><ul><li><strong>物理准确性</strong>：综合考虑了微表面法线分布、菲涅尔反射和几何遮挡，能够更真实地模拟镜面反射。</li><li><strong>可调节性</strong>：通过调整粗糙度参数( \alpha )，可以控制高光的锐利程度和扩散程度。</li><li><strong>广泛应用</strong>：适用于金属和高光材质的渲染，能够表现出复杂的反射特性。</li></ul><p><strong>5. PBR中的作用</strong></p><p>Cook-Torrance模型是PBR中常用的镜面反射模型，尤其在处理金属材质时表现出色。结合Lambertian模型，它能够同时描述漫反射和镜面反射部分，提供更全面的光反射模拟。</p><hr><h3 id="三、GGX（Trowbridge-Reitz）反射模型"><a href="#三、GGX（Trowbridge-Reitz）反射模型" class="headerlink" title="三、GGX（Trowbridge-Reitz）反射模型"></a>三、GGX（Trowbridge-Reitz）反射模型</h3><p><strong>1. 物理意义</strong></p><p>GGX（Trowbridge-Reitz）模型是一种改进的法线分布函数（NDF），用于描述微表面法线的分布。相较于传统的Beckmann模型，GGX在处理高粗糙度和极端视角下的反射时表现更佳，能够减少阴影失真和镜面高光过度的问题。</p><p><strong>2. 数学表达</strong></p><p>GGX模型的法线分布函数D如下：</p><p>[ D_{GGX}(h) &#x3D; \frac{\alpha^2}{\pi \left[ (\omega \cdot h)^2 (\alpha^2 - 1) + 1 \right]^2} ]</p><p>其中：</p><ul><li>( \alpha ) 是粗糙度参数，控制法线分布的宽度。</li><li>( \omega ) 是表面法线与半程向量( h )的夹角余弦。</li></ul><p><strong>3. 特点与优势</strong></p><ul><li><strong>尾部减弱</strong>：相比Beckmann模型，GGX在高粗糙度时能够更好地控制法线分布，避免高光尾部过长的问题。</li><li><strong>高性能</strong>：GGX的数学形式简洁，易于计算，适合实时渲染应用。</li><li><strong>物理一致性</strong>：符合能量守恒和其他物理特性，确保反射光的物理真实性。</li></ul><p><strong>4. 应用场景</strong></p><ul><li><strong>高粗糙度材质</strong>：在处理粗糙表面如磨砂金属、粗糙塑料时，GGX能够提供更真实的反射效果。</li><li><strong>实时渲染</strong>：由于其计算效率高，GGX广泛应用于游戏引擎和实时渲染系统中。</li></ul><p><strong>5. PBR中的作用</strong></p><p>GGX作为一种高效且物理准确的法线分布函数，成为PBR中常用的NDF选择。它与Cook-Torrance模型结合使用，能够提供高质量的镜面反射效果，尤其在处理复杂光照和高粗糙度材质时表现出色。</p><hr><h3 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h3><p>在PBR中，BRDF模型的选择直接影响渲染结果的真实感和物理一致性。Lambertian模型以其简单高效的特性，适用于理想的漫反射表面；Cook-Torrance模型通过综合考虑微表面结构、菲涅尔反射和几何遮挡，提供了更为精确的镜面反射描述；而GGX（Trowbridge-Reitz）作为一种先进的法线分布函数，进一步提升了高粗糙度材质的反射效果。理解和合理应用这些BRDF模型，是实现逼真渲染的关键步骤。</p><pre><code class="hljs">## [#](#杂项) 杂项### [#](#billboard有什么作用原理是什么) billboard 有什么作用？原理是什么？广告牌技术（billboarding）。广告牌技术会根据视角方向来旋转一个被纹理着色的多边形，使得多边形看起来好像总是正对着摄像机。广告牌可以被用于渲染火焰、烟雾、云朵或者闪光，在粒子效果中运用很广泛。广告牌技术的本质就是构建旋转矩阵，构建一个旋转矩阵需要三个基向量。广告牌技术所使用的基向量通常就是表面法线（固定为视角方向）、指向上的方向以及向右的方向。除此之外一般还需要指定一个锚点 (anchor location) ，这个锚点在旋转过程中是固定不变的，以此来确定多边形在空间中的位置。### [#](#说一说蒙特卡洛的原理) 说一说蒙特卡洛的原理？这其实是一种以高效的离散方式对连续的积分求近似的非常直观的方法：对任何面积 / 体积进行积分 —— 例如半球 Ω —— 在该面积 / 体积内生成数量 N 的随机采样，权衡每个样本对最终结果的贡献并求和。# [#](#c) C++## [#](#smart-pointers) smart pointers</code></pre><ul><li><p>std::unique_ptr: owns the object it points to exclusively. One unique_ptr for a given object at a time. std::move could transfor the ownership(not copy) to the others.<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">uniquePtr</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></p></li><li><p>std::shared_ptr: multiple shared pointers to won the same object. There is a counter, the object destroyed when the last ‘shared_ptr’ pointing to it is destoryed or reset.<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">sharedPtr1</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> sharedPtr2 <span class="token operator">=</span> sharedPtr1<span class="token punctuation">;</span> <span class="token comment">// Both now own the int.</span></pre></td></tr></table></figure></p></li><li><p>std::weak_ptr: Prevent the memory leak if the counter of shared_ptr never reach zero. ep. A hold a shared_ptr to B, and instances of B hold a shared_ptr to A. Convert weak_ptr to shared_ptr to access the object, ensure it still exists.<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span>weak_ptr<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> weakPtr <span class="token operator">=</span> sharedPtr1<span class="token punctuation">;</span> <span class="token comment">// Does not increase reference count of sharedPtr1's object.</span></pre></td></tr></table></figure></p><h3 id="std-move-实现原理"><a href="#std-move-实现原理" class="headerlink" title="# std::move 实现原理"></a><a href="#stdmove%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">#</a> std::move 实现原理</h3><p>利用引用折叠原理将右值经过 T&amp;&amp; 传递类型保持不变还是右值，而左值经过 T&amp;&amp; 变为普通的左值引用，以保证模板可以传递任意实参，且保持类型不变；</p><p>然后通过 remove_refrence 移除引用，得到具体的类型 T；</p><p>最后通过 static_cast&lt;&gt; 进行强制类型转换，返回 T&amp;&amp; 右值引用。</p><h2 id="virtual-function"><a href="#virtual-function" class="headerlink" title="# virtual function"></a><a href="#virtual-function">#</a> virtual function</h2><p>虚函数（virtual function）是一种用于实现多态性（polymorphism）的机制。多态性允许程序在运行时决定调用哪个函数，而不是在编译时确定。虚函数通常在面向对象编程中用于实现基类和派生类之间的动态绑定（dynamic binding）。</p></li><li><p>基类中使用虚函数，可以在派生类中被覆盖 (override)</p></li><li><p>虚函数表（Virtual Table）：</p><p>当类中有虚函数时，编译器会为该类生成一个虚函数表（vtable），其中存储着类的虚函数的地址。每个对象还包含一个指向这个表的指针（vptr）。当调用虚函数时，通过 vptr 找到 vtable，再从 vtable 中找到实际要调用的函数地址。</p></li><li><p>多态性实现：<br>使用基类指针或引用指向派生类对象，并通过该指针或引用调用虚函数。<pre><code class="hljs">Base *b; Derived d; b = &amp;amp;d; b-&amp;gt;show();  // 将调用Derived类的show函数 </code></pre></p><h3 id="用途"><a href="#用途" class="headerlink" title="# 用途:"></a><a href="#%E7%94%A8%E9%80%94">#</a> 用途:</h3></li></ul><ol><li><p>实现多态性：允许基类指针调用派生类的重写函数。</p></li><li><p>动态绑定：在运行时确定函数的调用，而不是在编译时。</p></li><li><p>接口设计：通过基类定义接口，派生类实现具体功能。</p><h3 id="小问题"><a href="#小问题" class="headerlink" title="# 小问题"></a><a href="#%E5%B0%8F%E9%97%AE%E9%A2%98">#</a> 小问题</h3><h4 id="虚函数如何实现"><a href="#虚函数如何实现" class="headerlink" title="# 虚函数如何实现"></a><a href="#%E8%99%9A%E5%87%BD%E6%95%B0%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0">#</a> 虚函数如何实现</h4><p>虚函数通过虚函数表来实现。虚函数的地址保存在虚函数表中，在类的对象所在的内存空间中，保存了指向虚函数表的指针（称为 “虚表指针”），通过虚表指针可以找到类对应的虚函数表。虚函数表解决了基类和派生类的继承问题和类中成员函数的覆盖问题，当用基类的指针来操作一个派生类的时候，这张虚函数表就指明了实际应该调用的函数。</p><h4 id="构造函数不能定义为虚函数"><a href="#构造函数不能定义为虚函数" class="headerlink" title="# 构造函数不能定义为虚函数"></a><a href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E4%B8%8D%E8%83%BD%E5%AE%9A%E4%B9%89%E4%B8%BA%E8%99%9A%E5%87%BD%E6%95%B0">#</a> 构造函数不能定义为虚函数</h4><p>构造函数：你要有虚表指针才能找到我！</p><p>类：我没有你创建不了虚表指针！</p><p>构造函数：你必须先要有对象！！</p><p>类：我必须要找到你才能构造对象。。</p><h4 id="虚函数表存放在哪个内存区？"><a href="#虚函数表存放在哪个内存区？" class="headerlink" title="# 虚函数表存放在哪个内存区？"></a><a href="#%E8%99%9A%E5%87%BD%E6%95%B0%E8%A1%A8%E5%AD%98%E6%94%BE%E5%9C%A8%E5%93%AA%E4%B8%AA%E5%86%85%E5%AD%98%E5%8C%BA">#</a> 虚函数表存放在哪个内存区？</h4><p>全局数据区。</p><h4 id="struct（int-char）大小，加一个静态变量之后呢？加一个虚函数之后呢？"><a href="#struct（int-char）大小，加一个静态变量之后呢？加一个虚函数之后呢？" class="headerlink" title="# struct（int char）大小，加一个静态变量之后呢？加一个虚函数之后呢？"></a><a href="#structint-char%E5%A4%A7%E5%B0%8F%E5%8A%A0%E4%B8%80%E4%B8%AA%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E4%B9%8B%E5%90%8E%E5%91%A2%E5%8A%A0%E4%B8%80%E4%B8%AA%E8%99%9A%E5%87%BD%E6%95%B0%E4%B9%8B%E5%90%8E%E5%91%A2">#</a> struct（int char）大小，加一个静态变量之后呢？加一个虚函数之后呢？</h4><p>8 字节（内存对齐），还是 8 字节 (静态变量在全局 &#x2F; 静态区，static variables are not part of instance size)，12 字节（多了一个虚函数表指针（vtable））。</p><h4 id="创建-10-个实例有几个虚函数表？"><a href="#创建-10-个实例有几个虚函数表？" class="headerlink" title="# 创建 10 个实例有几个虚函数表？"></a><a href="#%E5%88%9B%E5%BB%BA10%E4%B8%AA%E5%AE%9E%E4%BE%8B%E6%9C%89%E5%87%A0%E4%B8%AA%E8%99%9A%E5%87%BD%E6%95%B0%E8%A1%A8">#</a> 创建 10 个实例有几个虚函数表？</h4><p>1 个，虚函数表数量与实例的对象数量无关。</p><h4 id="哪些不能是虚函数"><a href="#哪些不能是虚函数" class="headerlink" title="# 哪些不能是虚函数"></a><a href="#%E5%93%AA%E4%BA%9B%E4%B8%8D%E8%83%BD%E6%98%AF%E8%99%9A%E5%87%BD%E6%95%B0">#</a> 哪些不能是虚函数</h4><p>构造、内联、静态成员、lamda 函数</p><pre>`class Base &#123;public:    virtual void show() &#123;        cout &lt;&lt; &quot;Base class show function&quot; &lt;&lt; endl;    &#125;&#125;;`</pre></li></ol><ul><li><p>覆盖虚函数:<pre><code class="hljs">class Derived : public Base &amp;#123; public: void show() override &amp;#123;     cout &amp;lt;&amp;lt; &amp;quot;Derived class show function&amp;quot; &amp;lt;&amp;lt; endl; &amp;#125; &amp;#125;; </code></pre></p><h2 id="STL-中常见容器操作时间复杂度小结"><a href="#STL-中常见容器操作时间复杂度小结" class="headerlink" title="# STL 中常见容器操作时间复杂度小结"></a><a href="#stl-%E4%B8%AD%E5%B8%B8%E8%A7%81%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%B0%8F%E7%BB%93">#</a> STL 中常见容器操作时间复杂度小结</h2></li><li><p>map, set, multimap, and multiset 采用红黑树实现，红黑树是平衡二叉树的一种。不同操作的时间复杂度近似为:</p><pre><code class="hljs">*   插入: O (logN)</code></pre><ul><li>查看：O (logN)</li><li>删除：O (logN)</li></ul></li><li><p>hash_map, hash_set, hash_multimap, and hash_multiset 采用哈希表实现，不同操作的时间复杂度为：</p><pre><code class="hljs">*   插入：O (1)，最坏情况 O (N)。</code></pre><ul><li>查看：O (1)，最坏情况 O (N)。</li><li>删除：O (1)，最坏情况 O (N)。</li></ul></li><li><p>vector 从名字看，随机访问的复杂度应该是 O (1)</p><pre><code class="hljs">*   插入 insert vector O（n）</code></pre><ul><li>插入 push_back vector O（1）</li><li>删除 pop_back vector O（1）</li><li>删除 erase vector O（n）</li><li>查找特点元素的时间复杂度 O（n）</li></ul></li><li><p>LinkedList 底层是双链表</p><pre><code class="hljs">*   get () 获取第几个元素，依次遍历，复杂度 O (n)</code></pre><ul><li>add (E) 添加到末尾，复杂度 O (1)</li><li>add (index, E) 添加第几个元素后，需要先查找到第几个元素，直接指针指向操作，复杂度 O (n)</li><li>remove（）删除元素，直接指针指向操作，复杂度 O (1)</li></ul><h2 id="map-和-unordered-map-区别"><a href="#map-和-unordered-map-区别" class="headerlink" title="# map 和 unordered_map 区别"></a><a href="#map%E5%92%8Cunordered_map%E5%8C%BA%E5%88%AB">#</a> map 和 unordered_map 区别</h2><p>map： map 内部实现了一个红黑树（红黑树是非严格平衡二叉搜索树，而 AVL 是严格平衡二叉搜索树），红黑树具有自动排序的功能，因此 map 内部的所有元素都是有序的，红黑树的每一个节点都代表着 map 的一个元素。因此，对于 map 进行的查找，删除，添加等一系列的操作都相当于是对红黑树进行的操作。</p><p>unordered_map: 内部实现了一个哈希表（也叫散列表，通过把关键码值映射到 Hash 表中一个位置来访问记录，查找的时间复杂度可达到 O (1)，其在海量数据处理中有着广泛应用）。因此，其元素的排列顺序是无序的。</p><h4 id="关于-map-容器：优点："><a href="#关于-map-容器：优点：" class="headerlink" title="# 关于 map 容器：优点："></a><a href="#%E5%85%B3%E4%BA%8Emap%E5%AE%B9%E5%99%A8%E4%BC%98%E7%82%B9">#</a> 关于 map 容器：优点：</h4><p>有序性，这是 map 结构最大的优点，其元素的有序性在很多应用中都会简化很多的操作</p><p>红黑树，内部实现一个红黑树使得 map 的很多操作在 logn 的时间复杂度下就可以实现，因此效率非常的高。</p><p>缺点： 空间占用率高（但 map 的空间利用率一般是高于 unordered_map 的），因为 map 内部实现了红黑树，虽然提高了运行效率，但是因为每一个节点都需要额外保存父节点、孩子节点和红 &#x2F; 黑性质，使得每一个节点都占用大量的空间</p><p>适用处：对于那些有顺序要求的问题，用 map 会更高效一些。</p><h2 id="vector-的扩容，哈希表扩容？"><a href="#vector-的扩容，哈希表扩容？" class="headerlink" title="# vector 的扩容，哈希表扩容？"></a><a href="#vector%E7%9A%84%E6%89%A9%E5%AE%B9%E5%93%88%E5%B8%8C%E8%A1%A8%E6%89%A9%E5%AE%B9">#</a> vector 的扩容，哈希表扩容？</h2><p>vector 的扩容通过一个连续的数组存放元素，如果集合已满，在新增数据的时候，就要分配一块更大的内存，将原来的数据复制过来，释放之前的内存，再插入新增的元素。根据编译器不同，这个扩大的倍数有所不同，以 GCC 为例，是两倍扩容。</p><p>哈希表的扩容和 vector 也很类似，在哈希表中负载因子 &#x3D; 元素个数 &#x2F; 散列表长度，当负载因子达到阈值，则需要进行扩容，扩容也是分配更大的散列表，然后进行 rehash，最终再将新元素插入。</p><h2 id="incline-内联函数"><a href="#incline-内联函数" class="headerlink" title="# incline 内联函数"></a><a href="#incline-%E5%86%85%E8%81%94%E5%87%BD%E6%95%B0">#</a> incline 内联函数</h2><p>是一种特殊的函数类型，它的主要目的是通过在函数调用处直接插入函数代码，以避免函数调用的开销，从而提高程序的执行效率。内联函数是通过在函数定义前加上 inline 关键字来声明的。</p><p>当调用内联函数时，编译器会将该函数的代码直接插入到调用点，而不是进行一次函数调用。这可以减少函数调用的开销，特别是对于那些频繁调用的小函数。</p></li><li><p>减少函数调用开销：通过将函数代码直接插入到调用点，可以避免函数调用的开销，如参数传递、栈帧管理等。</p></li><li><p>代码膨胀：因为内联函数会在每个调用点插入函数代码，可能会导致生成的可执行文件体积变大。</p></li><li><p>编译器优化：内联只是对编译器的一个建议，编译器可能会根据具体情况决定是否将函数内联化。如果函数太复杂或太大，编译器可能会忽略 inline 关键字。</p><h2 id="进程之间如何通信-IPC"><a href="#进程之间如何通信-IPC" class="headerlink" title="# 进程之间如何通信 IPC"></a><a href="#%E8%BF%9B%E7%A8%8B%E4%B9%8B%E9%97%B4%E5%A6%82%E4%BD%95%E9%80%9A%E4%BF%A1-ipc">#</a> 进程之间如何通信 IPC</h2></li></ul><ol><li><p>pipes : 匿名管道用于在有亲缘关系的进程之间进行通信（通常是父子进程）。它是单向的，即数据只能沿一个方向流动。</p></li><li><p>FIFO: 命名管道可以在没有亲缘关系的进程之间进行通信。它是一个在文件系统中存在的特殊文件，可以通过文件路径访问。</p></li><li><p>Message Queues: 消息队列允许进程以消息的形式交换数据，可以在没有亲缘关系的进程之间进行通信。</p></li><li><p>Shared memory: 共享内存允许多个进程直接访问同一块内存区域，从而实现高速的数据交换。</p></li><li><p>signals: 信号是一种异步的进程间通信机制，用于通知进程某个事件的发生。</p><h2 id="内存分布"><a href="#内存分布" class="headerlink" title="# 内存分布"></a><a href="#%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83">#</a> 内存分布</h2><h3 id="内存分区"><a href="#内存分区" class="headerlink" title="# 内存分区"></a><a href="#%E5%86%85%E5%AD%98%E5%88%86%E5%8C%BA">#</a> 内存分区</h3></li></ol><ul><li><p>global stastic 储存区：存放 global 和 stastic 的变量，程序运行结束 os 自动释放。</p></li><li><p>const 储存区：存放 const 不可以被修改，程序运行结束自动释放。</p></li><li><p>代码区：存放代码，不可以修改，但可以执行，编译后的二进制文件放在这里。</p><p>C++ 程序在运行时也会按照不同的功能划分不同的段，C++ 程序使用的内存分区一般包括。</p><h3 id="heap-（手动）"><a href="#heap-（手动）" class="headerlink" title="# heap （手动）"></a><a href="#heap-%E6%89%8B%E5%8A%A8">#</a> heap （手动）</h3></li></ul><ol><li><p>dynamic 内存分布，意味着内存在运行的时候用 function 来分配或者取消分配的，malloc，calloc，reallco，free，new delete。</p></li><li><p>内存由程序员手动管理。它可以动态增长和收缩。分配和释放可以按任何顺序发生，从而导致碎片。由于管理空闲内存的开销，与堆栈内存相比，它的访问时间通常较慢。</p><h3 id="stack-（自动）"><a href="#stack-（自动）" class="headerlink" title="# stack （自动）"></a><a href="#stack-%E8%87%AA%E5%8A%A8">#</a> stack （自动）</h3></li><li><p>stastic 的内存分布，特别是函数调用管理，局部变量和函数参数</p></li><li><p>内存通过后进先出 (LIFO) 结构自动管理。<br>与堆相比，分配和释放内存通常更快，因为此过程遵循严格的顺序（推送和弹出操作）。<br>堆栈的大小通常是有限的并且小于堆。<br>它有助于维护函数调用历史记录和局部变量范围。</p><h3 id="new-和-malloc"><a href="#new-和-malloc" class="headerlink" title="# new 和 malloc"></a><a href="#new-%E5%92%8C-malloc">#</a> new 和 malloc</h3></li><li><p>new 在申请内存的同时，会调用对象的构造函数，对象会进行初始化，malloc 仅仅在堆中申请一块指定大小的内存空间，并不会对内存和对象进行初始化。</p></li><li><p>new 可以指定内存空间初始化对象 (replacement new)，而 malloc 只能从堆中申请内存。</p></li><li><p>new 是 c++ 中的一个操作符，而 malloc 是 C 中的一个函数。</p></li><li><p>new 内存分配成功，返回该对象类型的指针，分配失败，抛出 bad_alloc 异常；而 malloc 成功申请到内存，返回指向该内存的指针；分配失败，返回 NULL 指针。</p></li><li><p>new 作为一个运算符可以进行重载，而 malloc 作为一个函数不支持重载。</p></li><li><p>new 的空间大小由编译器会自动计算，而 malloc 则需要指定空间大小。</p><h3 id="delete-和-free"><a href="#delete-和-free" class="headerlink" title="# delete 和 free"></a><a href="#delete%E5%92%8Cfree">#</a> delete 和 free</h3></li><li><p>delete 是 C++ 中的一个操作符，可以进行重载；而 free 是 C 中的一个函数，不能进行重载。</p></li><li><p>free 只会释放指向的内存，不会执行对象的析构函数；delete 则可以执行对象的析构函数。</p><h3 id="指针和引用"><a href="#指针和引用" class="headerlink" title="# 指针和引用"></a><a href="#%E6%8C%87%E9%92%88%E5%92%8C%E5%BC%95%E7%94%A8">#</a> 指针和引用</h3><ol><li><p>指针：指针是一个变量，只不过这个变量存储的是一个地址，指向内存的一个存储单元，即指针是一个实体；而引用跟原来的变量实质上是一个东西，只不过是原变量的一个别名而已。</p></li><li><p>可以有 const 指针，但是没有 const 引用；</p></li><li><p>指针可以有多级，但是引用只能是一级；</p></li><li><p>指针的值可以为空，但是引用的值不能为 NULL，并且引用在定义的时候必须初始化；</p></li></ol><h4 id="指针常量："><a href="#指针常量：" class="headerlink" title="# 指针常量："></a><a href="#%E6%8C%87%E9%92%88%E5%B8%B8%E9%87%8F">#</a> 指针常量：</h4><pre>`int * const p = &amp;a; *p = 30; // p指向的地址是一定的，但其内容可以修改常量指针：`</pre><pre>`const int *p = &amp;a;<p>p &#x3D; &amp;b; &#x2F;&#x2F; 指针可以指向其他地址，但是内容不可以改变<br>&#96;</pre></p><p>顶层 const 和底层 const 的概念：顶层 const，本身是 const（指针常量），底层 const（常量指针），指向的对象是 const 的。</p><h3 id="heap-vs-stack"><a href="#heap-vs-stack" class="headerlink" title="# heap vs stack"></a><a href="#heap-vs-stack">#</a> heap vs stack</h3></li><li><p>heap 手动分配用户控制，stack 自动由编译器控制。</p></li><li><p>heap 手动释放，stack 函数返回自动释放。</p></li><li><p>heap 慢，由于任意分配和释放会有碎片。stack 由于是后进先出和连续分配内存，速度会更快。</p></li><li><p>heap 适用于需要动态内存的数据结构，比如 linkedlist，tree。stack 适用于临时变量，或者生命周期只存在于函数内的场景。</p><h3 id="examples"><a href="#examples" class="headerlink" title="# examples"></a><a href="#examples">#</a> examples</h3><h4 id="heap"><a href="#heap" class="headerlink" title="# heap"></a><a href="#heap">#</a> heap</h4><pre>`#include &lt;iostream&gt;#include &lt;cstdlib&gt; // for malloc and freeint main() &#123;    // Allocate memory on the heap for an integer    int* heapInt = (int*)malloc(sizeof(int));    // Check if the allocation succeeded    if (heapInt == nullptr) &#123;        std::cerr &lt;&lt; &quot;Memory allocation failed!&quot; &lt;&lt; std::endl;        return 1;    &#125;    // Assign a value to the allocated memory    *heapInt = 42;    // Output the value    std::cout &lt;&lt; &quot;Value stored in heap: &quot; &lt;&lt; *heapInt &lt;&lt; std::endl;    // Free the allocated memory    free(heapInt);    return 0;&#125;`</pre><h4 id="stack"><a href="#stack" class="headerlink" title="# stack"></a><a href="#stack">#</a> stack</h4><pre>`#include &lt;iostream&gt;void stackFunction() &#123;    // Allocate memory on the stack for an integer    int stackInt = 42;    // Output the value    std::cout &lt;&lt; &quot;Value stored in stack: &quot; &lt;&lt; stackInt &lt;&lt; std::endl;&#125;int main() &#123;    // Call the function that uses stack memory    stackFunction();    return 0;&#125;`</pre><h2 id="静动态链接库"><a href="#静动态链接库" class="headerlink" title="# 静动态链接库"></a><a href="#%E9%9D%99%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93">#</a> 静动态链接库</h2><p>静态链接：代码在生成可执行文件时，将该程序所需要的全部外部调用函数全部拷贝到最终的可执行程序文件中，在该程序被执行时，该程序运行时所需要的全部代码都会被装入到该进程的虚拟地址空间中</p><p>动态链接：代码在生成可执行文件时，该程序所调用的部分程序被放到动态链接库或共享对象的某个目标文件中在程序执行时，当需要调用这部分程序时，操作系统会从将这些动态链或者共享对象进行加载，并将全部内容会被映射到该进行运行的虚拟地址的空间。</p><p>二者的优缺点：静态链接浪费空间，每个可执行程序都会有目标文件的一个副本，这样如果目标文件进行了更新操作，就需要重新进行编译链接生成可执行程序（更新困难），优点就是执行的时候运行速度快，因为可执行程序具备了程序运行的所有内容；动态链接节省内存、更新方便，但是动态链接是在程序运行时，每次执行都需要链接，相比静态链接会有一定的性能损失。</p><h1 id="math"><a href="#math" class="headerlink" title="# math"></a><a href="#math">#</a> math</h1><h4 id="dot-product"><a href="#dot-product" class="headerlink" title="# dot product"></a><a href="#dot-product">#</a> dot product</h4><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>&#x3D;</mo><msub><mi>a</mi><mi>x</mi></msub><mo>⋅</mo><msub><mi>b</mi><mi>x</mi></msub><mo>+</mo><msub><mi>a</mi><mi>y</mi></msub><mo>⋅</mo><msub><mi>b</mi><mi>y</mi></msub><mo>+</mo><msub><mi>a</mi><mi>z</mi></msub><mo>⋅</mo><msub><mi>b</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">(a,b) &#x3D; a_x \cdot b_x + a_y \cdot b_y + a_z \cdot b_z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&#x3D;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.59445em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.730558em;vertical-align:-.286108em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.980548em;vertical-align:-.286108em"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.59445em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.04398em">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.84444em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.04398em">z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span></p></li><li><p>Cosine of two vector.</p></li><li><p>Projection 用于将一个向量投影到另一个向量上。这在阴影贴图和计算一个向量沿另一个向量的方向的分量等操作中特别有用.</p></li><li><p>Backface culling: 背面剔除，通过计算观察方向与多边形表面法线之间的点积，可以确定多边形是面向相机还是背向相机。如果多边形背向，则可以在渲染过程中省略它，从而提高性能</p><h4 id="cross-product"><a href="#cross-product" class="headerlink" title="# cross product"></a><a href="#cross-product">#</a> cross product</h4></li><li><p>表面法线计算：在 3D 图形中，叉积用于计算表面法线。渲染 3D 对象时，了解每个点的表面法线方向对于正确应用光照和着色效果至关重要。<br>一个多边形三个点<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>d</mi><mi>g</mi><mi>e</mi><mn>1</mn><mo>&#x3D;</mo><mo stretchy="false">(</mo><mi>x</mi><mn>2</mn><mo>−</mo><mi>x</mi><mn>1</mn><mo separator="true">,</mo><mi>y</mi><mn>2</mn><mo>−</mo><mi>y</mi><mn>1</mn><mo separator="true">,</mo><mi>z</mi><mn>2</mn><mo>−</mo><mi>z</mi><mn>1</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>E</mi><mi>d</mi><mi>g</mi><mi>e</mi><mn>2</mn><mo>&#x3D;</mo><mo stretchy="false">(</mo><mi>x</mi><mn>3</mn><mo>−</mo><mi>x</mi><mn>1</mn><mo separator="true">,</mo><mi>y</mi><mn>3</mn><mo>−</mo><mi>y</mi><mn>1</mn><mo separator="true">,</mo><mi>z</mi><mn>3</mn><mo>−</mo><mi>z</mi><mn>1</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>N</mi><mi>o</mi><mi>r</mi><mi>m</mi><mi>a</mi><mi>l</mi><mo>&#x3D;</mo><mi>E</mi><mi>d</mi><mi>g</mi><mi>e</mi><mn>1</mn><mo>×</mo><mi>E</mi><mi>d</mi><mi>g</mi><mi>e</mi><mn>2</mn><mo>&#x3D;</mo><mrow><mo fence="true">(</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mn>2</mn></msub><mo>−</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>z</mi><mn>3</mn></msub><mo>−</mo><msub><mi>z</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>−</mo><mo stretchy="false">(</mo><msub><mi>z</mi><mn>2</mn></msub><mo>−</mo><msub><mi>z</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mn>3</mn></msub><mo>−</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mspace width="1em"><mo stretchy="false">(</mo><msub><mi>z</mi><mn>2</mn></msub><mo>−</mo><msub><mi>z</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>3</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>−</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>z</mi><mn>3</mn></msub><mo>−</mo><msub><mi>z</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mspace width="1em"><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mn>3</mn></msub><mo>−</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>−</mo><mo stretchy="false">(</mo><msub><mi>y</mi><mn>2</mn></msub><mo>−</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>3</mn></msub><mo>−</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">Edge1 &#x3D; (x2-x1,y2-y1,z2-z1), Edge2 &#x3D; (x3-x1,y3-y1,z3-z1), Normal &#x3D; Edge1 \times Edge2 &#x3D; \left( (y_2 - y_1)(z_3 - z_1) - (z_2 - z_1)(y_3 - y_1), \quad (z_2 - z_1)(x_3 - x_1) - (x_2 - x_1)(z_3 - z_1),\quad (x_2 - x_1)(y_3 - y_1) - (y_2 - y_1)(x_3 - x_1) \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:.03588em">g</span><span class="mord mathnormal">e</span><span class="mord">1</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&#x3D;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord">2</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8388800000000001em;vertical-align:-.19444em"></span><span class="mord mathnormal">x</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="mord">2</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8388800000000001em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.04398em">z</span><span class="mord">2</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.04398em">z</span><span class="mord">1</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:.03588em">g</span><span class="mord mathnormal">e</span><span class="mord">2</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&#x3D;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mord">3</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8388800000000001em;vertical-align:-.19444em"></span><span class="mord mathnormal">x</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="mord">3</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8388800000000001em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.04398em">z</span><span class="mord">3</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.04398em">z</span><span class="mord">1</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:.01968em">l</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&#x3D;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:.03588em">g</span><span class="mord mathnormal">e</span><span class="mord">1</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:.03588em">g</span><span class="mord mathnormal">e</span><span class="mord">2</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">&#x3D;</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0">(</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.04398em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.04398em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.04398em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.04398em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em"></span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.04398em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.04398em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.04398em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.04398em">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.04398em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em"></span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0">)</span></span></span></span></span></p></li><li><p>方向和旋转：叉积有助于确定场景中对象或摄像机视图旋转所围绕的轴。通过找到垂直于给定平面或方向的向量，它可以帮助建立变换对象的旋转矩阵。</p></li><li><p>动画和绑定：在角色绑定和动画中，叉积可用于确保关节和肢体以正确且真实的方式移动，特别是在设置移动约束以保持方向时。</p></li><li><p>碰撞检测：叉积可以帮助确定 3D 空间中物体的相对方向，这在物理计算和碰撞检测系统中非常有用。</p></li><li><p>UV 映射：对于 3D 模型上的纹理，叉积有助于生成或调整纹理坐标，确保纹理与对象的表面正确对齐</p><h1 id="UE5"><a href="#UE5" class="headerlink" title="# UE5"></a><a href="#ue5">#</a> UE5</h1><h2 id="游戏模式和实例"><a href="#游戏模式和实例" class="headerlink" title="# 游戏模式和实例"></a><a href="#%E6%B8%B8%E6%88%8F%E6%A8%A1%E5%BC%8F%E5%92%8C%E5%AE%9E%E4%BE%8B">#</a> 游戏模式和实例</h2></li><li><p>GameInstance: 游戏实例，架构凌驾于最顶端，不会随着关卡切换而消失，用于保存临时的全局数据。在 C++ 中用 UGameplayStatic：：GetGameInstance () 获取。</p></li><li><p>GameMode: 设置游戏规则，在地图内生效，比如规定玩家的数量，制定游戏的进入方式，比如 spawn 的生成重生等行为。放在服务端，客户端不能访问。config-defaultEngine.ini-gameMapssettings- globalDefaultGameMode。</p></li><li><p>DefaultPawn: 角色的外在表现类，包括角色的移动规则，服务端和客户端都存在一份，保持同步。GameMode 中进行修改。</p></li><li><p>HUD: 屏幕上覆盖的元素基本对象，游戏中每个人类控制的玩家都有自己的 AHUD instance，这个 instance 会覆盖到个人是扣上，只存在于客户端，在 gameMode 中修改。</p></li><li><p>PlayerController: 拥有 Pawn 并设置他的行为规则，服务器上有所有玩家的 playcontroller，但是本地只有当前玩家的 playercontroller。关联了客户端和服务端，通过该类，可以向服务端发出请求，在 gamemode 中修改。</p></li><li><p>GameState: 数据的全局管理，服务器和客户端都要存放一份，包括复制到游戏中的客户端的信息，包含游戏分数，比赛是否开始，生成多少 AI 等等，保持数据同步，在 GameMode 中修改。</p></li><li><p>PlayerState: 角色数据，需要通过 playercontroller 访问，博阿村玩家的信息，比如名字，得分，生命值，对应玩家数据的容器，多人游戏所有玩家的 playerstate 存在于所有机器上，可以从服务器复制到客户端保持同步。</p><p>类 客户端 服务器<br>GameMode——存在<br>DefaultPawn 存在 存在<br>HUD 存在不存在<br>PlayerController只有当前玩家拥有所有玩家<br>GameState存在存在<br>PlayerState拥有所有玩家拥有所有玩家</p><h2 id="动态材质实例的作用"><a href="#动态材质实例的作用" class="headerlink" title="# 动态材质实例的作用"></a><a href="#%E5%8A%A8%E6%80%81%E6%9D%90%E8%B4%A8%E5%AE%9E%E4%BE%8B%E7%9A%84%E4%BD%9C%E7%94%A8">#</a> 动态材质实例的作用</h2><p>动态材质实例 (MID) 是可以在游戏期间（在运行时）进行计算的实例化材质。这表示在游戏期间，您可使用脚本（经过编译的代码或蓝图可视脚本）来更改材质的参数，从而在游戏中改变该材质。这种材质的可能应用场合数不胜数，既可显示不同程度的损坏，也可更改绘图作业以混入不同皮肤纹理来回应面部表情。</p><h2 id="委托"><a href="#委托" class="headerlink" title="# 委托"></a><a href="#%E5%A7%94%E6%89%98">#</a> 委托</h2><h3 id="单播委托、多播委托和动态委托的区别"><a href="#单播委托、多播委托和动态委托的区别" class="headerlink" title="# 单播委托、多播委托和动态委托的区别"></a><a href="#%E5%8D%95%E6%92%AD%E5%A7%94%E6%89%98-%E5%A4%9A%E6%92%AD%E5%A7%94%E6%89%98%E5%92%8C%E5%8A%A8%E6%80%81%E5%A7%94%E6%89%98%E7%9A%84%E5%8C%BA%E5%88%AB">#</a> 单播委托、多播委托和动态委托的区别</h3><p>委托是一种泛型但类型安全的方式，可在 C++ 对象上调用成员函数。可使用委托动态绑定到任意对象的成员函数，之后在该对象上调用函数，即使调用程序不知对象类型也可进行操作。</p></li></ol><ul><li><p>单播委托：只能绑定一个委托函数，绑定的委托函数可以有返回值，可接受不同数量的参数（最多支持 9 个函数参数），委托实例必须绑定在其声明时所定义的同返回类型和参数列表的函数，静态委托执行前最好检查是否绑定，否则会导致程序崩溃，如果重复进行绑定，会覆盖上一次的绑定。</p></li><li><p>多播委托：拥有大部分与单播委托相同的功能。它们只拥有对对象的弱引用，可以与结构体一起使用，可以四处轻松复制等等。多播委托可以绑定多个委托函数，可以远程加载 &#x2F; 保存和触发，但多播委托函数不能使用返回值。它们最适合用来四处轻松传递一组委托。多播委托在广播执行时不一定是按照绑定顺序来的，在广播执行时，不需要判断是否绑定了委托函数，直接广播执行即可。</p></li><li><p>动态委托：动态委托包含动态单播和动态多播，支持蓝图序列化，即可以在蓝图中使用，其函数可按命名查找，但其执行速度比常规委托慢。</p><p>委托可绑定的委托函数参数返回值序列化<br>单播一个支持支持不支持<br>多播多个支持不支持不支持<br>动态单播一个支持支持支持<br>动态多播多个支持不支持支持</p><pre>`//单播委托DECLARE_DELEGATE(FDelegate);                                             //声明FDelegate Delegate;                                                      //定义Delegate.ExecuteIfBound();                                               //调用ActorReference-&gt;Delegate.BindUObject(this, &amp;AMyActor::DelegateFunction); //绑定//多播委托DECLARE_MULTICAST_DELEGATE(FMulticastDelegate);FMulticastDelegate MulticastDelegate;MulticastDelegate.Broadcast();ActorReference-&gt;MulticastDelegate.AddUObject(this, &amp;AMyActor::MulticastDelegateFunction);//动态单播委托DECLARE_DYNAMIC_DELEGATE(FDynamicDelegate);FDynamicDelegate DynamicDelegate;DynamicDelegate.ExecuteIfBound();ActorReference-&gt;DynamicDelegate.BindDynamic(this, &amp;AMyActor::DynamicDelegateFunction);//动态多播委托DECLARE_DYNAMIC_MULTICAST_DELEGATE(FDynamicMulticastDelegate);FDynamicMulticastDelegate DynamicMulticastDelegate;DynamicMulticastDelegate.Broadcast();ActorReference-&gt;DynamicMulticastDelegate.AddDynamic(this, &amp;AMyActor::DynamicMulticastDelegateFunction);`</pre><h3 id="委托的底层原理"><a href="#委托的底层原理" class="headerlink" title="# 委托的底层原理"></a><a href="#%E5%A7%94%E6%89%98%E7%9A%84%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86">#</a> 委托的底层原理</h3><p>委托是一种观察者模式，也被称为代理，用于降低不同对象之间的耦合度，两个有关联的对象不对彼此的行为进行监听，而是通过委托来间接的建立联系，监听者将需要响应的函数绑定到委托对象上，使得委托在触发时调用所绑定的函数。</p><p>在 UE 中，委托机制的原理比较简单，就是在委托类的内部保存了函数指针，需要执行这些委托的时候就传入所需的参数给保存的函数指针，从而调用绑定的函数。但实现上稍显复杂，因为要解决两个问题：</p></li><li><p>需要支持具有任意类型以及数量不限的参数列表的函数</p></li><li><p>需要支持多种类型函数，如 lambda 匿名函数、C++ 原始成员函数、基于共享指针的成员函数、原始全局函数 (包括静态成员函数)、基于 UFunction 的成员函数、基于 UObject 的成员函数</p><h3 id="如何保持新建的-UObject-对象不被自动-GC-垃圾回收"><a href="#如何保持新建的-UObject-对象不被自动-GC-垃圾回收" class="headerlink" title="# 如何保持新建的 UObject 对象不被自动 GC 垃圾回收"></a><a href="#%E5%A6%82%E4%BD%95%E4%BF%9D%E6%8C%81%E6%96%B0%E5%BB%BA%E7%9A%84uobject%E5%AF%B9%E8%B1%A1%E4%B8%8D%E8%A2%AB%E8%87%AA%E5%8A%A8gc%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6">#</a> 如何保持新建的 UObject 对象不被自动 GC 垃圾回收</h3></li></ul><ol><li><p>在普通的 C++ 类中新建 UObject 对象后，使用 AddToRoot () 函数可以保护对象不被自动回收，移除保护时使用 RemoveFromRoot () 并把对象指针置为 nullptr 即可由引擎自动回收<pre>`UMyObject* MyObject=NewObject&lt;UMyObject&gt;();<br>MyObject-&gt;AddToRoot();                     //保护对象不被回收<br>MyObject-&gt;RemoveFromRoot();<br>MyObject=nullptr;                          //交给引擎回收对象</p><p>`</pre></p></li><li><p>如果是在继承自 UObject 类中新建 UObject 对象后，使用 UPROPERTY 宏标记一下对象指针变量也可以保护对象不被自动回收，在该类被销毁时，新建的对象也会被引擎自动回收；<pre><code class="hljs">UCLASS() class UMyObject : public UObject&amp;#123; GENERATED_BODY() UPROPERTY() class UItemObject* ItemObject; &amp;#125; </code></pre></p></li><li><p>使用 FStreamableManager 加载资源时，将 bManageActiveHandle 设置为 true 也可以防止对象被回收；<pre><code class="hljs">FSoftObjectPath AssetPaths(TEXT(&amp;quot;[资源路径]&amp;quot;)); FStreamableManager&amp;amp; AssetLoader = UAssetManager::GetStreamableManager(); TSharedPtr&amp;lt;FStreamableHandle&amp;gt; Handle = AssetLoader.RequestSyncLoad(AssetPath, true);//加载资源到内存中，bManageActiveHandle=true UObject* Obj = Handle-&amp;gt;GetLoadedAsset(); Handle-&amp;gt;ReleaseHandle();//从内存中释放资源 </code></pre></p></li><li><p>FGCObjectScopeGuard 在指定代码区域内保持对象；<pre><code class="hljs">&amp;#123; FGCObjectScopeGuard(UObject* GladOS = NewObject&amp;lt;...&amp;gt;(...)); GladOS-&amp;gt;SpawnCell(); RunGC(); GladOS-&amp;gt;IsStillAlive(); &amp;#125; </code></pre></p><h2 id="UE5-中的智能指针"><a href="#UE5-中的智能指针" class="headerlink" title="# UE5 中的智能指针"></a><a href="#ue5-%E4%B8%AD%E7%9A%84%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88">#</a> UE5 中的智能指针</h2><p>共享指针（TSharedPtr）允许多个该类型的指针指向同一块内存，采用引用计数器的方式，统计所有指向同一块内存的指针变量的数量，当新的指针变量生命初始化并指向同一块内存，拷贝函数拷贝和赋值操作时引用计数器会自增加，当指针变量生命周期结束调用析构函数时，引用计数器会自减少。引用计数器减少至 0 时，释放指向的内存。共享引用（TShareRef）和共享指针的区别是共享指针可以为 NULL，而共享引用不能为 NULL 。</p><p>弱指针（TWeakPtr <code>TSharedPtr</code> ）主要是为了配合共享指针而引入的一种智能指针，TWeakPtr 没有指针的行为，没有重载间接引用操作符 (-&gt;) 和解除引用操作符 (*)，它可以通过 TSharedPtr 和 TSharedRef 来初始化，但只引用，不计数，不拥有内存的所有权，不会对 TSharedPtr 和 TSharedRef 的共享引用计数器产生影响，也不影响其生命周期，但会在控制块的 WeakReferenceCount 属性中统计弱指针引用数量。</p><p>唯一指针（TUniquePtr）仅会显式拥有其引用的对象。仅有一个唯一指针指向给定资源，因此唯一指针可转移所有权，但无法共享。复制唯一指针的任何尝试都将导致编译错误。唯一指针超出范围时，其将自动删除其所引用的对象。</p><pre>`TSharedPtr&lt;Person&gt; sp = MakeShared&lt;Person&gt;();     //创建共享指针TSharedRef&lt;Person&gt; sr = sp.ToSharedRef();         //创建共享引用TWeakPtr&lt;Person&gt; wp = sp;                         //创建弱指针int32 use_count = sp.GetSharedReferenceCount();   //共享指针计数TUniquePtr&lt;Person&gt; up = MakeUnique&lt;Person&gt;();     //创建唯一指针`</pre><h3 id="智能指针的循环引用"><a href="#智能指针的循环引用" class="headerlink" title="# 智能指针的循环引用"></a><a href="#%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E7%9A%84%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8">#</a> 智能指针的循环引用</h3><p>在使用基于引用计数的 TSharedPt r 智能指针时，为了防止循环引用带来的内存泄漏问题，可以让引用链上的一方持用弱智能指针 TWeakPtr 。弱智能指针不会影响共享引用计数器。</p><h2 id="如何使用-ParallelFor-提高速度"><a href="#如何使用-ParallelFor-提高速度" class="headerlink" title="# 如何使用 ParallelFor 提高速度"></a><a href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8parallelfor%E6%8F%90%E9%AB%98%E9%80%9F%E5%BA%A6">#</a> 如何使用 ParallelFor 提高速度</h2><p>ParallelFor 允许我们在一分钟内对任何 for 循环进行多线程处理，从而通过在多个线程之间拆分工作来划分执行时间。</p><pre>`//例1ParallelFor(num, [&amp;](int32 i) &#123;sum += i; &#125;);//例2FCriticalSection Mutex;ParallelFor(Input.Num(), [&amp;](int32 Idx)&#123;    if(Input[Idx] % 5 == 0)&#123;        Mutex.Lock();        Output.Add(Input[Idx]);        Mutex.Unlock();    &#125;&#125;);`</pre><h2 id="TMap-的实现原理"><a href="#TMap-的实现原理" class="headerlink" title="# TMap 的实现原理"></a><a href="#tmap%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">#</a> TMap 的实现原理</h2><p>TMap 是用基于数组的哈希表实现的，查询效率高，添加、删除效率低，查询的时间复杂度是<br>O (1) TMap 的排序采用的快速排序 ， 时间复杂度为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(nlog_2n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:.01968em">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-.03588em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></p><p>数据结构查询时间复杂度 优点缺点<br>map红黑树O (logn)内部自动排序，查询、添加、删除效率相同空间占用较大<br>unordered_map哈希表O (1)查询效率高内部元素无序杂乱添加、删除效率低<br>TMap哈希表O (1)查询效率高内部元素无序杂乱添加、删除效率低</p><h2 id="虚幻中有哪几种主要线程"><a href="#虚幻中有哪几种主要线程" class="headerlink" title="# 虚幻中有哪几种主要线程"></a><a href="#%E8%99%9A%E5%B9%BB%E4%B8%AD%E6%9C%89%E5%93%AA%E5%87%A0%E7%A7%8D%E4%B8%BB%E8%A6%81%E7%BA%BF%E7%A8%8B">#</a> 虚幻中有哪几种主要线程</h2><p>游戏线程（GameThread）：承载游戏逻辑、运行流程的工作，也是其它线程的数据发起者。在 FEngineLoop::Tick 函数执行每帧逻辑的更新。在引擎启动时会把 GameThread 的线程 id 存储到全局变量 GGameThreadId 中，且稍后会设置到 TaskGraph 系统中。</p><p>渲染线程（RenderThread）：RenderThread 在 TaskGraph 系统中有一个任务队列，其他线程（主要是 GameThread）通过宏 ENQUEUE_RENDER_COMMAND 向该队列中填充任务，RenderThread 则不断从这个队列中取出任务来执行，从而生成与平台无关的 Command List（渲染指令列表）。</p><p>RHI 线程（Render Hardware Interface Thread）：RenderThread 作为前端（frontend）产生的 Command List 是平台无关的，是抽象的图形 API 调用；而 RHIThread 作为后端（backend）会执行和转换渲染线程的 Command List 成为指定图形 API 的调用（称为 Graphical Command），并提交到 GPU 执行。RHI 线程的工作是转换渲染指令到指定图形 API，创建、上传渲染资源到 GPU。</p><h3 id="游戏线程和渲染线程的同步"><a href="#游戏线程和渲染线程的同步" class="headerlink" title="# 游戏线程和渲染线程的同步"></a><a href="#%E6%B8%B8%E6%88%8F%E7%BA%BF%E7%A8%8B%E5%92%8C%E6%B8%B2%E6%9F%93%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%90%8C%E6%AD%A5">#</a> 游戏线程和渲染线程的同步</h3><p>当 GameThread 与 RenderThread 同步时，GameThread 会创建一个 FNullGraphTask 空任务，放到 RenderThread 的 TaskGraph 队列中让其执行，在 FRenderCommandFence 的 Wait 函数中，会检查投递给 RenderThread 的 CompletionEvent 是否被执行，如果没有执行则调用 GameThreadWaitForTask 函数来阻塞等待。</p><h2 id="多线程-Task-Graphs"><a href="#多线程-Task-Graphs" class="headerlink" title="# 多线程 Task Graphß"></a><a href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B-task-graph%C3%9F">#</a> 多线程 Task Graphß</h2><p>TaskGraph 是 UE 中基于任务的并发机制。可以创建任务在指定类型的线程中执行，同时提供了等待机制，其强大之处在于可以调度一系列有依赖关系的任务，这些任务组成了一个有向无环的任务网络（DAG），并且任务的执行可以分布在不同的线程中。</p><pre>`void ATestTaskGraphActor::CreateTask(FString TaskName, const TArray&lt;TGraphTask&lt;FWorkTask&gt;*&gt;&amp; Prerequisites,  const TArray&lt;TGraphTask&lt;FWorkTask&gt;*&gt;&amp; ChildTasks)&#123;    //FWorkTask为自定义的类    FGraphEventArray PrerequisiteEvents;    TArray&lt;TGraphTask&lt;FWorkTask&gt;*&gt; ChildEvents;    for (auto Item : Prerequisites)        PrerequisiteEvents.Add(Item-&gt;GetCompletionEvent());    for (auto Item : ChildTasks)        ChildEvents.Add(Item);    TGraphTask&lt;FWorkTask&gt;::CreateTask(&amp;PrerequisiteEvents).ConstructAndDispatchWhenReady(TaskName, ChildEvents, this);&#125;`</pre><h2 id="后处理"><a href="#后处理" class="headerlink" title="# 后处理"></a><a href="#%E5%90%8E%E5%A4%84%E7%90%86">#</a> 后处理</h2><h3 id="后处理之泛光（Bloom）"><a href="#后处理之泛光（Bloom）" class="headerlink" title="# 后处理之泛光（Bloom）"></a><a href="#%E5%90%8E%E5%A4%84%E7%90%86%E4%B9%8B%E6%B3%9B%E5%85%89bloom">#</a> 后处理之泛光（Bloom）</h3><p>是一种现实世界中的光现象，通过它能够以较为适度的渲染性能成本极大地增加渲染图像的真实感。用肉眼观察黑暗背景下非常明亮 的物体时会看到泛光效果。泛光可以用一个高斯模糊来实现。为了提高质量，我们将多个不同半径的高斯模糊组合起来。为了获得更好的性能，我们在大大降低的分辨率下进行很宽范围的模糊。通过改变模糊效果的组合方式，我们可以进行更多的控制，取得更高的质量。为了获得最佳的性能，应该使用高分辨率模糊（小值）来实现较窄的模糊，而主要使用低分辨率模糊 （大值）实现较宽的模糊。</p><h3 id="后处理之轮廓描边"><a href="#后处理之轮廓描边" class="headerlink" title="# 后处理之轮廓描边"></a><a href="#%E5%90%8E%E5%A4%84%E7%90%86%E4%B9%8B%E8%BD%AE%E5%BB%93%E6%8F%8F%E8%BE%B9">#</a> 后处理之轮廓描边</h3></li><li><p>对需要描边的物体开启自定义深度缓存，物体所在区域会出现填充的具有深度信息的缓存区，通过后期处理对相邻像素进行采样来执行简单的深度比较，如果邻居有深度信息，但像素没有，就将其着色为轮廓线颜色</p></li><li><p>获取场景法线向量后，通过其中一个做一点点 UV 偏移，是两个结果做差，颜色值越接近，插值越小，相反越大，而一般需要描边的位置就是向量相差较大的像素点，再用基础颜色加上这个差值就会出现描边效果。</p><h2 id="蓝图大量连线为何会比-C-慢很多"><a href="#蓝图大量连线为何会比-C-慢很多" class="headerlink" title="# 蓝图大量连线为何会比 C++ 慢很多"></a><a href="#%E8%93%9D%E5%9B%BE%E5%A4%A7%E9%87%8F%E8%BF%9E%E7%BA%BF%E4%B8%BA%E4%BD%95%E4%BC%9A%E6%AF%94-c-%E6%85%A2%E5%BE%88%E5%A4%9A">#</a> 蓝图大量连线为何会比 C++ 慢很多</h2><p>蓝图的消耗主要是在节点之间，蓝图连线触发的消耗是一致的，但节点运行的消耗是通过 C++ , 节点不同就有所不同 ，所以蓝图中连线很多时会显著降低运行效率。</p><h2 id="模型闪烁问题如何解决"><a href="#模型闪烁问题如何解决" class="headerlink" title="# 模型闪烁问题如何解决"></a><a href="#%E6%A8%A1%E5%9E%8B%E9%97%AA%E7%83%81%E9%97%AE%E9%A2%98%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3">#</a> 模型闪烁问题如何解决</h2><p>当两个面共面时，会出现闪面现象。使用 UE4 材质中 Pixel Depth Offset 节点，进行像素偏移，达到共面不闪面的效果。</p><h2 id="slate-中常用的控件"><a href="#slate-中常用的控件" class="headerlink" title="# slate 中常用的控件"></a><a href="#slate%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E6%8E%A7%E4%BB%B6">#</a> slate 中常用的控件</h2><p>既能用于 Runtime 中的 UI，也能用于 Edit 状态下的操作界面创建，其强大的功能能满足你各种复杂的需求<br>SHorizontalBox：水平框</p><p>SVerticalBox：垂直框</p><p>SUniformGridPanel：统一网格面板，均匀地垂直和水平分发子控件的面板</p><p>SWrapBox：包围盒，水平排列控件的盒</p><h2 id="反射的作用"><a href="#反射的作用" class="headerlink" title="# 反射的作用"></a><a href="#%E5%8F%8D%E5%B0%84%E7%9A%84%E4%BD%9C%E7%94%A8">#</a> 反射的作用</h2><p>反射实现来支持引擎的动态功能，如垃圾回收、序列化、网络复制和蓝图 &#x2F; C++ 通信等。</p><h2 id="结构体中是否可以使用-UFUNCTION"><a href="#结构体中是否可以使用-UFUNCTION" class="headerlink" title="# 结构体中是否可以使用 UFUNCTION ()"></a><a href="#%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%AD%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8-ufunction">#</a> 结构体中是否可以使用 UFUNCTION ()</h2><p>不可以。反射系统不支持结构体中的函数，即使在 C++ 类和结构中实际上也具有与类相同的功能，UE4 约定将结构限制为仅包含数据结构，这种做法实际上赋予结构更多的存在感。</p><h2 id="UE-中垃圾回收的原理"><a href="#UE-中垃圾回收的原理" class="headerlink" title="# UE 中垃圾回收的原理"></a><a href="#ue-%E4%B8%AD%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9A%84%E5%8E%9F%E7%90%86">#</a> UE 中垃圾回收的原理</h2><p>UE4 采用了标记 - 清扫的垃圾回收方式，是一种经典的垃圾回收方式。一次垃圾回收分为两个阶段。第一阶段从一个根集合出发，遍历所有可达对象，遍历完成后就能标记出可达对象和不可达对象了，这个阶段会在一帧内完成。第二阶段会渐进式的清理这些不可达对象，因为不可达的对象将永远不能被访问到，所以可以分帧清理它们，避免一下子清理很多 UObject，比如 map 卸载时，发生明显的卡顿。</p><h2 id="UE-中有哪几种容器"><a href="#UE-中有哪几种容器" class="headerlink" title="# UE 中有哪几种容器"></a><a href="#ue-%E4%B8%AD%E6%9C%89%E5%93%AA%E5%87%A0%E7%A7%8D%E5%AE%B9%E5%99%A8">#</a> UE 中有哪几种容器</h2><p>TArray：是 UE4 中最常用的容器类，负责同类型其他对象（称为 &quot;元素&quot;）序列的所有权和组织。由于 TArray 是一个序列，其元素的排序定义明确，其函数用于确定性地操纵此类对象及其顺序。</p><p>TMap：继 TArray 之后，UE4 中最常用的容器是 TMap。TMap 主要由两个类型定义（一个键类型和一个值类型），以关联对的形式存储在映射中。与 TSet 类似，它们的结构均基于对键进行散列运算。但与 TSet 不同的是，此容器将数据存储为键值对（TPair&lt;KeyType, ValueType&gt;），只将键用于存储和获取。</p><p>TSet：是一种快速容器类，（通常）用于在排序不重要的情况下存储唯一元素。TSet 类似于 TMap 和 TMultiMap，但有一个重要区别：TSet 是通过对元素求值的可覆盖函数，使用数据值本身作为键，而不是将数据值与独立的键相关联。TSet 可以非常快速地添加、查找和删除元素（恒定时间）。默认情况下，TSet 不支持重复的键，但使用模板参数可激活此行为。</p><h2 id="gameplay-的框架"><a href="#gameplay-的框架" class="headerlink" title="# gameplay 的框架"></a><a href="#gameplay-%E7%9A%84%E6%A1%86%E6%9E%B6">#</a> gameplay 的框架</h2><p>UE 的游戏世界构成层级为：</p></li></ol><ul><li><p>GameInstance：游戏实例，由 GameEngine 创造出来，主要用于管理世界切换，UI 的加载，控制台命令和额外的逻辑，初始化 &#x2F; 关闭引擎，修改 GameMode，在线会话管理等一些全局性的内容。</p></li><li><p>World：游戏世界，常用结构体 FWorldContext 记录了游戏世界的各种信息使用在游戏世界切换等功能。</p></li><li><p>Level：一个游戏世界，可以分成多个 Level，比如将游戏场景分成一个 Level，灯光分成一个 Level 等等，这样有利于美术师进行场景搭建。关卡也分为 Persistence Level 和 Streaming Level，Persistence Level 是建立我们世界的主 Level，Streaming Level 是作为部分内容的 Level 按照我们定义的规则加载到 Persistence Level 里。</p></li><li><p>GameMode：定义游戏规则，存在于每个 World&#x2F;Level 中，并且只在服务器上，通过 GameState 来传递信息。</p></li><li><p>Actor：所有能放到游戏场景中的对象的基类都是 AActor。</p></li><li><p>Component：表现 Actor 的各种构成部分，UE 中的 Component 类能够附加到 Actor 上。<br>Gameplay 的 3C 概念，就是 Character、Camera、Control。Character 表现游戏世界中的玩家，拥有游戏世界中最复杂的行为，对于程序员来说，要负责处理角色的移动，动画，皮肤（装备）等。Camera 处理游戏视角，表现游戏世界，第一人称，第三人称，FOV，VFX，后处理，抖动等。Control 处理输入（来自鼠标键盘，手柄，模拟器等，以及输入模式例如单击、按住、双击），匹配输入逻辑（按键映射），处理回应输入的逻辑，UI 交互，以及物理模拟，AI 驱动等。</p><h2 id="Unreal-中使用的光线追踪方法有哪些"><a href="#Unreal-中使用的光线追踪方法有哪些" class="headerlink" title="# Unreal 中使用的光线追踪方法有哪些"></a><a href="#unreal-%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%9A%84%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA%E6%96%B9%E6%B3%95%E6%9C%89%E5%93%AA%E4%BA%9B">#</a> Unreal 中使用的光线追踪方法有哪些</h2></li></ul><ol><li><p>Ray Traced Reflections 反射。这种方法可以生成准确的反射，包括多重反射，即反射中的反射。它比传统的屏幕空间反射（Screen Space Reflections, SSR）提供了更广阔的视野和更高的准确性，因为它不仅限于屏幕上已渲染的信息。</p></li><li><p>Ray Traced Refractions 折射。 用于透明和半透明材质，如玻璃，水等，提供更真实的光线折射效果。</p></li><li><p>Ray Traced Shadows: 提供更精确的软阴影效果。它能够处理复杂的光线遮挡关系，包括透明度遮挡和细微阴影细节。</p></li><li><p>Ray Traced Ambient Occlusion: 增强了环境光遮挡的效果，提供更真实的局部阴影，尤其是在物体相互靠近的地方。</p></li><li><p>Ray Traced Global Illumination: 用于计算场景的间接照明，比传统的全局照明技术如光照贴图或屏幕空间的间接照明提供更真实的光照效果。</p></li><li><p>Ray Traced Translucency: 允许更真实地渲染半透明材料，如皮肤、蜡、叶子等</p><h1 id="计算机网络"><a href="#计算机网络" class="headerlink" title="# 计算机网络"></a><a href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C">#</a> 计算机网络</h1><h2 id="网络协议-network-protocol-为什么要对网络协议分层"><a href="#网络协议-network-protocol-为什么要对网络协议分层" class="headerlink" title="# 网络协议 (network protocol) 为什么要对网络协议分层"></a><a href="#%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEnetwork-protocol-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AF%B9%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%88%86%E5%B1%82">#</a> 网络协议 (network protocol) 为什么要对网络协议分层</h2></li><li><p>网络协议是计算机在通信过程中要遵循的一些约定好的规则。</p></li><li><p>网络分层的原因：易于实现和维护，因为各层之间是独立的，层与层之间不会收到影响。<br>有利于标准化的制定</p><h3 id="各层协议的作用"><a href="#各层协议的作用" class="headerlink" title="# 各层协议的作用"></a><a href="#%E5%90%84%E5%B1%82%E5%8D%8F%E8%AE%AE%E7%9A%84%E4%BD%9C%E7%94%A8">#</a> 各层协议的作用</h3><p>OSI 七层模型：应用层，表示层，会话层，运输层，网络层，数据链路层，物理层<br>TCP&#x2F;IP: 应用层，运输层，网络层，网络接口层<br>五层协议：应用层，运输层，网络层，数据链路层，物理层</p></li></ol><ul><li><p>应用层<br>应用层的任务是通过应用进程之间的交互来完成特定的网络作用，常见的应用层协议有域名系统 DNS，HTTP 协议等。</p></li><li><p>表示层<br>表示层的主要作用是数据的表示、安全、压缩。可确保一个系统的应用层所发送的信息可以被另一个系统的应用层读取。</p></li><li><p>会话层<br>会话层的主要作用是建立通信链接，保持会话过程通信链接的畅通，同步两个节点之间的对话，决定通信是否被中断以及通信中断时决定从何处重新发送。。</p></li><li><p>传输层<br>传输层的主要作用是负责向两台主机进程之间的通信提供数据传输服务。传输层的协议主要有传输控制协议 TCP 和用户数据协议 UDP。</p></li><li><p>网络层</p></li><li><p>网络层的主要作用是选择合适的网间路由和交换结点，确保数据及时送达。常见的协议有 IP 协议。<br>数据链路层<br>数据链路层的作用是在物理层提供比特流服务的基础上，建立相邻结点之间的数据链路，通过差错控制提供数据帧（Frame）在信道上无差错的传输，并进行各电路上的动作系列。 常见的协议有 SDLC、HDLC、PPP 等。</p></li><li><p>物理层<br>物理层的主要作用是实现相邻计算机结点之间比特流的透明传输，并尽量屏蔽掉具体传输介质和物理设备的差异。</p><h2 id="URI-和-URL-的区别"><a href="#URI-和-URL-的区别" class="headerlink" title="# URI 和 URL 的区别"></a><a href="#uri-%E5%92%8C-url%E7%9A%84%E5%8C%BA%E5%88%AB">#</a> URI 和 URL 的区别</h2></li><li><p>URI (Uniform Resource Identifier)：中文全称为统一资源标志符，主要作用是唯一标识一个资源。</p></li><li><p>URL (Uniform Resource Location)：中文全称为统一资源定位符，主要作用是提供资源的路径。<br>有个经典的比喻是 URI 像是身份证，可以唯一标识一个人，而 URL 更像一个住址，可以通过 URL 找到这个人。</p><h2 id="TCP-与-UDP-的区别"><a href="#TCP-与-UDP-的区别" class="headerlink" title="# TCP 与 UDP 的区别"></a><a href="#tcp%E4%B8%8Eudp%E7%9A%84%E5%8C%BA%E5%88%AB">#</a> TCP 与 UDP 的区别</h2><p><img src="https://pic4.zhimg.com/80/v2-56c4aadebbb33c0e7db62f5a453a1a97_1440w.webp" alt="alt text"></p></li><li><p>TCP 是一种面向连接的协议，意味着在数据传输开始之前，必须先建立连接。TCP 通过三次握手过程建立连接，确保双方都准备好接收和发送数据。<br>UDP 是一种无连接的协议，发送数据之前不需要建立连接。这使得 UDP 的速度通常比 TCP 快，但也更不可靠。</p></li><li><p>TCP 提供可靠的数据传输，通过序号、确认应答、重传机制等确保数据的正确顺序和完整性。如果发现数据丢失或错误，TCP 会自动重传丢失的数据包。<br>UDP 不保证数据的可靠性或顺序，接收端收到数据的顺序可能与发送顺序不同，且丢失的数据包不会被重传。</p></li><li><p>TCP 适用于要求高可靠性的应用，如网页浏览、文件传输、电子邮件等。<br>UDP 通常用于对实时性要求较高的应用，如视频流、VoIP（网络电话）、在线游戏等，这些应用可以容忍一定程度的数据丢失，但需要高速传输。</p><p>简而言之，TCP 更注重数据的可靠传输，而 UDP 则更注重传输效率。根据不同的应用需求选择合适的协议非常重要。</p><h3 id="TCP-三次握手"><a href="#TCP-三次握手" class="headerlink" title="# TCP 三次握手"></a><a href="#tcp-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B">#</a> TCP 三次握手</h3><p><img src="https://pic2.zhimg.com/80/v2-ccf7e0dbf44c29c82be8212d2c004da1_1440w.webp" alt="alt text"></p></li><li><p>seq: 序号：seq，占 32 位，用来标识从发送端到接收端发送的字节流。</p></li><li><p>ack: 确认号：ack，占 32 位，只有 ACK 标志位为 1 时，确认序号字段才有效，ack&#x3D;seq+1。</p></li><li><p>SYN: 标志位：SYN：发起一个新连接。</p></li><li><p>FIN：释放一个连接。</p></li><li><p>ACK：确认序号有效。</p><h1 id="graphic-card"><a href="#graphic-card" class="headerlink" title="# graphic card"></a><a href="#graphic-card">#</a> graphic card</h1><h3 id="cpu-与-gpu-的区别？"><a href="#cpu-与-gpu-的区别？" class="headerlink" title="# cpu 与 gpu 的区别？"></a><a href="#cpu%E4%B8%8Egpu%E7%9A%84%E5%8C%BA%E5%88%AB">#</a> cpu 与 gpu 的区别？</h3><p>CPU 的设计着重于处理单个线程的复杂计算和控制流程。<br>GPU 被设计用于高密度和并行计算，更多的晶体管投入到数据处理而不是数据缓存和流量控制<br>体现在 GPU 的 ALU（算术逻辑运算单元）数量更多</p><h3 id="ALU-全称是算术逻辑单元（Arithmetic-Logic-Unit）"><a href="#ALU-全称是算术逻辑单元（Arithmetic-Logic-Unit）" class="headerlink" title="# ALU, 全称是算术逻辑单元（Arithmetic Logic Unit）"></a><a href="#alu-%E5%85%A8%E7%A7%B0%E6%98%AF%E7%AE%97%E6%9C%AF%E9%80%BB%E8%BE%91%E5%8D%95%E5%85%83arithmetic-logic-unit">#</a> ALU, 全称是算术逻辑单元（Arithmetic Logic Unit）</h3><p>，是计算机处理器（CPU）和其他数字电路中的一个关键组件。它主要负责执行所有的算术和逻辑运算。以下是 ALU 的一些主要功能：</p><p>算术运算：包括加法、减法、乘法和除法。<br>逻辑运算：包括与（AND）、或（OR）、非（NOT）和异或（XOR）等逻辑操作。<br>移位操作：包括左移、右移等位移操作。<br>比较操作：包括大于、小于、等于等比较运算。<br>在现代计算机系统中，ALU 通常与控制单元（Control Unit）和寄存器（Registers）等其他组件一起工作，构成了中央处理单元（CPU）的核心部分。ALU 接收来自寄存器或内存的数据，根据控制单元的指令执行相应的运算，并将结果存储回寄存器或内存中。</p><h2 id="cuda"><a href="#cuda" class="headerlink" title="# cuda"></a><a href="#cuda">#</a> cuda</h2><pre>`#include &lt;stdio.h&gt;#include &lt;cuda_runtime.h&gt;// CUDA 内核函数，在 GPU 上执行__global__ void vectorAdd(float *a, float *b, float *c, int n) &#123;    int i = blockDim.x * blockIdx.x + threadIdx.x;    if (i &lt; n) &#123;        c[i] = a[i] + b[i];    &#125;&#125;int main() &#123;    int n = 1 &lt;&lt; 20; // 向量大小（1,048,576）    size_t size = n * sizeof(float);    // 在主机（CPU）上分配内存    float *h_a = (float *)malloc(size);    float *h_b = (float *)malloc(size);    float *h_c = (float *)malloc(size);    // 初始化向量    for (int i = 0; i &lt; n; i++) &#123;        h_a[i] = 1.0f;        h_b[i] = 2.0f;    &#125;    // 在设备（GPU）上分配内存    float *d_a, *d_b, *d_c;    cudaMalloc((void **)&amp;d_a, size);    cudaMalloc((void **)&amp;d_b, size);    cudaMalloc((void **)&amp;d_c, size);    // 将数据从主机复制到设备    cudaMemcpy(d_a, h_a, size, cudaMemcpyHostToDevice);    cudaMemcpy(d_b, h_b, size, cudaMemcpyHostToDevice);    // 定义执行配置    int blockSize = 256;    int numBlocks = (n + blockSize - 1) / blockSize;    // 启动 CUDA 内核    vectorAdd&lt;&lt;&lt;numBlocks, blockSize&gt;&gt;&gt;(d_a, d_b, d_c, n);    // 将结果从设备复制到主机    cudaMemcpy(h_c, d_c, size, cudaMemcpyDeviceToHost);    // 验证结果    for (int i = 0; i &lt; n; i++) &#123;        if (h_c[i] != 3.0f) &#123;            printf(&quot;Error at index %d: %f\n&quot;, i, h_c[i]);            break;        &#125;    &#125;    printf(&quot;Vector addition completed successfully.\n&quot;);    // 释放内存    free(h_a);    free(h_b);    free(h_c);    cudaFree(d_a);    cudaFree(d_b);    cudaFree(d_c);    return 0;&#125;</li></ul><h3 id="cuda-编程中的-SM-SP-是什么"><a href="#cuda-编程中的-SM-SP-是什么" class="headerlink" title="# cuda 编程中的 SM SP 是什么"></a><a href="#cuda%E7%BC%96%E7%A8%8B%E4%B8%AD%E7%9A%84sm-sp-%E6%98%AF%E4%BB%80%E4%B9%88">#</a> cuda 编程中的 SM SP 是什么</h3><p>SP (streaming processor), 计算核心，最基本处理单元<br>SM (Streaming multiprocessor), 多个 SP 加上其他找资源组成一个 SM</p><h3 id="CUDA-编程的内存模型"><a href="#CUDA-编程的内存模型" class="headerlink" title="# CUDA 编程的内存模型"></a><a href="#cuda-%E7%BC%96%E7%A8%8B%E7%9A%84%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B">#</a> CUDA 编程的内存模型</h3><ol><li>全局内存（Global Memory）<br>描述：全局内存是 GPU 上的主要内存空间，所有线程块（blocks）中的所有线程都可以访问。<br>特点：<br>高延迟，但大容量。<br>访问时需要进行内存协作以提高性能（如合并访问）。<br>用于存储在不同线程块之间共享的数据或大数据集。<br>使用：通过 CUDA API 函数如 cudaMalloc 和 cudaMemcpy 分配和管理。</li><li>共享内存（Shared Memory）<br>描述：共享内存是每个线程块中的所有线程可以访问的快速内存空间。它是按线程块划分的，每个线程块都有自己的共享内存。<br>特点：<br>低延迟，比全局内存更快。<br>小容量，但可用作线程块内部的数据共享和缓存。<br>可以通过 CUDA 内核中的 <strong>shared</strong> 关键字声明。<br>使用：适合需要在同一线程块中多个线程共享和频繁访问的数据。</li><li>寄存器（Registers）<br>描述：寄存器是每个线程私有的快速存储器，用于存储线程的局部变量。<br>特点：<br>非常低的延迟，最快的内存。<br>每个线程有一个固定数量的寄存器，数量有限。<br>由编译器自动分配。<br>使用：适合存储局部变量和频繁访问的数据。</li></ol><h2 id="CUDA-编程的软件模型"><a href="#CUDA-编程的软件模型" class="headerlink" title="# CUDA 编程的软件模型"></a><a href="#cuda-%E7%BC%96%E7%A8%8B%E7%9A%84%E8%BD%AF%E4%BB%B6%E6%A8%A1%E5%9E%8B">#</a> CUDA 编程的软件模型</h2><ol><li>线程（Thread）<br>描述：线程是 CUDA 程序的基本执行单元。每个线程在 GPU 上独立执行一段代码（内核函数）。<br>特点：<br>每个线程都有自己的寄存器和本地内存。<br>线程在块（block）中组织，并由块索引（blockIdx）和线程索引（threadIdx）唯一标识。<br>通过内核函数中的 threadIdx 和 blockIdx 获取索引。</li><li>线程块（Thread Block）<br>描述：线程块是一组可以共享共享内存和同步的线程。每个线程块中的线程数量和结构在内核启动时指定。<br>特点：<br>每个线程块可以包含最多 1024 个线程（具体数量取决于 GPU 硬件）。<br>线程块可以在不同的流式多处理器（SM）上独立执行。<br>线程块内的线程可以使用 __syncthreads () 进行同步。</li><li>线程格（Grid）<br>描述：线程格是由多个线程块组成的结构，用于表示并行任务的总大小。每次启动一个内核函数时，会创建一个线程格。<br>特点：<br>线程格中的所有线程块可以独立执行。<br>线程格的大小在内核启动时指定，使用 dim3 结构定义。<br>线程格可以是一维、二维或三维的。</li></ol><h3 id="使用共享内存时需要注意什么？"><a href="#使用共享内存时需要注意什么？" class="headerlink" title="# 使用共享内存时需要注意什么？"></a><a href="#%E4%BD%BF%E7%94%A8%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E6%97%B6%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E4%BB%80%E4%B9%88">#</a> 使用共享内存时需要注意什么？</h3><h4 id="线程同步"><a href="#线程同步" class="headerlink" title="# 线程同步"></a><a href="#%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5">#</a> 线程同步</h4><p>__syncthreads（） 在利用共享内存进行线程块之间合作通信前，都要进行同步，以确保共享内存变量中的数据对线程块内的所有线程来说都准备就绪</p><h4 id="避免共享内存的-bank-冲突"><a href="#避免共享内存的-bank-冲突" class="headerlink" title="# 避免共享内存的 bank 冲突"></a><a href="#%E9%81%BF%E5%85%8D%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E7%9A%84-bank-%E5%86%B2%E7%AA%81">#</a> 避免共享内存的 bank 冲突</h4><p>bank 冲突概念：同一线程束内的多个线程试图访问同一个 bank 中不同层的数据时，造成 bank 冲突<br>只要同一线程束内的多个线程不同时访问同一个 bank 中不同层的数据，该线程束对共享内存的访问就只需要一次内存事务</p><h2 id="ROCm"><a href="#ROCm" class="headerlink" title="# ROCm"></a><a href="#rocm">#</a> ROCm</h2><p>ROCm（Radeon Open Compute）是 AMD 提供的开源高性能计算（HPC）和机器学习平台，旨在支持在 AMD GPU 上进行并行计算和加速计算。ROCm 提供了一套软件工具和库，使开发者能够利用 AMD GPU 的强大计算能力。以下是 ROCm 的主要组件和特点的介绍：</p><h2 id="显卡驱动"><a href="#显卡驱动" class="headerlink" title="# 显卡驱动"></a><a href="#%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8">#</a> 显卡驱动</h2><h3 id="驱动程序架构"><a href="#驱动程序架构" class="headerlink" title="# 驱动程序架构"></a><a href="#%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84">#</a> 驱动程序架构</h3><ol><li>内核模式驱动程序（Kernel-Mode Driver）：</li></ol><p>直接与 GPU 硬件交互。<br>负责硬件初始化、内存管理、上下文切换和硬件中断处理。<br>在 Windows 上，称为 AMD KMD（Kernel Mode Driver）。<br>在 Linux 上，通常是开源的 AMDGPU 驱动程序。</p><ol><li>用户模式驱动程序（User-Mode Driver）：</li></ol><p>运行在用户空间，与操作系统的图形子系统和应用程序交互。<br>提供图形 API 支持，如 DirectX、OpenGL 和 Vulkan。<br>负责图形命令的处理、着色器编译和优化。</p><h3 id="驱动程序组件"><a href="#驱动程序组件" class="headerlink" title="# 驱动程序组件"></a><a href="#%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F%E7%BB%84%E4%BB%B6">#</a> 驱动程序组件</h3><ol><li>显示驱动程序（Display Driver）：</li></ol><p>负责显示输出管理，包括屏幕分辨率设置、刷新率调整和多显示器支持。<br>处理与操作系统的窗口管理系统的交互。</p><ol><li>计算驱动程序 (Compute Driver):</li></ol><p>提供对通用计算 API 的支持，如 OpenCL 和 ROCm。<br>允许使用 GPU 进行高性能计算任务，如科学计算、机器学习和数据分析。</p><ol><li>多媒体驱动程序（Multimedia Driver）：</li></ol><p>支持视频编码和解码加速（如 H.264、H.265）。<br>处理多媒体应用程序的图像处理和视频播放任务。</p><h1 id="papers"><a href="#papers" class="headerlink" title="# papers"></a><a href="#papers">#</a> papers</h1><p>最近读的 paper</p><ol><li>Adjoint-Driven Russian Roulette and Splitting in Light Transport Simulation.</li><li>Generalizing Shallow Water Simulations with Dispersive Surface Waves.</div><footer><div class="meta"><span class="item"><span class="icon"> </span><span class="text">Edited on</span> <time title="Modified: 2024-05-21 23:23:31" itemprop="dateModified" datetime="2024-05-21T23:23:31-04:00">2024-05-21</time></span></div><div id="copyright"></li></ol><ul><li>**Post author: **DOTAFS <strong>@</strong></li><li>**Post link: **<a href="http://dotafs.com/2024/05/11/interview-script/" title="interview script">http://dotafs.com/2024/05/11/interview-script/</a></li><li>**Copyright Notice: **All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo">__(CC)__BY-NC-SA</span> unless stating additionally.</div></footer></article></div><div class="post-nav"><div class="item left">[<span class="type">Previous Post</span> <span class="category"></span></li></ul><h3 id="CS5310-learning-notes"><a href="#CS5310-learning-notes" class="headerlink" title="CS5310-learning-notes"></a>CS5310-learning-notes</h3><p>](&#x2F;2024&#x2F;05&#x2F;08&#x2F;CS5310-learning-notes&#x2F; “CS5310-learning-notes”)</div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"></p><ol><li><p><a href="#computer-graphic"><span class="toc-number">1.</span> <span class="toc-text">Computer graphic</span></a></p><pre><code class="hljs">1.  [&lt;span class=&quot;toc-number&quot;&gt;1.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;graphic pipeline&lt;/span&gt;](#graphic-pipeline)        1.  [&lt;span class=&quot;toc-number&quot;&gt;1.1.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;Application 配置基础信息&lt;/span&gt;](#application-%E9%85%8D%E7%BD%AE%E5%9F%BA%E7%A1%80%E4%BF%A1%E6%81%AF)2.  [&lt;span class=&quot;toc-number&quot;&gt;1.1.2.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;空间加速算法 (Spatial Acceleration)&lt;/span&gt;](#%E7%A9%BA%E9%97%B4%E5%8A%A0%E9%80%9F%E7%AE%97%E6%B3%95spatial-acceleration)                1.  [&lt;span class=&quot;toc-number&quot;&gt;1.1.2.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;spatial partition vs object partition&lt;/span&gt;](#spatial-partition-vs-object-partition)    2.  [&lt;span class=&quot;toc-number&quot;&gt;1.1.2.2.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;基于空间 (spatial partition)&lt;/span&gt;](#%E5%9F%BA%E4%BA%8E%E7%A9%BA%E9%97%B4spatial-partition)    3.  [&lt;span class=&quot;toc-number&quot;&gt;1.1.2.3.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;基于物体&lt;/span&gt;](#%E5%9F%BA%E4%BA%8E%E7%89%A9%E4%BD%93)3.  [&lt;span class=&quot;toc-number&quot;&gt;1.1.3.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;视锥剔除 (View frustum culling)&lt;/span&gt;](#%E8%A7%86%E9%94%A5%E5%89%94%E9%99%A4view-frustum-culling)</code></pre><ol start="2"><li><p><a href="#shaders%E7%9D%80%E8%89%B2%E5%99%A8"><span class="toc-number">1.2.</span> <span class="toc-text">shaders (着色器)</span></a></p><pre><code class="hljs">    1.  [&lt;span class=&quot;toc-number&quot;&gt;1.2.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;顶点着色器（Vertex Shader）：&lt;/span&gt;](#%E9%A1%B6%E7%82%B9%E7%9D%80%E8%89%B2%E5%99%A8vertex-shader)</code></pre><ol start="2"><li><a href="#%E6%9B%B2%E9%9D%A2%E7%BB%86%E5%88%86%E7%9D%80%E8%89%B2%E5%99%A8tessellation-shader"><span class="toc-number">1.2.2.</span> <span class="toc-text">曲面细分着色器（Tessellation Shader）：</span></a></li><li><a href="#%E5%87%A0%E4%BD%95%E7%9D%80%E8%89%B2%E5%99%A8geometry-shader"><span class="toc-number">1.2.3.</span> <span class="toc-text">几何着色器（Geometry Shader）：</span></a></li><li><a href="#%E7%89%87%E6%AE%B5%E7%9D%80%E8%89%B2%E5%99%A8fragment-shader"><span class="toc-number">1.2.4.</span> <span class="toc-text">片段着色器（Fragment Shader）：</span></a></li><li><a href="#%E8%AE%A1%E7%AE%97%E7%9D%80%E8%89%B2%E5%99%A8compute-shader"><span class="toc-number">1.2.5.</span> <span class="toc-text">计算着色器（Compute Shader）：</span></a></li></ol></li><li><p><a href="#light-mapping%E5%85%89%E7%85%A7%E8%B4%B4%E5%9B%BE"><span class="toc-number">1.3.</span> <span class="toc-text">light mapping (光照贴图)</span></a></p></li><li><p><a href="#%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8Billumination-model"><span class="toc-number">1.4.</span> <span class="toc-text">光照模型 (illumination model)</span></a></p><pre><code class="hljs">    1.  [&lt;span class=&quot;toc-number&quot;&gt;1.4.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;局部光照模型 (local illumination model)&lt;/span&gt;](#%E5%B1%80%E9%83%A8%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8Blocal-illumination-model)</code></pre><ol start="2"><li><a href="#%E5%85%A8%E5%B1%80%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8Bglobal-illumination-model"><span class="toc-number">1.4.2.</span> <span class="toc-text">全局光照模型 (global illumination model)</span></a></li></ol></li><li><p><a href="#ray-tracing"><span class="toc-number">1.5.</span> <span class="toc-text">ray tracing</span></a></p></li><li><p><a href="#render-equation"><span class="toc-number">1.6.</span> <span class="toc-text">render equation</span></a></p></li><li><p><a href="#deferred-rendering"><span class="toc-number">1.7.</span> <span class="toc-text">deferred rendering</span></a></p><pre><code class="hljs">    1.  [&lt;span class=&quot;toc-number&quot;&gt;1.7.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;forward rendering&lt;/span&gt;](#forward-rendering)</code></pre></li><li><p><a href="#shadow"><span class="toc-number">1.8.</span> <span class="toc-text">shadow</span></a></p><pre><code class="hljs">    1.  [&lt;span class=&quot;toc-number&quot;&gt;1.8.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;CSM:&lt;/span&gt;](#csm)</code></pre></li><li><p><a href="#pbr"><span class="toc-number">1.9.</span> <span class="toc-text">PBR</span></a></p><pre><code class="hljs">    1.  [&lt;span class=&quot;toc-number&quot;&gt;1.9.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;PBR 概念&lt;/span&gt;](#pbr%E6%A6%82%E5%BF%B5)</code></pre><ol start="2"><li><p><a href="#1-brdf%E5%8F%8C%E5%90%91%E5%8F%8D%E5%B0%84%E5%88%86%E5%B8%83%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.2.</span> <span class="toc-text">1. BRDF（双向反射分布函数）</span></a></p></li><li><p><a href="#2-%E8%83%BD%E9%87%8F%E5%AE%88%E6%81%92"><span class="toc-number">1.9.3.</span> <span class="toc-text">2. 能量守恒</span></a></p></li><li><p><a href="#3-%E5%BE%AE%E8%A1%A8%E9%9D%A2%E7%90%86%E8%AE%BA"><span class="toc-number">1.9.4.</span> <span class="toc-text">3. 微表面理论</span></a></p></li><li><p><a href="#pbr-%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8F%82%E6%95%B0"><span class="toc-number">1.9.5.</span> <span class="toc-text">PBR 的主要参数</span></a></p><pre><code class="hljs">        1.  [&lt;span class=&quot;toc-number&quot;&gt;1.9.5.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;1. Albedo（反照率）&lt;/span&gt;](#1-albedo%E5%8F%8D%E7%85%A7%E7%8E%87)</code></pre><ol start="2"><li><a href="#2-metalness%E9%87%91%E5%B1%9E%E6%80%A7"><span class="toc-number">1.9.5.2.</span> <span class="toc-text">2. Metalness（金属性）</span></a></li><li><a href="#3-roughness%E7%B2%97%E7%B3%99%E5%BA%A6"><span class="toc-number">1.9.5.3.</span> <span class="toc-text">3. Roughness（粗糙度）</span></a></li><li><a href="#4-normal-map%E6%B3%95%E7%BA%BF%E8%B4%B4%E5%9B%BE"><span class="toc-number">1.9.5.4.</span> <span class="toc-text">4. Normal Map（法线贴图）</span></a></li><li><a href="#5-ambient-occlusion%E7%8E%AF%E5%A2%83%E5%85%89%E9%81%AE%E8%94%BD"><span class="toc-number">1.9.5.5.</span> <span class="toc-text">5. Ambient Occlusion（环境光遮蔽）</span></a></li></ol></li><li><p><a href="#pbr-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.9.6.</span> <span class="toc-text">PBR 工作流程</span></a></p></li><li><p><a href="#cook-torrance"><span class="toc-number">1.9.7.</span> <span class="toc-text">Cook-Torrance</span></a></p><pre><code class="hljs">        1.  [&lt;span class=&quot;toc-number&quot;&gt;1.9.7.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;Cook-Torrance 模型的优点&lt;/span&gt;](#cook-torrance-%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BC%98%E7%82%B9)</code></pre></li></ol></li><li><p><a href="#mvp"><span class="toc-number">1.10.</span> <span class="toc-text">MVP</span></a></p><pre><code class="hljs">   1.  [&lt;span class=&quot;toc-number&quot;&gt;1.10.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;MVP 矩阵公式推导&lt;/span&gt;](#mvp-%E7%9F%A9%E9%98%B5%E5%85%AC%E5%BC%8F%E6%8E%A8%E5%AF%BC)</code></pre></li><li><p><a href="#%E9%99%8D%E4%BD%8Edrawcall"><span class="toc-number">1.11.</span> <span class="toc-text">降低 drawCall</span></a></p><pre><code class="hljs">   1.  [&lt;span class=&quot;toc-number&quot;&gt;1.11.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;合并几何体（Geometry Merging）&lt;/span&gt;](#%E5%90%88%E5%B9%B6%E5%87%A0%E4%BD%95%E4%BD%93geometry-merging)</code></pre></li></ol><pre><code class="hljs">2.  [&lt;span class=&quot;toc-number&quot;&gt;1.11.2.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;实例化渲染（Instanced Rendering）&lt;/span&gt;](#%E5%AE%9E%E4%BE%8B%E5%8C%96%E6%B8%B2%E6%9F%93instanced-rendering)3.  [&lt;span class=&quot;toc-number&quot;&gt;1.11.3.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;使用纹理图集（Texture Atlas）&lt;/span&gt;](#%E4%BD%BF%E7%94%A8%E7%BA%B9%E7%90%86%E5%9B%BE%E9%9B%86texture-atlas)4.  [&lt;span class=&quot;toc-number&quot;&gt;1.11.4.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;批处理（Batching）&lt;/span&gt;](#%E6%89%B9%E5%A4%84%E7%90%86batching)5.  [&lt;span class=&quot;toc-number&quot;&gt;1.11.5.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;动态管理资源（Dynamic Resource Management）&lt;/span&gt;](#%E5%8A%A8%E6%80%81%E7%AE%A1%E7%90%86%E8%B5%84%E6%BA%90dynamic-resource-management)6.  [&lt;span class=&quot;toc-number&quot;&gt;1.11.6.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;使用多重索引缓冲区（Multi-Index Buffers）&lt;/span&gt;](#%E4%BD%BF%E7%94%A8%E5%A4%9A%E9%87%8D%E7%B4%A2%E5%BC%95%E7%BC%93%E5%86%B2%E5%8C%BAmulti-index-buffers)7.  [&lt;span class=&quot;toc-number&quot;&gt;1.11.7.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;减少状态改变（State Changes）&lt;/span&gt;](#%E5%87%8F%E5%B0%91%E7%8A%B6%E6%80%81%E6%94%B9%E5%8F%98state-changes)8.  [&lt;span class=&quot;toc-number&quot;&gt;1.11.8.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;使用更高效的资源绑定方式&lt;/span&gt;](#%E4%BD%BF%E7%94%A8%E6%9B%B4%E9%AB%98%E6%95%88%E7%9A%84%E8%B5%84%E6%BA%90%E7%BB%91%E5%AE%9A%E6%96%B9%E5%BC%8F)</code></pre><ol start="12"><li><p><a href="#%E6%9D%82%E9%A1%B9"><span class="toc-number">1.12.</span> <span class="toc-text">杂项</span></a></p><pre><code class="hljs">   1.  [&lt;span class=&quot;toc-number&quot;&gt;1.12.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;billboard 有什么作用？原理是什么？&lt;/span&gt;](#billboard%E6%9C%89%E4%BB%80%E4%B9%88%E4%BD%9C%E7%94%A8%E5%8E%9F%E7%90%86%E6%98%AF%E4%BB%80%E4%B9%88)</code></pre></li></ol><pre><code class="hljs">2.  [&lt;span class=&quot;toc-number&quot;&gt;1.12.2.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;说一说蒙特卡洛的原理？&lt;/span&gt;](#%E8%AF%B4%E4%B8%80%E8%AF%B4%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%9A%84%E5%8E%9F%E7%90%86)</code></pre></li><li><p><a href="#c"><span class="toc-number">2.</span> <span class="toc-text">C++</span></a></p><pre><code class="hljs">1.  [&lt;span class=&quot;toc-number&quot;&gt;2.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;smart pointers&lt;/span&gt;](#smart-pointers)        1.  [&lt;span class=&quot;toc-number&quot;&gt;2.1.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;std::move 实现原理&lt;/span&gt;](#stdmove%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86)</code></pre><ol start="2"><li><p><a href="#virtual-function"><span class="toc-number">2.2.</span> <span class="toc-text">virtual function</span></a></p><pre><code class="hljs">    1.  [&lt;span class=&quot;toc-number&quot;&gt;2.2.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;用途:&lt;/span&gt;](#%E7%94%A8%E9%80%94)</code></pre><ol start="2"><li><p><a href="#%E5%B0%8F%E9%97%AE%E9%A2%98"><span class="toc-number">2.2.2.</span> <span class="toc-text">小问题</span></a></p><pre><code class="hljs">        1.  [&lt;span class=&quot;toc-number&quot;&gt;2.2.2.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;虚函数如何实现&lt;/span&gt;](#%E8%99%9A%E5%87%BD%E6%95%B0%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0)</code></pre><ol start="2"><li><a href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E4%B8%8D%E8%83%BD%E5%AE%9A%E4%B9%89%E4%B8%BA%E8%99%9A%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.2.2.</span> <span class="toc-text">构造函数不能定义为虚函数</span></a></li><li><a href="#%E8%99%9A%E5%87%BD%E6%95%B0%E8%A1%A8%E5%AD%98%E6%94%BE%E5%9C%A8%E5%93%AA%E4%B8%AA%E5%86%85%E5%AD%98%E5%8C%BA"><span class="toc-number">2.2.2.3.</span> <span class="toc-text">虚函数表存放在哪个内存区？</span></a></li><li><a href="#structint-char%E5%A4%A7%E5%B0%8F%E5%8A%A0%E4%B8%80%E4%B8%AA%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E4%B9%8B%E5%90%8E%E5%91%A2%E5%8A%A0%E4%B8%80%E4%B8%AA%E8%99%9A%E5%87%BD%E6%95%B0%E4%B9%8B%E5%90%8E%E5%91%A2"><span class="toc-number">2.2.2.4.</span> <span class="toc-text">struct（int char）大小，加一个静态变量之后呢？加一个虚函数之后呢？</span></a></li><li><a href="#%E5%88%9B%E5%BB%BA10%E4%B8%AA%E5%AE%9E%E4%BE%8B%E6%9C%89%E5%87%A0%E4%B8%AA%E8%99%9A%E5%87%BD%E6%95%B0%E8%A1%A8"><span class="toc-number">2.2.2.5.</span> <span class="toc-text">创建 10 个实例有几个虚函数表？</span></a></li><li><a href="#%E5%93%AA%E4%BA%9B%E4%B8%8D%E8%83%BD%E6%98%AF%E8%99%9A%E5%87%BD%E6%95%B0"><span class="toc-number">2.2.2.6.</span> <span class="toc-text">哪些不能是虚函数</span></a></li></ol></li></ol></li><li><p><a href="#stl-%E4%B8%AD%E5%B8%B8%E8%A7%81%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%B0%8F%E7%BB%93"><span class="toc-number">2.3.</span> <span class="toc-text">STL 中常见容器操作时间复杂度小结</span></a></p></li><li><p><a href="#map%E5%92%8Cunordered_map%E5%8C%BA%E5%88%AB"><span class="toc-number">2.4.</span> <span class="toc-text">map 和 unordered_map 区别</span></a></p><pre><code class="hljs">    1.  [&lt;span class=&quot;toc-number&quot;&gt;2.4.0.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;关于 map 容器：优点：&lt;/span&gt;](#%E5%85%B3%E4%BA%8Emap%E5%AE%B9%E5%99%A8%E4%BC%98%E7%82%B9)</code></pre></li></ol></li><li><p><a href="#vector%E7%9A%84%E6%89%A9%E5%AE%B9%E5%93%88%E5%B8%8C%E8%A1%A8%E6%89%A9%E5%AE%B9"><span class="toc-number">2.5.</span> <span class="toc-text">vector 的扩容，哈希表扩容？</span></a></p></li><li><p><a href="#incline-%E5%86%85%E8%81%94%E5%87%BD%E6%95%B0"><span class="toc-number">2.6.</span> <span class="toc-text">incline 内联函数</span></a></p></li><li><p><a href="#%E8%BF%9B%E7%A8%8B%E4%B9%8B%E9%97%B4%E5%A6%82%E4%BD%95%E9%80%9A%E4%BF%A1-ipc"><span class="toc-number">2.7.</span> <span class="toc-text">进程之间如何通信 IPC</span></a></p></li><li><p><a href="#%E5%86%85%E5%AD%98%E5%88%86%E5%B8%83"><span class="toc-number">2.8.</span> <span class="toc-text">内存分布</span></a></p><pre><code class="hljs">1.  [&lt;span class=&quot;toc-number&quot;&gt;2.8.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;内存分区&lt;/span&gt;](#%E5%86%85%E5%AD%98%E5%88%86%E5%8C%BA)</code></pre><ol start="2"><li><p><a href="#heap-%E6%89%8B%E5%8A%A8"><span class="toc-number">2.8.2.</span> <span class="toc-text">heap （手动）</span></a></p></li><li><p><a href="#stack-%E8%87%AA%E5%8A%A8"><span class="toc-number">2.8.3.</span> <span class="toc-text">stack （自动）</span></a></p></li><li><p><a href="#new-%E5%92%8C-malloc"><span class="toc-number">2.8.4.</span> <span class="toc-text">new 和 malloc</span></a></p></li><li><p><a href="#delete%E5%92%8Cfree"><span class="toc-number">2.8.5.</span> <span class="toc-text">delete 和 free</span></a></p></li><li><p><a href="#%E6%8C%87%E9%92%88%E5%92%8C%E5%BC%95%E7%94%A8"><span class="toc-number">2.8.6.</span> <span class="toc-text">指针和引用</span></a></p><pre><code class="hljs">    1.  [&lt;span class=&quot;toc-number&quot;&gt;2.8.6.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;指针常量：&lt;/span&gt;](#%E6%8C%87%E9%92%88%E5%B8%B8%E9%87%8F)</code></pre></li><li><p><a href="#heap-vs-stack"><span class="toc-number">2.8.7.</span> <span class="toc-text">heap vs stack</span></a></p></li><li><p><a href="#examples"><span class="toc-number">2.8.8.</span> <span class="toc-text">examples</span></a></p><pre><code class="hljs">    1.  [&lt;span class=&quot;toc-number&quot;&gt;2.8.8.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;heap&lt;/span&gt;](#heap)</code></pre><ol start="2"><li><a href="#stack"><span class="toc-number">2.8.8.2.</span> <span class="toc-text">stack</span></a></li></ol></li></ol></li><li><p><a href="#%E9%9D%99%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="toc-number">2.9.</span> <span class="toc-text">静动态链接库</span></a><li class="toc-item toc-level-1"><a href="#math"><span class="toc-number">3.</span> <span class="toc-text">math</span></a></p></li><li><p><a href="#dot-product"><span class="toc-number">3.0.0.1.</span> <span class="toc-text">dot product</span></a></p></li><li><p><a href="#cross-product"><span class="toc-number">3.0.0.2.</span> <span class="toc-text">cross product</span></a></li><li class="toc-item toc-level-1"><a href="#ue5"><span class="toc-number">4.</span> <span class="toc-text">UE5</span></a></p></li><li><p><a href="#%E6%B8%B8%E6%88%8F%E6%A8%A1%E5%BC%8F%E5%92%8C%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.1.</span> <span class="toc-text">游戏模式和实例</span></a></p></li><li><p><a href="#%E5%8A%A8%E6%80%81%E6%9D%90%E8%B4%A8%E5%AE%9E%E4%BE%8B%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">4.2.</span> <span class="toc-text">动态材质实例的作用</span></a></p></li><li><p><a href="#%E5%A7%94%E6%89%98"><span class="toc-number">4.3.</span> <span class="toc-text">委托</span></a></p><pre><code class="hljs">1.  [&lt;span class=&quot;toc-number&quot;&gt;4.3.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;单播委托、多播委托和动态委托的区别&lt;/span&gt;](#%E5%8D%95%E6%92%AD%E5%A7%94%E6%89%98-%E5%A4%9A%E6%92%AD%E5%A7%94%E6%89%98%E5%92%8C%E5%8A%A8%E6%80%81%E5%A7%94%E6%89%98%E7%9A%84%E5%8C%BA%E5%88%AB)</code></pre><ol start="2"><li><a href="#%E5%A7%94%E6%89%98%E7%9A%84%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">4.3.2.</span> <span class="toc-text">委托的底层原理</span></a></li><li><a href="#%E5%A6%82%E4%BD%95%E4%BF%9D%E6%8C%81%E6%96%B0%E5%BB%BA%E7%9A%84uobject%E5%AF%B9%E8%B1%A1%E4%B8%8D%E8%A2%AB%E8%87%AA%E5%8A%A8gc%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="toc-number">4.3.3.</span> <span class="toc-text">如何保持新建的 UObject 对象不被自动 GC 垃圾回收</span></a></li></ol></li><li><p><a href="#ue5-%E4%B8%AD%E7%9A%84%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88"><span class="toc-number">4.4.</span> <span class="toc-text">UE5 中的智能指针</span></a></p><pre><code class="hljs">1.  [&lt;span class=&quot;toc-number&quot;&gt;4.4.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;智能指针的循环引用&lt;/span&gt;](#%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E7%9A%84%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8)</code></pre></li><li><p><a href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8parallelfor%E6%8F%90%E9%AB%98%E9%80%9F%E5%BA%A6"><span class="toc-number">4.5.</span> <span class="toc-text">如何使用 ParallelFor 提高速度</span></a></p></li><li><p><a href="#tmap%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">4.6.</span> <span class="toc-text">TMap 的实现原理</span></a></p></li><li><p><a href="#%E8%99%9A%E5%B9%BB%E4%B8%AD%E6%9C%89%E5%93%AA%E5%87%A0%E7%A7%8D%E4%B8%BB%E8%A6%81%E7%BA%BF%E7%A8%8B"><span class="toc-number">4.7.</span> <span class="toc-text">虚幻中有哪几种主要线程</span></a></p><pre><code class="hljs">1.  [&lt;span class=&quot;toc-number&quot;&gt;4.7.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;游戏线程和渲染线程的同步&lt;/span&gt;](#%E6%B8%B8%E6%88%8F%E7%BA%BF%E7%A8%8B%E5%92%8C%E6%B8%B2%E6%9F%93%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%90%8C%E6%AD%A5)</code></pre></li><li><p><a href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B-task-graph%C3%9F"><span class="toc-number">4.8.</span> <span class="toc-text">多线程 Task Graphß</span></a></p></li><li><p><a href="#%E5%90%8E%E5%A4%84%E7%90%86"><span class="toc-number">4.9.</span> <span class="toc-text">后处理</span></a></p><pre><code class="hljs">1.  [&lt;span class=&quot;toc-number&quot;&gt;4.9.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;后处理之泛光（Bloom）&lt;/span&gt;](#%E5%90%8E%E5%A4%84%E7%90%86%E4%B9%8B%E6%B3%9B%E5%85%89bloom)</code></pre><ol start="2"><li><a href="#%E5%90%8E%E5%A4%84%E7%90%86%E4%B9%8B%E8%BD%AE%E5%BB%93%E6%8F%8F%E8%BE%B9"><span class="toc-number">4.9.2.</span> <span class="toc-text">后处理之轮廓描边</span></a></li></ol></li><li><p><a href="#%E8%93%9D%E5%9B%BE%E5%A4%A7%E9%87%8F%E8%BF%9E%E7%BA%BF%E4%B8%BA%E4%BD%95%E4%BC%9A%E6%AF%94-c-%E6%85%A2%E5%BE%88%E5%A4%9A"><span class="toc-number">4.10.</span> <span class="toc-text">蓝图大量连线为何会比 C++ 慢很多</span></a></p></li><li><p><a href="#%E6%A8%A1%E5%9E%8B%E9%97%AA%E7%83%81%E9%97%AE%E9%A2%98%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3"><span class="toc-number">4.11.</span> <span class="toc-text">模型闪烁问题如何解决</span></a></p></li><li><p><a href="#slate%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E6%8E%A7%E4%BB%B6"><span class="toc-number">4.12.</span> <span class="toc-text">slate 中常用的控件</span></a></p></li><li><p><a href="#%E5%8F%8D%E5%B0%84%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">4.13.</span> <span class="toc-text">反射的作用</span></a></p></li><li><p><a href="#%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%AD%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8-ufunction"><span class="toc-number">4.14.</span> <span class="toc-text">结构体中是否可以使用 UFUNCTION ()</span></a></p></li><li><p><a href="#ue-%E4%B8%AD%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">4.15.</span> <span class="toc-text">UE 中垃圾回收的原理</span></a></p></li><li><p><a href="#ue-%E4%B8%AD%E6%9C%89%E5%93%AA%E5%87%A0%E7%A7%8D%E5%AE%B9%E5%99%A8"><span class="toc-number">4.16.</span> <span class="toc-text">UE 中有哪几种容器</span></a></p></li><li><p><a href="#gameplay-%E7%9A%84%E6%A1%86%E6%9E%B6"><span class="toc-number">4.17.</span> <span class="toc-text">gameplay 的框架</span></a></p></li><li><p><a href="#unreal-%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%9A%84%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA%E6%96%B9%E6%B3%95%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="toc-number">4.18.</span> <span class="toc-text">Unreal 中使用的光线追踪方法有哪些</span></a></li><li class="toc-item toc-level-1"><a href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C"><span class="toc-number">5.</span> <span class="toc-text">计算机网络</span></a></p></li><li><p><a href="#%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AEnetwork-protocol-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AF%B9%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%88%86%E5%B1%82"><span class="toc-number">5.1.</span> <span class="toc-text">网络协议 (network protocol) 为什么要对网络协议分层</span></a></p><pre><code class="hljs">1.  [&lt;span class=&quot;toc-number&quot;&gt;5.1.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;各层协议的作用&lt;/span&gt;](#%E5%90%84%E5%B1%82%E5%8D%8F%E8%AE%AE%E7%9A%84%E4%BD%9C%E7%94%A8)</code></pre></li><li><p><a href="#uri-%E5%92%8C-url%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">5.2.</span> <span class="toc-text">URI 和 URL 的区别</span></a></p></li><li><p><a href="#tcp%E4%B8%8Eudp%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">5.3.</span> <span class="toc-text">TCP 与 UDP 的区别</span></a></p><pre><code class="hljs">1.  [&lt;span class=&quot;toc-number&quot;&gt;5.3.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;TCP 三次握手&lt;/span&gt;](#tcp-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B)&lt;/li&gt;&lt;li class=&quot;toc-item toc-level-1&quot;&gt;[&lt;span class=&quot;toc-number&quot;&gt;6.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;graphic card&lt;/span&gt;](#graphic-card)</code></pre></li><li><p><a href="#cpu%E4%B8%8Egpu%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">6.0.1.</span> <span class="toc-text">cpu 与 gpu 的区别？</span></a></p></li><li><p><a href="#alu-%E5%85%A8%E7%A7%B0%E6%98%AF%E7%AE%97%E6%9C%AF%E9%80%BB%E8%BE%91%E5%8D%95%E5%85%83arithmetic-logic-unit"><span class="toc-number">6.0.2.</span> <span class="toc-text">ALU, 全称是算术逻辑单元（Arithmetic Logic Unit）</span></a></li><li class="toc-item toc-level-2"><a href="#cuda"><span class="toc-number">6.1.</span> <span class="toc-text">cuda</span></a></p></li><li><p><a href="#cuda%E7%BC%96%E7%A8%8B%E4%B8%AD%E7%9A%84sm-sp-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">6.1.1.</span> <span class="toc-text">cuda 编程中的 SM SP 是什么</span></a></p></li><li><p><a href="#cuda-%E7%BC%96%E7%A8%8B%E7%9A%84%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B"><span class="toc-number">6.1.2.</span> <span class="toc-text">CUDA 编程的内存模型</span></a></li><li class="toc-item toc-level-2"><a href="#cuda-%E7%BC%96%E7%A8%8B%E7%9A%84%E8%BD%AF%E4%BB%B6%E6%A8%A1%E5%9E%8B"><span class="toc-number">6.2.</span> <span class="toc-text">CUDA 编程的软件模型</span></a></p></li><li><p><a href="#%E4%BD%BF%E7%94%A8%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E6%97%B6%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E4%BB%80%E4%B9%88"><span class="toc-number">6.2.1.</span> <span class="toc-text">使用共享内存时需要注意什么？</span></a></p><pre><code class="hljs">1.  [&lt;span class=&quot;toc-number&quot;&gt;6.2.1.1.&lt;/span&gt; &lt;span class=&quot;toc-text&quot;&gt;线程同步&lt;/span&gt;](#%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5)</code></pre><ol start="2"><li><a href="#%E9%81%BF%E5%85%8D%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E7%9A%84-bank-%E5%86%B2%E7%AA%81"><span class="toc-number">6.2.1.2.</span> <span class="toc-text">避免共享内存的 bank 冲突</span></a></li><li class="toc-item toc-level-2"><a href="#rocm"><span class="toc-number">6.3.</span> <span class="toc-text">ROCm</span></a></li><li class="toc-item toc-level-2"><a href="#%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8"><span class="toc-number">6.4.</span> <span class="toc-text">显卡驱动</span></a></li></ol></li><li><p><a href="#%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84"><span class="toc-number">6.4.1.</span> <span class="toc-text">驱动程序架构</span></a></p></li><li><p><a href="#%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F%E7%BB%84%E4%BB%B6"><span class="toc-number">6.4.2.</span> <span class="toc-text">驱动程序组件</span></a></li><li class="toc-item toc-level-1"><a href="#papers"><span class="toc-number">7.</span> <span class="toc-text">papers</span></a></li></div><div class="related panel pjax" data-title="Related"></p></li></ol><ul><li><a href="/2023/10/18/D3D12-learning-notes/" title="D3D12_learning_notes">D3D12_learning_notes</a></li><li><a href="/2024/05/07/games202-learning-note/" title="games202-learning-note">games202-learning-note</a></li><li><a href="/2024/05/11/interview-script/" title="interview script">interview script</a></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img src="/images/avatar.jpg" alt="DOTAFS"></li></ul><p>DOTAFS</p><div class="description" itemprop="description">computer graphic</div></div><nav class="state"><div class="item posts">[<span class="count">6</span> <span class="name">posts</span>](/archives/)</div><div class="item categories">[<span class="count">2</span> <span class="name">categories</span>](/categories/)</div></nav><div class="social"><span class="exturl item steam" data-url="aHR0cHM6Ly9zdGVhbWNvbW11bml0eS5jb20vaWQvRE9UQUZTLw==" title="https:&#x2F;&#x2F;steamcommunity.com&#x2F;id&#x2F;DOTAFS&#x2F;"></span> <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3lvdXJuYW1l" title="https:&#x2F;&#x2F;github.com&#x2F;yourname"></span></div><ul><li><p><a href="/">Home</a></p></li><li><p><a href="/about/">About</a></p></li><li><p><a href="javascript:void(0);">Posts</a></p><pre><code class="hljs">*   [Archives](/archives/)</code></pre><ul><li><a href="/categories/">Categories</a></li><li><a href="/tags/">Tags</a></li></ul></li><li><p><a href="/friends/">friends</a></p></li><li><p><a href="/links/">links</a></div></div></div></p></li></ul><p>*****</div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"></p><h2 id="Random-Posts"><a href="#Random-Posts" class="headerlink" title="Random Posts"></a>Random Posts</h2><ul><li><div class="breadcrumb">[projects](/categories/projects/ "In projects")</div><span>[enhancing and expanding a realistic cloth rendering model](/2024/02/26/enhancing-and-expanding-a-realistic-cloth-rendering-model/ "enhancing and expanding a realistic cloth rendering model")</span></li><li><div class="breadcrumb">[notes](/categories/notes/ "In notes")</div><span>[games202-learning-note](/2024/05/07/games202-learning-note/ "games202-learning-note")</span></li><li><div class="breadcrumb">[notes](/categories/notes/ "In notes")</div><span>[interview script](/2024/05/11/interview-script/ "interview script")</span></li><li><div class="breadcrumb">[notes](/categories/notes/ "In notes")</div><span>[D3D12_learning_notes](/2023/10/18/D3D12-learning-notes/ "D3D12_learning_notes")</span></li><li><div class="breadcrumb"></div><span>[CS5310-learning-notes](/2024/05/08/CS5310-learning-notes/ "CS5310-learning-notes")</span></li><li><div class="breadcrumb">[projects](/categories/projects/ "In projects")</div><span>[deferred rendering + ggx](/2024/03/27/deferred-rendering-ggx/ "deferred rendering + ggx")</span></div></div><div class="status"><div class="copyright">&copy; 2023 – <span itemprop="copyrightYear">2024</span> <span class="with-love"> </span><span class="author" itemprop="copyrightHolder">DOTAFS @ DOTAFS</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/05/11/interview-script/",favicon:{show:"（●´3｀●）Goooood",hide:"(´Д｀)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully!  All articles in this blog are licensed under BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Realistic Cloth Rendering by Mitsuba3</title>
    <link href="/2023/06/20/UE5_source_code_analysis/"/>
    <url>/2023/06/20/UE5_source_code_analysis/</url>
    
    <content type="html"><![CDATA[<h1 id="Realistic-Rendering-by-Mitsuba3"><a href="#Realistic-Rendering-by-Mitsuba3" class="headerlink" title="Realistic Rendering by Mitsuba3"></a>Realistic Rendering by Mitsuba3</h1><p>Based on mitsuba3 and Irawan’s cloth model, I add a new pattern of cloth by data drived, which used multi highlights in one yarn, here is the result.</p><p><img src="/2023/06/20/UE5_source_code_analysis/3.jpeg"><br><img src="/2023/06/20/UE5_source_code_analysis/2.jpeg"><br><img src="/2023/06/20/UE5_source_code_analysis/4.jpeg"><br><img src="/2023/06/20/UE5_source_code_analysis/5.jpeg"><br><img src="/2023/06/20/UE5_source_code_analysis/1.jpeg"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>D3D12 Learning Notes</title>
    <link href="/2023/03/18/D3D12-learning-notes/"/>
    <url>/2023/03/18/D3D12-learning-notes/</url>
    
    <content type="html"><![CDATA[<h1 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h1><p>Describe the process of drawing a triangle, something similar to printf(“Hello World!”) in D3D.</p><h2 id="overview"><a href="#overview" class="headerlink" title="overview"></a>overview</h2><h3 id="step1-初始化descriptor-heap"><a href="#step1-初始化descriptor-heap" class="headerlink" title="step1: 初始化descriptor heap"></a>step1: 初始化descriptor heap</h3><p>descriptor是一个GPU资源(纹理，缓冲区，采样器)的描述。  </p><p>Descriptor Heap: 创建描述符堆，descriptor heap可以有很多个，每一个都是一个连续的内存块，存放着多个descriptor。  </p><p>主要有三种heap:</p><ol><li>CBV&#x2F;SRV&#x2F;UAV: constant buffer， shader resource, 无序访问视图。这些view都是GPU可见的，也被叫做descriptor table，可以绑定到root signature中。对于经常变化的小资源比如世界矩阵就放到constant buffer，对于别的资源就放到SRV。</li><li>Sampler Descriptor Heap: 在着色器中执行纹理采样的，也是GPU可见的。</li><li>RTV&#x2F;DSV 描述符堆（Render Target View &#x2F; Depth Stencil View Descriptor Heap）: 设置渲染目标和深度缓冲区。CPU可见，不需要绑定到descirptor table中。</li></ol><h3 id="step2-constant-buffer"><a href="#step2-constant-buffer" class="headerlink" title="step2: constant buffer"></a>step2: constant buffer</h3><ol><li>上传到upload buffer，不用到default buffer</li><li></li></ol><h3 id="drawcall"><a href="#drawcall" class="headerlink" title="drawcall:"></a>drawcall:</h3><h2 id="step-1-vertex-and-input-layout"><a href="#step-1-vertex-and-input-layout" class="headerlink" title="step 1: vertex and input layout"></a>step 1: vertex and input layout</h2><ol><li><p>First thing is to create a custom vertex structure.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Vertex</span><br>&#123;<br>XMFLOAT3 Pos;<br>XMFLOAT3 Normal;<br>XMFLOAT2 Tex0;<br>XMFLOAT2 Tex1;<br>&#125;;<br></code></pre></td></tr></table></figure></li><li><p>After that, we need to give D3D a description, to let D3D know what the vertex is doing with each components (ep. Pos, Normal), which is <code>D3D12_INPUT_LAYOUT_DESC</code>.</p></li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">D3D12_INPUT_LAYOUT_DESC</span><br>&#123;<br><span class="hljs-type">const</span> D3D12_INPUT_ELEMENT_DESC *pInputElementDescs;<br>UINT NumElements;<br>&#125; D3D12_INPUT_LAYOUT_DESC;<br></code></pre></td></tr></table></figure><ol start="3"><li>Each <code>D3D12_INPUT_ELEMENT_DESC</code> is defined as below</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">D3D12_INPUT_ELEMENT_DESC</span><br>&#123;<br>LPCSTR SemanticName;<br>UINT SemanticIndex;<br>DXGI_FORMAT Format;<br>UINT InputSlot;<br>UINT AlignedByteOffset;<br>D3D12_INPUT_CLASSIFICATION InputSlotClass;<br>UINT InstanceDataStepRate;<br>&#125; D3D12_INPUT_ELEMENT_DESC;<br></code></pre></td></tr></table></figure><p>Below is each parameters’ description:</p><ul><li>SemanticName: Name of current component, which is used to map elements in vertex shader input signature. A example below: </li><li>SemanticIndex: Index of Semantic, ep Pos is become POSITION0.</li><li>Format: The format of the component, because XMFLOAT3 is still not enough detailed.</li><li>InputSlot: Totally 12 slot, leave it later to learn.</li><li>AlignedByteOffset: Size of float: 4 bytes, so offset is 3 x 4 &#x3D; 12.</li><li>InputSlotClass: default right now : <code>InputSlotClass</code>.</li></ul><p>Whole process:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Vertex</span><br>&#123;<br>XMFLOAT3 Pos;<br>XMFLOAT3 Normal;<br>XMFLOAT2 Tex0;<br>XMFLOAT2 Tex1;<br>&#125;;<br>D3D11_INPUT_ELEMENT_DESC vertexDesc[] =<br>&#123;<br>&#123;<span class="hljs-string">&quot;POSITION&quot;</span>, <span class="hljs-number">0</span>, DXGI_FORMAT_R32G32B32_FLOAT, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,<br>D3D11_INPUT_PER_VERTEX_DATA, <span class="hljs-number">0</span>&#125;,<br>&#123;<span class="hljs-string">&quot;NORMAL&quot;</span>, <span class="hljs-number">0</span>, DXGI_FORMAT_R32G32B32_FLOAT, <span class="hljs-number">0</span>, <span class="hljs-number">12</span>,<br>D3D11_INPUT_PER_VERTEX_DATA, <span class="hljs-number">0</span>&#125;,<br>&#123;<span class="hljs-string">&quot;TEXCOORD&quot;</span>, <span class="hljs-number">0</span>, DXGI_FORMAT_R32G32_FLOAT, <span class="hljs-number">0</span>, <span class="hljs-number">24</span>,<br>D3D11_INPUT_PER_VERTEX_DATA, <span class="hljs-number">0</span>&#125;,<br>&#123;<span class="hljs-string">&quot;TEXCOORD&quot;</span>, <span class="hljs-number">1</span>, DXGI_FORMAT_R32G32_FLOAT, <span class="hljs-number">0</span>, <span class="hljs-number">32</span>,<br>D3D11_INPUT_PER_VERTEX_DATA, <span class="hljs-number">0</span>&#125;<br>&#125;;<br><span class="hljs-function">VertexOut <span class="hljs-title">VS</span><span class="hljs-params">(float3 iPos : POSITION,</span></span><br><span class="hljs-params"><span class="hljs-function">float3 iNormal : NORMAL,</span></span><br><span class="hljs-params"><span class="hljs-function">float2 iTex0 : TEXCOORD0,</span></span><br><span class="hljs-params"><span class="hljs-function">float2 iTex1 : TEXCOORD1)</span></span><br></code></pre></td></tr></table></figure><h2 id="step-2-vertex-buffer"><a href="#step-2-vertex-buffer" class="headerlink" title="step 2: vertex buffer"></a>step 2: vertex buffer</h2><p>We need to let GPU access the vertex array, they need to place into a GPU resource<code>ID3D12Resource</code> called <code>buffer</code>. Its a simpler structure to compare with texture.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> CD3DX12_RESOURCE_DESC <span class="hljs-title">Buffer</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">UINT64 width,</span></span><br><span class="hljs-params"><span class="hljs-function">D3D12_RESOURCE_FLAGS flags = D3D12_RESOURCE_FLAG_NONE,</span></span><br><span class="hljs-params"><span class="hljs-function">UINT64 alignment = <span class="hljs-number">0</span> )</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">CD3DX12_RESOURCE_DESC</span>( D3D12_RESOURCE_DIMENSION_BUFFER,<br>alignment, width, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>,<br>DXGI_FORMAT_UNKNOWN, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>,<br>D3D12_TEXTURE_LAYOUT_ROW_MAJOR, flags );<br>&#125;<br></code></pre></td></tr></table></figure><p>For a buffer the <code>width</code>refers to the number of bytes in the buffer. If totally 64 floats, the width should be <code>64*sizeof(float)</code></p><h3 id="let-GPU-access-the-data"><a href="#let-GPU-access-the-data" class="headerlink" title="let GPU access the data"></a>let GPU access the data</h3><p>$\textbf{If}$ Vertex buffer is static(house,road,etc..), we need to put it into default heap <code>D3D12_HEAP_TYPE_DEFAULT</code>. But default heap can only be accessed by GPU, so need a tools to let CPU push the data into GPU. Upload buffer <code>D3D12_HEAP_TYPE_UPLOAD</code> needed. right here. The step is  $\textbf{system memory}\rarr\textbf{upload heap}\rarr\textbf{default heap}$</p><p>$\textbf{Whole Default Heap Below}$ </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs C++">Microsoft::<span class="hljs-function">WRL::ComPtr&lt;ID3D12Resource&gt; <span class="hljs-title">d3dUtil::CreateDefaultBuffer</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">ID3D12Device* device,</span></span><br><span class="hljs-params"><span class="hljs-function">ID3D12GraphicsCommandList* cmdList,</span></span><br><span class="hljs-params"><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">void</span>* initData,</span></span><br><span class="hljs-params"><span class="hljs-function">UINT64 byteSize,</span></span><br><span class="hljs-params"><span class="hljs-function">Microsoft::WRL::ComPtr&lt;ID3D12Resource&gt;&amp; uploadBuffer)</span></span><br><span class="hljs-function"></span>&#123;<br>ComPtr&lt;ID3D12Resource&gt; defaultBuffer;<br><span class="hljs-comment">// Create the actual default buffer resource.</span><br><span class="hljs-built_in">ThrowIfFailed</span>(device-&gt;<span class="hljs-built_in">CreateCommittedResource</span>(<br>&amp;<span class="hljs-built_in">CD3DX12_HEAP_PROPERTIES</span>(D3D12_HEAP_TYPE_DEFAULT),<br>D3D12_HEAP_FLAG_NONE,<br>&amp;CD3DX12_RESOURCE_DESC::<span class="hljs-built_in">Buffer</span>(byteSize),<br>D3D12_RESOURCE_STATE_COMMON,<br><span class="hljs-literal">nullptr</span>,<br><span class="hljs-built_in">IID_PPV_ARGS</span>(defaultBuffer.<span class="hljs-built_in">GetAddressOf</span>())));<br><span class="hljs-comment">// In order to copy CPU memory data into our default buffer, we need</span><br><span class="hljs-comment">// to create an intermediate upload heap.</span><br><span class="hljs-built_in">ThrowIfFailed</span>(device-&gt;<span class="hljs-built_in">CreateCommittedResource</span>(<br>&amp;<span class="hljs-built_in">CD3DX12_HEAP_PROPERTIES</span>(D3D12_HEAP_TYPE_UPLOAD),<br>D3D12_HEAP_FLAG_NONE,<br>&amp;CD3DX12_RESOURCE_DESC::<span class="hljs-built_in">Buffer</span>(byteSize),<br>D3D12_RESOURCE_STATE_GENERIC_READ, <span class="hljs-literal">nullptr</span>,<br><span class="hljs-built_in">IID_PPV_ARGS</span>(uploadBuffer.<span class="hljs-built_in">GetAddressOf</span>())));<br><span class="hljs-comment">// Describe the data we want to copy into the default buffer.</span><br>D3D12_SUBRESOURCE_DATA subResourceData = &#123;&#125;;<br>subResourceData.pData = initData;<br>subResourceData.RowPitch = byteSize;<br>subResourceData.SlicePitch = subResourceData.RowPitch;<br><span class="hljs-comment">// Schedule to copy the data to the default buffer resource.</span><br><span class="hljs-comment">// At a high level, the helper function UpdateSubresources</span><br><span class="hljs-comment">// will copy the CPU memory into the intermediate upload heap.</span><br><span class="hljs-comment">// Then, using ID3D12CommandList::CopySubresourceRegion,</span><br><span class="hljs-comment">// the intermediate upload heap data will be copied to mBuffer.</span><br>cmdList-&gt;<span class="hljs-built_in">ResourceBarrier</span>(<span class="hljs-number">1</span>,<br>&amp;CD3DX12_RESOURCE_BARRIER::<span class="hljs-built_in">Transition</span>(defaultBuffer.<span class="hljs-built_in">Get</span>(),<br>D3D12_RESOURCE_STATE_COMMON,<br>D3D12_RESOURCE_STATE_COPY_DEST));<br><span class="hljs-built_in">UpdateSubresources</span>&lt;<span class="hljs-number">1</span>&gt;(cmdList,<br>defaultBuffer.<span class="hljs-built_in">Get</span>(), uploadBuffer.<span class="hljs-built_in">Get</span>(),<br><span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, &amp;subResourceData);<br>cmdList-&gt;<span class="hljs-built_in">ResourceBarrier</span>(<span class="hljs-number">1</span>,<br>&amp;CD3DX12_RESOURCE_BARRIER::<span class="hljs-built_in">Transition</span>(defaultBuffer.<span class="hljs-built_in">Get</span>(),<br>D3D12_RESOURCE_STATE_COPY_DEST,<br>D3D12_RESOURCE_STATE_GENERIC_READ));<br><span class="hljs-comment">// Note: uploadBuffer has to be kept alive after the above function</span><br><span class="hljs-comment">// calls because the command list has not been executed yet that</span><br><span class="hljs-comment">// performs the actual copy.</span><br><span class="hljs-comment">// The caller can Release the uploadBuffer after it knows the copy</span><br><span class="hljs-comment">// has been executed.</span><br><span class="hljs-keyword">return</span> defaultBuffer;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">D3D12_SUBRESOURCE_DATA</span><br>&#123;<br><span class="hljs-type">const</span> <span class="hljs-type">void</span> *pData;<br>LONG_PTR RowPitch;<br>LONG_PTR SlicePitch;<br>&#125; D3D12_SUBRESOURCE_DATA;<br></code></pre></td></tr></table></figure><p>Above is how to manage upload heap -&gt; default heap, then we just need to call the function above to store the vertex buffer, it makes the life easier. Example of cube below:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs C++">Vertex vertices[] =<br>&#123;<br>&#123; <span class="hljs-built_in">XMFLOAT3</span>(<span class="hljs-number">-1.0f</span>, <span class="hljs-number">-1.0f</span>, <span class="hljs-number">-1.0f</span>), <span class="hljs-built_in">XMFLOAT4</span>(Colors::White) &#125;,<br>&#123; <span class="hljs-built_in">XMFLOAT3</span>(<span class="hljs-number">-1.0f</span>, +<span class="hljs-number">1.0f</span>, <span class="hljs-number">-1.0f</span>), <span class="hljs-built_in">XMFLOAT4</span>(Colors::Black) &#125;,<br>&#123; <span class="hljs-built_in">XMFLOAT3</span>(+<span class="hljs-number">1.0f</span>, +<span class="hljs-number">1.0f</span>, <span class="hljs-number">-1.0f</span>), <span class="hljs-built_in">XMFLOAT4</span>(Colors::Red) &#125;,<br>&#123; <span class="hljs-built_in">XMFLOAT3</span>(+<span class="hljs-number">1.0f</span>, <span class="hljs-number">-1.0f</span>, <span class="hljs-number">-1.0f</span>), <span class="hljs-built_in">XMFLOAT4</span>(Colors::Green) &#125;,<br>&#123; <span class="hljs-built_in">XMFLOAT3</span>(<span class="hljs-number">-1.0f</span>, <span class="hljs-number">-1.0f</span>, +<span class="hljs-number">1.0f</span>), <span class="hljs-built_in">XMFLOAT4</span>(Colors::Blue) &#125;,<br>&#123; <span class="hljs-built_in">XMFLOAT3</span>(<span class="hljs-number">-1.0f</span>, +<span class="hljs-number">1.0f</span>, +<span class="hljs-number">1.0f</span>), <span class="hljs-built_in">XMFLOAT4</span>(Colors::Yellow) &#125;,<br>&#123; <span class="hljs-built_in">XMFLOAT3</span>(+<span class="hljs-number">1.0f</span>, +<span class="hljs-number">1.0f</span>, +<span class="hljs-number">1.0f</span>), <span class="hljs-built_in">XMFLOAT4</span>(Colors::Cyan) &#125;,<br>&#123; <span class="hljs-built_in">XMFLOAT3</span>(+<span class="hljs-number">1.0f</span>, <span class="hljs-number">-1.0f</span>, +<span class="hljs-number">1.0f</span>), <span class="hljs-built_in">XMFLOAT4</span>(Colors::Magenta) &#125;<br>&#125;;<br><span class="hljs-type">const</span> UINT64 vbByteSize = <span class="hljs-number">8</span> * <span class="hljs-built_in">sizeof</span>(Vertex);<br>ComPtr&lt;ID3D12Resource&gt; VertexBufferGPU = <span class="hljs-literal">nullptr</span>;<br>ComPtr&lt;ID3D12Resource&gt; VertexBufferUploader = <span class="hljs-literal">nullptr</span>;<br>VertexBufferGPU = d3dUtil::<span class="hljs-built_in">CreateDefaultBuffer</span>(md3dDevice.<span class="hljs-built_in">Get</span>(),<br>mCommandList.<span class="hljs-built_in">Get</span>(), vertices, vbByteSize, VertexBufferUploader);<br></code></pre></td></tr></table></figure><h3 id="bind-the-buffer-to-pipeline"><a href="#bind-the-buffer-to-pipeline" class="headerlink" title="bind the buffer to pipeline"></a>bind the buffer to pipeline</h3><ol><li>We need a <code>vertex buffer view</code> to find the vertex buffer resource.<br>In my understanding, this is something like pointer, used for us to find the position and size of vertex buffer when we need.<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">D3D12_VERTEX_BUFFER_VIEW</span><br>&#123;<br>D3D12_GPU_VIRTUAL_ADDRESS BufferLocation;<br>UINT SizeInBytes;<br>UINT StrideInBytes;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><ul><li>BufferLocation: Virtual address (such as &amp; in c) of the vertex buffer we wanna to view</li><li>SizeInBytes: The number of bytes to view in the vertex buffer starting from <code>BufferLocation</code>.</li><li>StrideInBytes: The size of each vertex in bytes.</li></ul><ol start="2"><li>After create vertex buffer and view, use function below to process the whole steps.</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ID3D12GraphicsCommandList::IASetVertexBuffers</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">UINT StartSlot,</span></span><br><span class="hljs-params"><span class="hljs-function">UINT NumBuffers,</span></span><br><span class="hljs-params"><span class="hljs-function"><span class="hljs-type">const</span> D3D12_VERTEX_BUFFER_VIEW *pViews)</span></span>;<br></code></pre></td></tr></table></figure><ol start="3"><li>The step below does not mean we already draw them , just put the resource to the target slot, <code>DrawInstance</code> is the function to the draw step.<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ID3D12CommandList::DrawInstanced</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">UINT VertexCountPerInstance,</span></span><br><span class="hljs-params"><span class="hljs-function">UINT InstanceCount,</span></span><br><span class="hljs-params"><span class="hljs-function">UINT StartVertexLocation,</span></span><br><span class="hljs-params"><span class="hljs-function">UINT StartInstanceLocation)</span></span>;<br></code></pre></td></tr></table></figure></li></ol><h2 id="step-3-constant-buffer"><a href="#step-3-constant-buffer" class="headerlink" title="step 3: constant buffer"></a>step 3: constant buffer</h2><p>It’s a type of GPU resource: <code>ID3D12Resource</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs C++">cbuffer cbPerObject : <span class="hljs-built_in">register</span>(b0)<br>&#123;<br>float4x4 gWorldViewProj;<br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ObjectConstants</span><br>&#123;<br>DirectX::XMFLOAT4X4 WorldViewProj = MathHelper::<span class="hljs-built_in">Identity4x4</span>();<br>&#125;;<br>UINT elementByteSize = d3dUtil::<span class="hljs-built_in">CalcConstantBufferByteSize</span>(<span class="hljs-built_in">sizeof</span>(Objec<br>tConstants));<br>ComPtr&lt;ID3D12Resource&gt; mUploadCBuffer;<br>device-&gt;<span class="hljs-built_in">CreateCommittedResource</span>(<br>&amp;<span class="hljs-built_in">CD3DX12_HEAP_PROPERTIES</span>(D3D12_HEAP_TYPE_UPLOAD),<br>D3D12_HEAP_FLAG_NONE,<br>&amp;CD3DX12_RESOURCE_DESC::<span class="hljs-built_in">Buffer</span>(mElementByteSize * NumElements),<br>D3D12_RESOURCE_STATE_GENERIC_READ,<br><span class="hljs-literal">nullptr</span>,<br><span class="hljs-built_in">IID_PPV_ARGS</span>(&amp;mUploadCBuffer));<br></code></pre></td></tr></table></figure><h1 id="graphics-pipeline-in-DirectX-12"><a href="#graphics-pipeline-in-DirectX-12" class="headerlink" title="graphics pipeline in DirectX 12."></a>graphics pipeline in DirectX 12.</h1><p><img src="/2023/03/18/D3D12-learning-notes/3.png"></p><ol><li>Fixed-function stages (blue): cannot change how they process data, but can configure them using the DirectX 12 API. Such as imachines in a factory.</li><li>Programmable stages(green): can write a shadow program like HLSL to define exactly how data is processed. Such as a program a robot in a factory.</li></ol><ul><li><p>Input-Assembler(IA) stage: read primitive data from user-defined vertex and index buffers and assemble that data into geometric primitives.</p></li><li><p>Vertex Shader(VS) Stage<br>transform the vertex data from object-space into clip-space.</p></li><li><p>Hull Shader(HS) Stage<br>It is responsible for determining how much an input control patch should be tessellated by the tesslation.</p></li></ul><h1 id="basics-of-D3D12"><a href="#basics-of-D3D12" class="headerlink" title="basics of D3D12"></a>basics of D3D12</h1><h2 id="COM"><a href="#COM" class="headerlink" title="COM"></a>COM</h2><ol><li>backward compatible.</li><li>language-independent.</li></ol><p>Use WRL below to manager the lifetime of COM object, like smart pointer.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++">Microsoft::WRL::ComPtr<br></code></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// Get</span><br>ComPtr&lt;ID3D12RootSignature&gt; mRootSignature;<br>...<br><span class="hljs-comment">// SetGraphicsRootSignature expects ID3D12RootSignature* argument.</span><br>mCommandList-&gt;<span class="hljs-built_in">SetGraphicsRootSignature</span>(mRootSignature.<span class="hljs-built_in">Get</span>());<br><br><br><span class="hljs-comment">// GetAddressOf</span><br>ComPtr&lt;ID3D12CommandAllocator&gt; mDirectCmdListAlloc;<br>...<br><span class="hljs-built_in">ThrowIfFailed</span>(md3dDevice-&gt;<span class="hljs-built_in">CreateCommandAllocator</span>(<br>D3D12_COMMAND_LIST_TYPE_DIRECT,<br>mDirectCmdListAlloc.<span class="hljs-built_in">GetAddressOf</span>()));<br><br><br><span class="hljs-comment">// Reset</span><br>ComPtr&lt;ID3D11Device&gt; device;<br><span class="hljs-comment">// first way</span><br>device.<span class="hljs-built_in">Reset</span>();<br><span class="hljs-comment">// second way</span><br>device = <span class="hljs-literal">nullptr</span>;<br></code></pre></td></tr></table></figure><h2 id="PSO"><a href="#PSO" class="headerlink" title="PSO"></a>PSO</h2><p>Pipeline State Object, in my understanding is analogous to the concept of draw state. Which means it can not change during the drawcall, a ‘setup’ before rendering process begin.</p><h2 id="Render-Item"><a href="#Render-Item" class="headerlink" title="Render Item"></a>Render Item</h2><p>A lightweight structure for us to draw a shape, store based on different PSO.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// List of all the render items.</span><br>std::vector&lt;std::unique_ptr&lt;RenderItem&gt;&gt; mAllRitems;<br><span class="hljs-comment">// Render items divided by PSO.</span><br>std::vector&lt;RenderItem*&gt; mOpaqueRitems;<br>std::vector&lt;RenderItem*&gt; mTransparentRitems;<br></code></pre></td></tr></table></figure><h2 id="useful-functions"><a href="#useful-functions" class="headerlink" title="useful functions"></a>useful functions</h2><ol><li>IDXGI Factory (DirectX Graphic Infrastructure)<br>Enum Adapters and Creating Swap Chain<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-built_in">GRS_THROW_IF_FAILED</span>(<span class="hljs-built_in">CreateDXGIFactory2</span>(nDXGIFactoryFlags, <span class="hljs-built_in">IID_PPV_ARGS</span>(&amp;pIDXGIFactory5)));<br></code></pre></td></tr></table></figure></li></ol><h2 id="creating-resources"><a href="#creating-resources" class="headerlink" title="creating resources"></a>creating resources</h2><h3 id="CreateCommittedResouce"><a href="#CreateCommittedResouce" class="headerlink" title="CreateCommittedResouce"></a>CreateCommittedResouce</h3><p>implicit heap: the heap object can’t be obtained by the application. Just call the heap and use it directly, do not need to build the heap manually. But hard to control the detail of the heap.</p><h3 id="CreatePlacedResource"><a href="#CreatePlacedResource" class="headerlink" title="CreatePlacedResource"></a>CreatePlacedResource</h3><h3 id="CreatReservedResource"><a href="#CreatReservedResource" class="headerlink" title="CreatReservedResource"></a>CreatReservedResource</h3><h2 id="Heap"><a href="#Heap" class="headerlink" title="Heap"></a>Heap</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">typedef</span> <br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">D3D12_HEAP_TYPE</span><br>&#123;<br>    D3D12_HEAP_TYPE_DEFAULT            = <span class="hljs-number">1</span>, <br>    D3D12_HEAP_TYPE_UPLOAD             = <span class="hljs-number">2</span>,<br>    D3D12_HEAP_TYPE_READBACK           = <span class="hljs-number">3</span>,<br>    D3D12_HEAP_TYPE_CUSTOM              = <span class="hljs-number">4</span><br>&#125; D3D12_HEAP_TYPE;<br></code></pre></td></tr></table></figure><ul><li>DEFAULT: creating buffet when D3Dxx_USAGE &#x3D; Default, only GPU  could access the data, CPU can not directly access the data. Which means it usually in $\textbf{video memory}$. Always insert some data hard to change in it, such as texture. </li><li>UPLOAD: GPU can not load the data, so upload heap is using to load the data in DEFAULT heap. For GPU “read only”, For CPU “write only”. For do not change.</li><li>READBACK: the oppsite of UPLOAD</li></ul><h2 id="Resource-Barrier"><a href="#Resource-Barrier" class="headerlink" title="Resource Barrier"></a>Resource Barrier</h2><p>Handle the parallelism problem between copy engine and graphic command engine. Ep. The texture is large enough and $\textbf{memcopy}$ need some time to copy. But the graphic command engine do not know that and already start $\textbf{Draw Call}$ the texture, which lead the unfinished texture to be rendered.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">//send the command to the command heap of copy something from UPLOAD heap to DEFAULT heap</span><br><span class="hljs-function">CD3DX12_TEXTURE_COPY_LOCATION <span class="hljs-title">Dst</span><span class="hljs-params">(pITexcute.Get(), <span class="hljs-number">0</span>)</span></span>;<br><span class="hljs-function">CD3DX12_TEXTURE_COPY_LOCATION <span class="hljs-title">Src</span><span class="hljs-params">(pITextureUpload.Get(), stTxtLayouts)</span></span>;<br><br><span class="hljs-comment">// directly command a list&#x27;s object.</span><br>pICommandList-&gt;<span class="hljs-built_in">CopyTextureRegion</span>(&amp;Dst, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, &amp;Src, <span class="hljs-literal">nullptr</span>);<br> <br><span class="hljs-comment">// Resource Barrier</span><br>D3D12_RESOURCE_BARRIER stResBar = &#123;&#125;;<br>stResBar.Type= D3D12_RESOURCE_BARRIER_TYPE_TRANSITION;<br>stResBar.Flags= D3D12_RESOURCE_BARRIER_FLAG_NONE;<br>stResBar.Transition.pResource= pITexcute.<span class="hljs-built_in">Get</span>();<br>stResBar.Transition.StateBefore = D3D12_RESOURCE_STATE_COPY_DEST;<br>stResBar.Transition.StateAfter= D3D12_RESOURCE_STATE_PIXEL_SHADER_RESOURCE;<br>stResBar.Transition.Subresource = D3D12_RESOURCE_BARRIER_ALL_SUBRESOURCES;<br> <br>pICommandList-&gt;<span class="hljs-built_in">ResourceBarrier</span>(<span class="hljs-number">1</span>, &amp;stResBar);<br></code></pre></td></tr></table></figure><p>In my understanding, because command heap’s excution on GPU is in serial order, which means rescource barrier is just like crossbars at supermarket checkout counters.</p><h2 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h2><p>used to looking for a adapter(graphic card)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function">ComPtr&lt;IDXGIAdapter4&gt; <span class="hljs-title">GetAdapter</span><span class="hljs-params">(<span class="hljs-type">bool</span> useWarp)</span></span><br><span class="hljs-function"></span>&#123;<br>    ComPtr&lt;IDXGIFactory4&gt; dxgiFactory;<br>    UINT createFactoryFlags = <span class="hljs-number">0</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">if</span> defined(_DEBUG)</span><br>    createFactoryFlags = DXGI_CREATE_FACTORY_DEBUG;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br> <br>    <span class="hljs-built_in">ThrowIfFailed</span>(<span class="hljs-built_in">CreateDXGIFactory2</span>(createFactoryFlags, <span class="hljs-built_in">IID_PPV_ARGS</span>(&amp;dxgiFactory)));<br>   ComPtr&lt;IDXGIAdapter1&gt; dxgiAdapter1;<br>    ComPtr&lt;IDXGIAdapter4&gt; dxgiAdapter4;<br><br>    <span class="hljs-keyword">if</span> (useWarp)<br>    &#123;<br>        <span class="hljs-built_in">ThrowIfFailed</span>(dxgiFactory-&gt;<span class="hljs-built_in">EnumWarpAdapter</span>(<span class="hljs-built_in">IID_PPV_ARGS</span>(&amp;dxgiAdapter1)));<br>        <span class="hljs-built_in">ThrowIfFailed</span>(dxgiAdapter1.<span class="hljs-built_in">As</span>(&amp;dxgiAdapter4));<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        SIZE_T maxDedicatedVideoMemory = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (UINT i = <span class="hljs-number">0</span>; dxgiFactory-&gt;<span class="hljs-built_in">EnumAdapters1</span>(i, &amp;dxgiAdapter1) != DXGI_ERROR_NOT_FOUND; ++i)<br>        &#123;<br>            DXGI_ADAPTER_DESC1 dxgiAdapterDesc1;<br>            dxgiAdapter1-&gt;<span class="hljs-built_in">GetDesc1</span>(&amp;dxgiAdapterDesc1);<br> <br>            <span class="hljs-comment">// Check to see if the adapter can create a D3D12 device without actually </span><br>            <span class="hljs-comment">// creating it. The adapter with the largest dedicated video memory</span><br>            <span class="hljs-comment">// is favored.</span><br>            <span class="hljs-keyword">if</span> ((dxgiAdapterDesc1.Flags &amp; DXGI_ADAPTER_FLAG_SOFTWARE) == <span class="hljs-number">0</span> &amp;&amp;<br>                <span class="hljs-built_in">SUCCEEDED</span>(<span class="hljs-built_in">D3D12CreateDevice</span>(dxgiAdapter1.<span class="hljs-built_in">Get</span>(), <br>                    D3D_FEATURE_LEVEL_11_0, __uuidof(ID3D12Device), <span class="hljs-literal">nullptr</span>)) &amp;&amp; <br>                dxgiAdapterDesc1.DedicatedVideoMemory &gt; maxDedicatedVideoMemory )<br>            &#123;<br>                maxDedicatedVideoMemory = dxgiAdapterDesc1.DedicatedVideoMemory;<br>                <span class="hljs-built_in">ThrowIfFailed</span>(dxgiAdapter1.<span class="hljs-built_in">As</span>(&amp;dxgiAdapter4));<br>            &#125;<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-keyword">return</span> dxgiAdapter4;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Command-List-Command-Allocator-Command-Queue"><a href="#Command-List-Command-Allocator-Command-Queue" class="headerlink" title="Command List, Command Allocator, Command Queue"></a>Command List, Command Allocator, Command Queue</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// DirectX 12 Objects</span><br>ComPtr&lt;ID3D12Device2&gt; g_Device;<br>ComPtr&lt;ID3D12CommandQueue&gt; g_CommandQueue;<br>ComPtr&lt;IDXGISwapChain4&gt; g_SwapChain;<br>ComPtr&lt;ID3D12Resource&gt; g_BackBuffers[g_NumFrames];<br>ComPtr&lt;ID3D12GraphicsCommandList&gt; g_CommandList;<br>ComPtr&lt;ID3D12CommandAllocator&gt; g_CommandAllocators[g_NumFrames];<br>ComPtr&lt;ID3D12DescriptorHeap&gt; g_RTVDescriptorHeap;<br>UINT g_RTVDescriptorSize;<br>UINT g_CurrentBackBufferIndex;<br></code></pre></td></tr></table></figure><ul><li><p>Comptr: it goes out of scope when COM object is no longer needed, helping to prevent memory leaks.</p></li><li><p>CommandAllocator: create and manage the memory that backs(supports) command list. Every command list need a command allocator, and each command allocator can be used with one command list at a time.</p></li><li><p>Command List: CPU records a list of commands to be executed by GPU. Such as state changes, resource barriers, drawing operations…</p></li><li><p>Command Queue: An interface through which CPU submits the recorded command lists to the GPU for execution. The GPU start excute the command as soon as CPU put command list in it.</p></li></ul><h2 id="Fence"><a href="#Fence" class="headerlink" title="Fence"></a>Fence</h2><p><img src="/2023/03/18/D3D12-learning-notes/6.png"><br>A marker let you know when GPU has finished doing its work and tell CPU, so they can be synchronised.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// Synchronization objects</span><br><span class="hljs-comment">// a pointer used to ensure the synchronization primitive that the CPU can use to determine the eprogress of the GPU&#x27;s execution of command lists.</span><br>ComPtr&lt;ID3D12Fence&gt; g_Fence;<br><span class="hljs-comment">// the next fence value to signal the command queue</span><br><span class="hljs-type">uint64_t</span> g_FenceValue = <span class="hljs-number">0</span>;<br><span class="hljs-comment">// each frame could be &#x27;in-flight&#x27; on the command queue, this is used to keep tracked to guarantee that any resources that are still being referenced by the command queue are not overwritten.</span><br><span class="hljs-type">uint64_t</span> g_FrameFenceValues[g_NumFrames] = &#123;&#125;;<br><span class="hljs-comment">// used to hold on untill the fance has reached a specific value.</span><br>HANDLE g_FenceEvent;<br></code></pre></td></tr></table></figure><h2 id="Swap-Chain"><a href="#Swap-Chain" class="headerlink" title="Swap Chain"></a>Swap Chain</h2><p><img src="/2023/03/18/D3D12-learning-notes/4.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-type">const</span> <span class="hljs-type">unit8_t</span> g_NumFrames = <span class="hljs-number">3</span>;<br></code></pre></td></tr></table></figure><p>must more than 2 if using flip ppresentation model.</p><h2 id="Transformation-Pipeline"><a href="#Transformation-Pipeline" class="headerlink" title="Transformation Pipeline"></a>Transformation Pipeline</h2><ol><li>World Transform: change each 3D model’s coordinates into world coordinates.</li><li>View Transform: $V &#x3D; T \cdot R_z \cdot R_y \cdot R_z$</li><li>Projection Transform:</li></ol><p><img src="/2023/03/18/D3D12-learning-notes/1.png"><br><img src="/2023/03/18/D3D12-learning-notes/2.png"></p><ol start="4"><li>Clip transform: ignore the part not in the camera.</li></ol><h2 id="Render-Target-View-RTV"><a href="#Render-Target-View-RTV" class="headerlink" title="Render Target View(RTV):"></a>Render Target View(RTV):</h2><p>After several months, now my understanding of RTV is: </p><p>The purpose of it is just tell GPU how to render at back buffer before swap. If without RTV, the GPU will not know where the rendered pixel should be sent.</p><div style="display: flex; justify-content: center; align-items: center;">  <img src="D3D12-learning-notes/5.png" title="A regular image" width="300" height="300"></div><h2 id="Root-signatures"><a href="#Root-signatures" class="headerlink" title="Root signatures"></a>Root signatures</h2><p>It describe constant, CBV(constant buffer view), SRV, UAV, Sample,etc.. store in register rools.</p><h1 id="glossary-of-CG"><a href="#glossary-of-CG" class="headerlink" title="glossary of CG"></a>glossary of CG</h1><ul><li><p>mipmap: a set of pictures, with different level of pixels. Becasue off-site viewing do not need that detailed.</p></li><li><p>SRV(shader resource view): wrapping textures in a format that the shadow can access them. Read Only. For example : a single texture, individual arrays, planes, or colors from a mipmapped texture, 3D texture, 1D texture color gradinets, etc.</p></li><li><p>UAV(unordered access view): same as SRV, but can read or write in any order, even could read&#x2F;written simultaneously by multipl,e threads without generate memory conflicts.</p></li><li><p>root signatures: link command to the resources the shaders require. It determines the type of data the shaders should expect, but does not define the actural memory or data. For graphics command list has both a graphics and compute root signature, for compute command list have one compute root signature. These root signatures are independent of each others.</p></li><li><p>Resource: all the resource could be excuted by GPU is resource in D3D12. Which is ‘ID3D12Resource’, such as rendering targets(include back buffers), textures, vertex buffers, index buffers… </p></li><li><p>G-SYNC: refresh screen and graph card together.</p></li><li><p>Window Advanced Rasterization Platform(WARP): If did not find a valiable GPU, the system will do the same step of D3D12 by CPU by WARP. It can instead all the rendering method such as rasterization, ray tracing…</p></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
